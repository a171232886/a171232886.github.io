<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"a171232886.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-2}},"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="https://a171232886.github.io/2024/10/09/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://a171232886.github.io/2024/10/09/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","path":"2024/10/09/设计模式/","title":"23种经典设计模式"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>23种经典设计模式 | 小王同学</title>
  




<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>
#needsharebutton-postbottom {
  cursor: pointer;
  height: 26px;
  margin-top: 10px;
  position: relative;
}
#needsharebutton-postbottom .btn {
  border: 1px solid $btn-default-border-color;
  border-radius: 3px;
  display: initial;
  padding: 1px 4px;
}
</style><link rel="stylesheet" type="text/css" href="/css/injector/main.css" /><link rel="preload" as="style" href="/css/injector/light.css" /><link rel="preload" as="style" href="/css/injector/dark.css" />
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>
  <a target="_blank" rel="noopener" href="https://github.com/a171232886" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">小王同学</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text"> 参考</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 1. 观察者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text"> 1.1 基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 1.2 代码框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#121-%E5%9F%BA%E7%A1%80%E7%89%88%E6%9C%AC"><span class="nav-text"> 1.2.1  基础版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#122-%E6%8E%A8%E6%A8%A1%E5%9E%8B"><span class="nav-text"> 1.2.2 推模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#123-%E6%8B%89%E6%A8%A1%E5%9E%8B"><span class="nav-text"> 1.2.3 拉模型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 2. 状态模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#21-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text"> 2.1 基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 2.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E4%B8%AD%E4%BB%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 3. 中介模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#31-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 3.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 3.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 4. 装饰模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 5. 单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#51-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 5.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#52-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95"><span class="nav-text"> 5.2 实现方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#521-%E5%88%A9%E7%94%A8%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="nav-text"> 5.2.1 利用注册表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E5%85%8B%E9%9A%86%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 6. 克隆模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-%E8%81%8C%E8%B4%A3%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 7. 职责模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#71-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text"> 7.1 基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#72-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 7.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 8. 代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#81-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text"> 8.1 基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#82-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 8.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 9. 外观模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-%E8%BF%AD%E4%BB%A3%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 10. 迭代模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 11. 组合模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#111-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 11.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#112-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 11.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 12. 构建模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#121-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 12.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#122-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 12.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-%E9%80%82%E9%85%8D%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 13. 适配模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#131-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text"> 13.1 基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#132-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 13.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 14. 策略模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#141-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text"> 14.1 基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#142-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 14.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 15. 工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#151-%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 15.1 简单工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1511-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 15.1.1 基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1512-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 15.1.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#152-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 15.2 工厂方法模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1521-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 15.2.1 基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1522-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 15.2.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#153-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 15.3 抽象工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1531-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 15.3.1 基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1532-%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text"> 15.3.2 应用案例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#16-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 16. 命令模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#161-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text"> 16.1 基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#162-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 16.2 代码框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1621-%E7%AE%80%E5%8D%95%E7%89%88"><span class="nav-text"> 16.2.1 简单版</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1622-%E5%AE%8F%E5%91%BD%E4%BB%A4%E7%89%88"><span class="nav-text"> 16.2.2 宏命令版</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#17-%E5%A4%87%E5%BF%98%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 17. 备忘模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#171-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text"> 17.1 基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#172-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 17.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#18-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 18. 享元模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#181-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 18.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#182-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 18.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#19-%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 19. 访问模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#191-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text"> 19.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#192-%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-text"> 19.2 代码框架</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#20-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 20 模板模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#21-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 21 桥接模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#211-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text"> 21.1 基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#212-%E4%BB%A3%E7%A0%81%E6%A0%B7%E4%BE%8B"><span class="nav-text"> 21.2 代码样例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#22-%E8%A7%A3%E9%87%8A%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 22 解释模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95a%E5%88%86%E6%B4%BE"><span class="nav-text"> 附录A：分派</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#a1-%E6%A6%82%E5%BF%B5"><span class="nav-text"> A.1 概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#a2-python%E4%B8%8E%E5%88%86%E6%B4%BE"><span class="nav-text"> A.2 Python与分派</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a21-%E5%8D%95%E5%88%86%E6%B4%BE"><span class="nav-text"> A.2.1 单分派</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a22-%E5%8A%A8%E6%80%81%E5%A4%9A%E5%88%86%E6%B4%BE"><span class="nav-text"> A.2.2 （动态）多分派</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95bpython%E4%B8%AD%E7%9A%84copy"><span class="nav-text"> 附录B：Python中的copy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#b1-%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="nav-text"> B.1 浅拷贝</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#b2-%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="nav-text"> B.2 深拷贝</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-text"> 附录C: 设计模式的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#c1-%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text"> C.1 行为型模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c2-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text"> C.2 结构型模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c3-%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text"> C.3 创建型模式</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="小王同学"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">小王同学</p>
  <div class="site-description" itemprop="description">进步源于记录</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/a171232886" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;a171232886" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/a171232886" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;a171232886" rel="noopener" target="_blank"><i class="fa fa-book-open fa-fw"></i>CSDN</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://hexo.io/" title="https:&#x2F;&#x2F;hexo.io" rel="noopener" target="_blank">Hexo</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://theme-next.js.org/" title="https:&#x2F;&#x2F;theme-next.js.org&#x2F;" rel="noopener" target="_blank">NexT</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://a171232886.github.io/2024/10/09/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="小王同学">
      <meta itemprop="description" content="进步源于记录">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小王同学">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          23种经典设计模式
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-10-09 20:23:58 / 修改时间：21:03:43" itemprop="dateCreated datePublished" datetime="2024-10-09T20:23:58+08:00">2024-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li>
<p>人人都懂设计模式：从生活中领悟设计模式（Python实现）</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gitee.com/divingkitten/PyDesignPattern">https://gitee.com/divingkitten/PyDesignPattern</a></li>
</ul>
</li>
<li>
<p>设计模式：可复用面向对象软件的基础</p>
<p>该书学术性太强</p>
</li>
</ol>
<span id="more"></span>
<h1 id="1-观察者模式"><a class="markdownIt-Anchor" href="#1-观察者模式"></a> 1. 观察者模式</h1>
<h2 id="11-基础知识"><a class="markdownIt-Anchor" href="#11-基础知识"></a> 1.1 基础知识</h2>
<ol>
<li>又称发布订阅模式（publish / subscribe ），监听模式</li>
<li>是一种一对多的关系
<ul>
<li>一个被观察者（Observable或Subject）</li>
<li>多个观察者（Observer）</li>
</ul>
</li>
<li>被观察者在其状态或者数据发生变化时，通知全部观察者
<ul>
<li>Observable 调用 Observer的update方法</li>
</ul>
</li>
<li>被观察者至少提供三种方法
<ul>
<li>添加观察者（attach / register）</li>
<li>删除观察者（detach / unregister）</li>
<li>更新状态（notify）</li>
</ul>
</li>
</ol>
<h2 id="12-代码框架"><a class="markdownIt-Anchor" href="#12-代码框架"></a> 1.2 代码框架</h2>
<h3 id="121-基础版本"><a class="markdownIt-Anchor" href="#121-基础版本"></a> 1.2.1  基础版本</h3>
   <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>observer_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>observer_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">unregister</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>observer_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">notify</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> observer <span class="token keyword">in</span> self<span class="token punctuation">.</span>observer_list<span class="token punctuation">:</span>
            observer<span class="token punctuation">.</span>update<span class="token punctuation">(</span>message<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        self<span class="token punctuation">.</span>notify<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Observer</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        
    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Observer received: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    subject <span class="token operator">=</span> Subject<span class="token punctuation">(</span><span class="token punctuation">)</span>
    observer <span class="token operator">=</span> Observer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    subject<span class="token punctuation">.</span>register<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
    subject<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="122-推模型"><a class="markdownIt-Anchor" href="#122-推模型"></a> 1.2.2 推模型</h3>
<p>被观察者向全部观察者推送信息（也可以直接把自身推送过去）</p>
<ul>
<li>比如反诈中心的公益短信</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>observer_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>observer_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">unregister</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>observer_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">notify</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> observer <span class="token keyword">in</span> self<span class="token punctuation">.</span>observer_list<span class="token punctuation">:</span>
            observer<span class="token punctuation">.</span>update<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">"Hello"</span>
        self<span class="token punctuation">.</span>notify<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Observer</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        
    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Observer received: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>obj<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    subject <span class="token operator">=</span> Subject<span class="token punctuation">(</span><span class="token punctuation">)</span>
    observer <span class="token operator">=</span> Observer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    subject<span class="token punctuation">.</span>register<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
    subject<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="123-拉模型"><a class="markdownIt-Anchor" href="#123-拉模型"></a> 1.2.3 拉模型</h3>
<p>只向全部观察者，推送通知。由观察者自行决定，是否拉取全部信息</p>
<ul>
<li>相比于推模型，拉模型更节省流量</li>
<li>比如手机系统更新，厂家会给每个用户发送更新通知，由用户自行决定是否更新系统</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">attach</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> observer <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>_observers<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_observers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">detach</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_observers<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">notify</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> observer <span class="token keyword">in</span> self<span class="token punctuation">.</span>_observers<span class="token punctuation">:</span>
            observer<span class="token punctuation">.</span>update<span class="token punctuation">(</span>message<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_state</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_state

    <span class="token keyword">def</span> <span class="token function">set_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> state
        self<span class="token punctuation">.</span>notify<span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Observer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_subject <span class="token operator">=</span> subject
        self<span class="token punctuation">.</span>_subject<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 可根据message做对应处理</span>
        state <span class="token operator">=</span> self<span class="token punctuation">.</span>_subject<span class="token punctuation">.</span>get_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Observer </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> received update: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>state<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 示例用法</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    subject <span class="token operator">=</span> Subject<span class="token punctuation">(</span><span class="token punctuation">)</span>
    observer1 <span class="token operator">=</span> Observer<span class="token punctuation">(</span>subject<span class="token punctuation">)</span>
    subject<span class="token punctuation">.</span>set_state<span class="token punctuation">(</span><span class="token string">"State 1"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2-状态模式"><a class="markdownIt-Anchor" href="#2-状态模式"></a> 2. 状态模式</h1>
<h2 id="21-基础知识"><a class="markdownIt-Anchor" href="#21-基础知识"></a> 2.1 基础知识</h2>
<ol>
<li>
<p>状态模式：当一个对象的内部状态改变后，对象的行为也发生变化</p>
</li>
<li>
<p>适用条件</p>
<ul>
<li>对象的行为由状态决定</li>
<li>不同的状态之间的行为差异很大</li>
</ul>
<p><mark>如果行为差异比较小或易管理，直接用if-elif-else分支即可</mark></p>
</li>
<li>
<p>状态模式构成的要点</p>
<ul>
<li>每个状态及其对应行为封装成类（全局单例），且继承自同一父类</li>
<li>使用状态的类，直接访问状态父类的方法，进而实现多态</li>
</ul>
</li>
</ol>
<h2 id="22-代码框架"><a class="markdownIt-Anchor" href="#22-代码框架"></a> 2.2 代码框架</h2>
<p>（Deepseek生成）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token comment"># 状态接口</span>
<span class="token keyword">class</span> <span class="token class-name">State</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 具体状态类</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteStateA</span><span class="token punctuation">(</span>State<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ConcreteStateA is handling the request."</span><span class="token punctuation">)</span>
        <span class="token comment"># 状态转换逻辑</span>
        context<span class="token punctuation">.</span>set_state<span class="token punctuation">(</span>ConcreteStateB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ConcreteStateB</span><span class="token punctuation">(</span>State<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ConcreteStateB is handling the request."</span><span class="token punctuation">)</span>
        <span class="token comment"># 状态转换逻辑</span>
        context<span class="token punctuation">.</span>set_state<span class="token punctuation">(</span>ConcreteStateA<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 上下文类</span>
<span class="token keyword">class</span> <span class="token class-name">Context</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> ConcreteStateA<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 初始状态</span>

    <span class="token keyword">def</span> <span class="token function">set_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> state
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"State changed to </span><span class="token interpolation"><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

<span class="token comment"># 示例用法</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    context <span class="token operator">=</span> Context<span class="token punctuation">(</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ConcreteStateA is handling the request.</span>
    context<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ConcreteStateB is handling the request.</span>
    context<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ConcreteStateA is handling the request.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为简化逻辑，建议状态转换由上下文类完成。每个状态类，仅负责行为函数多态。</p>
<h1 id="3-中介模式"><a class="markdownIt-Anchor" href="#3-中介模式"></a> 3. 中介模式</h1>
<h2 id="31-基础概念"><a class="markdownIt-Anchor" href="#31-基础概念"></a> 3.1 基础概念</h2>
<ol>
<li>
<p>Mediator Pattern：中介者使个对象不需要显示的相互引用，从而使其耦合松散</p>
<ul>
<li>变成星型结构，中介者做核心</li>
</ul>
</li>
<li>
<p>在应用上，可以有效避免各模块间的相互引用，进而避免循环引用</p>
</li>
</ol>
<h2 id="32-代码框架"><a class="markdownIt-Anchor" href="#32-代码框架"></a> 3.2 代码框架</h2>
<p>并不存在一个通用框架，只要该代码框架满足：</p>
<ul>
<li>星型结构：各对象仅依赖中介者，而不是其他对象</li>
<li>中介交互：各对象通过中介者进行交互，而不是直接交互</li>
</ul>
<p>简单案例：聊天室</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token comment"># 抽象中介者</span>
<span class="token keyword">class</span> <span class="token class-name">Mediator</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 具体中介者 - 聊天室</span>
<span class="token keyword">class</span> <span class="token class-name">ChatRoom</span><span class="token punctuation">(</span>Mediator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>users<span class="token punctuation">.</span>append<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>mediator <span class="token operator">=</span> self

    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> u <span class="token keyword">in</span> self<span class="token punctuation">.</span>users<span class="token punctuation">:</span>
            <span class="token keyword">if</span> u <span class="token operator">!=</span> user<span class="token punctuation">:</span>
                u<span class="token punctuation">.</span>receive<span class="token punctuation">(</span>message<span class="token punctuation">)</span>

<span class="token comment"># 抽象同事类</span>
<span class="token keyword">class</span> <span class="token class-name">Colleague</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mediator<span class="token punctuation">:</span> Mediator <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">receive</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 具体同事类 - 用户</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>Colleague<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string">: 发送消息 -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mediator<span class="token punctuation">.</span>send<span class="token punctuation">(</span>message<span class="token punctuation">,</span> self<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">receive</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string">: 收到消息 -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 创建聊天室</span>
chat_room <span class="token operator">=</span> ChatRoom<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建用户并加入聊天室</span>
alice <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span>
bob <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span>

chat_room<span class="token punctuation">.</span>add_user<span class="token punctuation">(</span>alice<span class="token punctuation">)</span>
chat_room<span class="token punctuation">.</span>add_user<span class="token punctuation">(</span>bob<span class="token punctuation">)</span>

<span class="token comment"># 用户发送消息</span>
alice<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"你好 Bob!"</span><span class="token punctuation">)</span>
bob<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"嗨 Alice，很高兴见到你！"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="4-装饰模式"><a class="markdownIt-Anchor" href="#4-装饰模式"></a> 4. 装饰模式</h1>
<ol>
<li>
<p>Decorator Pattern：在运行时给一个对象添加额外的行为或责任，而无需修改其结构。</p>
</li>
<li>
<p>使用python的装饰器机制即可</p>
</li>
</ol>
<h1 id="5-单例模式"><a class="markdownIt-Anchor" href="#5-单例模式"></a> 5. 单例模式</h1>
<h2 id="51-基础概念"><a class="markdownIt-Anchor" href="#51-基础概念"></a> 5.1 基础概念</h2>
<ol>
<li>
<p>单例：一个类在在全局只有一个对象</p>
</li>
<li>
<p>有利于对函数和数据的全局统一管理</p>
</li>
</ol>
<h2 id="52-实现方法"><a class="markdownIt-Anchor" href="#52-实现方法"></a> 5.2 实现方法</h2>
<h3 id="521-利用注册表"><a class="markdownIt-Anchor" href="#521-利用注册表"></a> 5.2.1 利用注册表</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>arg <span class="token operator">=</span> arg

    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_instance</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        global_vars <span class="token operator">=</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"__Test_instance__"</span> <span class="token keyword">in</span> global_vars<span class="token punctuation">:</span>
            <span class="token keyword">return</span> global_vars<span class="token punctuation">[</span><span class="token string">"__Test_instance__"</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            instance <span class="token operator">=</span> Test<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
            global_vars<span class="token punctuation">[</span><span class="token string">"__Test_instance__"</span><span class="token punctuation">]</span> <span class="token operator">=</span> instance
            <span class="token keyword">return</span> instance
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test1 <span class="token operator">=</span> Test<span class="token punctuation">.</span>get_instance<span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="6-克隆模式"><a class="markdownIt-Anchor" href="#6-克隆模式"></a> 6. 克隆模式</h1>
<ol>
<li>
<p>又称为原型模式（Prototype Pattern）</p>
<p>在类中提供一个克隆本实例的方法</p>
</li>
<li>
<p>框架</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy

<span class="token keyword">class</span> <span class="token class-name">Prototype</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">clone</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>重点关注点应该在<strong>浅拷贝</strong>和<strong>深拷贝</strong></p>
<p>浅拷贝：只拷贝指针（python中为引用）</p>
<p>深拷贝：开辟新的内存空间，复制数据</p>
</li>
</ol>
<h1 id="7-职责模式"><a class="markdownIt-Anchor" href="#7-职责模式"></a> 7. 职责模式</h1>
<h2 id="71-基础知识"><a class="markdownIt-Anchor" href="#71-基础知识"></a> 7.1 基础知识</h2>
<ol>
<li>
<p>又称责任链模式（Chain of Responsibility Pattern），构成要素</p>
<ul>
<li>
<p><strong>请求(Request)</strong>：发送者到请求者的消息</p>
</li>
<li>
<p><strong>发送者(Sender)</strong>：消息发送者</p>
</li>
<li>
<p><strong>接收者(Receiver)</strong>：消息接受者，也是第一个处理者。每个接收者包含对下一个接收者的引用，形成一个链</p>
</li>
<li>
<p><strong>处理者(Concrete Handlers)</strong>：根据条件决定处理请求还是将请求传给下一个处理者</p>
</li>
</ul>
<pre class="mermaid">   graph LR
	Sender --Request--> A["Receiver(Handler0)"]
	A --> Handler1
	Handler1 --"..."--> Handlern</pre>
</li>
<li>
<p>要点</p>
<ul>
<li>实现了<strong>接收者</strong>和<strong>处理者</strong>之间的解耦</li>
<li><strong>发送者只需要知道消息接受者是谁即可</strong>，不需要知道具体的处理链</li>
</ul>
</li>
<li>
<p>典型应用：流程审批</p>
</li>
</ol>
<h2 id="72-代码框架"><a class="markdownIt-Anchor" href="#72-代码框架"></a> 7.2 代码框架</h2>
<p>注意：Handler链一定是单链</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">HandlerBase</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>next_handler <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">set_next_handler</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> next_handler<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>next_handler <span class="token operator">=</span> next_handler
    
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    

<span class="token keyword">class</span> <span class="token class-name">Handler1</span><span class="token punctuation">(</span>HandlerBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Handler1 handled the request"</span><span class="token punctuation">)</span>
            
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>next_handler<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>next_handler<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Handler2</span><span class="token punctuation">(</span>HandlerBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Handler2 handled the request"</span><span class="token punctuation">)</span>
            
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>next_handler<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>next_handler<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
            
<span class="token keyword">class</span> <span class="token class-name">DefaultHandler</span><span class="token punctuation">(</span>HandlerBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This is the default handler"</span><span class="token punctuation">)</span>
            
            
<span class="token keyword">class</span> <span class="token class-name">Sender</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Sender"</span>
        self<span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver
        
    <span class="token keyword">def</span> <span class="token function">send_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 发送者只需关注是谁来接收这条消息</span>
        self<span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        
        
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    
    handler1 <span class="token operator">=</span> Handler1<span class="token punctuation">(</span><span class="token string">"Handler1"</span><span class="token punctuation">)</span>
    handler2 <span class="token operator">=</span> Handler2<span class="token punctuation">(</span><span class="token string">"Handler2"</span><span class="token punctuation">)</span>
    default_handler <span class="token operator">=</span> DefaultHandler<span class="token punctuation">(</span><span class="token string">"DefaultHandler"</span><span class="token punctuation">)</span>
    
    handler1<span class="token punctuation">.</span>set_next_handler<span class="token punctuation">(</span>handler2<span class="token punctuation">)</span>
    handler2<span class="token punctuation">.</span>set_next_handler<span class="token punctuation">(</span>default_handler<span class="token punctuation">)</span>
    
    sender <span class="token operator">=</span> Sender<span class="token punctuation">(</span><span class="token string">"Sender"</span><span class="token punctuation">,</span> handler1<span class="token punctuation">)</span>

    sender<span class="token punctuation">.</span>send_request<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    sender<span class="token punctuation">.</span>send_request<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    sender<span class="token punctuation">.</span>send_request<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="8-代理模式"><a class="markdownIt-Anchor" href="#8-代理模式"></a> 8. 代理模式</h1>
<h2 id="81-基础知识"><a class="markdownIt-Anchor" href="#81-基础知识"></a> 8.1 基础知识</h2>
<ol>
<li>
<p>用户 --&gt; 代理 --&gt; 真正对象</p>
</li>
<li>
<p>代理（Proxy或Surrogate）模式</p>
<ul>
<li>使用一个额外的间接层来支持分散的、可控的、智能的访问</li>
<li>增加一个包装来保护真正对象</li>
</ul>
</li>
<li>
<p>在实际使用上的现实意义在于</p>
<ul>
<li>向用户屏蔽了技术细节</li>
<li>技术细节的变动不会影响用户的使用习惯，因为用户访问的是代理</li>
</ul>
</li>
</ol>
<h2 id="82-代码框架"><a class="markdownIt-Anchor" href="#82-代码框架"></a> 8.2 代码框架</h2>
<ol>
<li><strong>Subject（主题）接口</strong>：这是真实对象和代理对象共同遵循的一个接口，使得可以在任何时候用真实对象替换代理对象或者反之。</li>
<li><strong>RealSubject（真实主题）类</strong>：实现了Subject接口，并包含实际的业务逻辑。</li>
<li><strong>Proxy（代理）类</strong>：也实现了Subject接口，并且包含一个RealSubject对象的引用，代理对象可以在请求到达真实对象之前或之后执行一些操作。</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    定义了RealSubject和Proxy共有的公共接口。
    """</span>

    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span>Subject<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    包含了真实的请求。
    """</span>

    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"RealSubject handles request."</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>Subject<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    代理类含有一个RealSubject的实例，而且提供与RealSubject相同的接口。
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>real_subject <span class="token operator">=</span> subject

    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Proxy pre-processing."</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>real_subject<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Proxy post-processing."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="9-外观模式"><a class="markdownIt-Anchor" href="#9-外观模式"></a> 9. 外观模式</h1>
<ol>
<li>Facade Pattern：对整个复杂系统封装出简单接口，供用户使用
<ul>
<li>向用户屏蔽系统内部细节，降低系统内部和用户代码的耦合程度</li>
</ul>
</li>
<li>并不存在通用的代码框架</li>
</ol>
<h1 id="10-迭代模式"><a class="markdownIt-Anchor" href="#10-迭代模式"></a> 10. 迭代模式</h1>
<ol>
<li>Iterator Pattern：提供了一种方法来访问一个聚合对象（如列表、集合等）中的元素，而无需暴露该对象的底层表示。</li>
<li>直接使用python中迭代器或生成器即可</li>
</ol>
<h1 id="11-组合模式"><a class="markdownIt-Anchor" href="#11-组合模式"></a> 11. 组合模式</h1>
<h2 id="111-基础概念"><a class="markdownIt-Anchor" href="#111-基础概念"></a> 11.1 基础概念</h2>
<ol>
<li>Composite Pattern：将系统设计成”整体-部分“（复合体-组件）的树状结构</li>
<li>**Component（组件）<strong>和</strong>Composite（复合体/容器）**均实现了某个特定接口，比如run()
<ul>
<li>用户可不再区分组件和复合体的使用方式，直接调用run()即可</li>
</ul>
</li>
<li>Composite可以作为Component被组合，因此会形成树状结构</li>
</ol>
<h2 id="112-代码框架"><a class="markdownIt-Anchor" href="#112-代码框架"></a> 11.2 代码框架</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ComponentBase</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Component"</span>

    <span class="token keyword">def</span> <span class="token function">is_composite</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">operation</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name


<span class="token keyword">class</span> <span class="token class-name">CompositeBase</span><span class="token punctuation">(</span>ComponentBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> component<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>children<span class="token punctuation">.</span>append<span class="token punctuation">(</span>component<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> component<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>children<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>component<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_composite</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">operation</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> child <span class="token keyword">in</span> self<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>child<span class="token punctuation">.</span>operation<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string">(</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'+'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="12-构建模式"><a class="markdownIt-Anchor" href="#12-构建模式"></a> 12. 构建模式</h1>
<h2 id="121-基础概念"><a class="markdownIt-Anchor" href="#121-基础概念"></a> 12.1 基础概念</h2>
<ol>
<li>
<p>builder pattern，又称建造者模式或生成者模式</p>
<ul>
<li>将构造出的对象和构造过程分离，实现同一构造过程的复用</li>
</ul>
</li>
<li>
<p>三个要素：</p>
<ul>
<li>Product（产品）</li>
<li>Builder（构建者）</li>
<li>BuilderManager（构建者管理）</li>
</ul>
</li>
<li>
<p>未发现和工厂方法模式有什么实际上的区别。</p>
</li>
</ol>
<h2 id="122-代码框架"><a class="markdownIt-Anchor" href="#122-代码框架"></a> 12.2 代码框架</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ProductBase</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    
    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        
        
<span class="token keyword">class</span> <span class="token class-name">Product1</span><span class="token punctuation">(</span>ProductBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>price <span class="token operator">=</span> price
        
    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Product1 func'</span><span class="token punctuation">)</span>
        

<span class="token keyword">class</span> <span class="token class-name">ProductBuilderBase</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>product <span class="token operator">=</span> <span class="token boolean">None</span>
        
    <span class="token keyword">def</span> <span class="token function">build</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    
<span class="token keyword">class</span> <span class="token class-name">Product1Builder</span><span class="token punctuation">(</span>ProductBuilderBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">build</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Product1<span class="token punctuation">(</span><span class="token string">'Product1'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    

<span class="token keyword">class</span> <span class="token class-name">BuilderManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>product1_builder <span class="token operator">=</span> Product1Builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">build_product1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>product1_builder<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>product2</code>可以参照 <code>product1</code> 的流程添加</li>
<li>用户只需访问<code>BuilderManager</code></li>
</ul>
<h1 id="13-适配模式"><a class="markdownIt-Anchor" href="#13-适配模式"></a> 13. 适配模式</h1>
<h2 id="131-基本概念"><a class="markdownIt-Anchor" href="#131-基本概念"></a> 13.1 基本概念</h2>
<ol>
<li>
<p>Wrapper，包装模式，变压器模式：将一个对象进行包装或者转换，使其符合某种指定的接口</p>
<ul>
<li>例如：HDMI-VGI的转换器</li>
</ul>
</li>
<li>
<p>要素：</p>
<ul>
<li><strong>Target</strong>（目标）：定义客户端使用的与领域相关的接口。</li>
<li><strong>Adaptee</strong>（适配者）：包含一些有用的业务逻辑，但是它的接口不符合 <code>Target</code> 的要求。适配器模式的核心在于创建一个适配器来解决 <code>Adaptee</code> 和 <code>Target</code> 之间的接口不匹配问题。</li>
<li><strong>Adapter</strong>（适配器）：适配器包含 <code>Adaptee</code> 的实例，并且实现了 <code>Target</code> 接口，从而作为 <code>Target</code> 与 <code>Adaptee</code> 之间的桥梁。</li>
</ul>
</li>
<li>
<p>两种实现模式：</p>
<ul>
<li>继承模式：Adapter 继承自 Adaptee</li>
<li>组合模式（推荐）：Adaptee 对象是 Adapter的一个成员对象</li>
</ul>
</li>
</ol>
<h2 id="132-代码框架"><a class="markdownIt-Anchor" href="#132-代码框架"></a> 13.2 代码框架</h2>
<p>（组合模式）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Target</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 目标接口 """</span>

    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"普通请求"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Adaptee</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 适配者类，拥有不同的接口 """</span>

    <span class="token keyword">def</span> <span class="token function">specific_request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"特定请求"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Adapter</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 适配器类，通过组合包含适配者类的实例，并提供与目标相同的接口 """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> adaptee<span class="token punctuation">:</span> Adaptee<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_adaptee <span class="token operator">=</span> adaptee

    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 调用适配者的方法</span>
        self<span class="token punctuation">.</span>_adaptee<span class="token punctuation">.</span>specific_request<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">client_code</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    客户端代码，只关心目标接口
    """</span>
    target<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建适配者对象</span>
    adaptee <span class="token operator">=</span> Adaptee<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建适配器对象，并传入适配者对象</span>
    adapter <span class="token operator">=</span> Adapter<span class="token punctuation">(</span>adaptee<span class="token punctuation">)</span>
    
    <span class="token comment"># 客户端代码使用适配器</span>
    client_code<span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="14-策略模式"><a class="markdownIt-Anchor" href="#14-策略模式"></a> 14. 策略模式</h1>
<h2 id="141-基本概念"><a class="markdownIt-Anchor" href="#141-基本概念"></a> 14.1 基本概念</h2>
<ol>
<li>
<p>Strategy Pattern：定义一系列算法，将每个算法都封装起来，并且使它们之间可以相互替换。</p>
</li>
<li>
<p>三要素：</p>
<ul>
<li>Context（上下文）：面向用户使用，屏蔽上层应用对策略的直接访问。</li>
<li>Strategy （基类）：定义统一的接口</li>
<li>Concrete Strategy（具体策略）：继承自Strategy基类的子类，具体算法</li>
</ul>
<p>访问顺序为<code>Client --&gt; Context --&gt; Strategy</code></p>
</li>
</ol>
<h2 id="142-代码框架"><a class="markdownIt-Anchor" href="#142-代码框架"></a> 14.2 代码框架</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token keyword">class</span> <span class="token class-name">StrategyBase</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
<span class="token keyword">class</span> <span class="token class-name">StrategyA</span><span class="token punctuation">(</span>StrategyBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"StrategyA: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>_name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
<span class="token keyword">class</span> <span class="token class-name">StrategyB</span><span class="token punctuation">(</span>StrategyBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"StrategyB: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>_name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        
<span class="token keyword">class</span> <span class="token class-name">Context</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> strategy<span class="token punctuation">:</span> StrategyBase<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_strategy <span class="token operator">=</span> strategy
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_strategy<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    context <span class="token operator">=</span> Context<span class="token punctuation">(</span>StrategyA<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    context <span class="token operator">=</span> Context<span class="token punctuation">(</span>StrategyB<span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="15-工厂模式"><a class="markdownIt-Anchor" href="#15-工厂模式"></a> 15. 工厂模式</h1>
<p>简单工厂模式 --&gt; 工厂方法模式 --&gt; 抽象工厂模式</p>
<h2 id="151-简单工厂模式"><a class="markdownIt-Anchor" href="#151-简单工厂模式"></a> 15.1 简单工厂模式</h2>
<h3 id="1511-基础概念"><a class="markdownIt-Anchor" href="#1511-基础概念"></a> 15.1.1 基础概念</h3>
<ol>
<li>
<p>Simple Factory Pattern，又称为静态工厂</p>
<ul>
<li>通过if-else进行条件判断，确定创建哪个对象</li>
</ul>
</li>
<li>
<p>最简单的工厂模式</p>
</li>
<li>
<p><strong>推荐&quot;字典工厂&quot;</strong>：在python中，dict的key确定创建哪个对象</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span>
    <span class="token string">"class1"</span><span class="token punctuation">:</span> Class1<span class="token punctuation">,</span>
    <span class="token string">"class2"</span><span class="token punctuation">:</span> Class2<span class="token punctuation">,</span>    
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用时</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
	cls <span class="token operator">=</span> cls_dict<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
    <span class="token keyword">return</span> cls<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h3 id="1512-代码框架"><a class="markdownIt-Anchor" href="#1512-代码框架"></a> 15.1.2 代码框架</h3>
<p>典型方法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 抽象产品</span>
<span class="token keyword">class</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span>Shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Drawing a circle..."</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span>Shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Drawing a rectangle..."</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">(</span>Shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Drawing a square..."</span>

<span class="token comment"># 工厂类</span>
<span class="token keyword">class</span> <span class="token class-name">ShapeFactory</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create_shape</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> shape_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> shape_type <span class="token operator">==</span> <span class="token string">"Circle"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Circle<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> shape_type <span class="token operator">==</span> <span class="token string">"Rectangle"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Rectangle<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> shape_type <span class="token operator">==</span> <span class="token string">"Square"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Square<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Invalid shape type"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="152-工厂方法模式"><a class="markdownIt-Anchor" href="#152-工厂方法模式"></a> 15.2 工厂方法模式</h2>
<h3 id="1521-基础概念"><a class="markdownIt-Anchor" href="#1521-基础概念"></a> 15.2.1 基础概念</h3>
<ol>
<li>相比于简单工厂，多了工厂基类。每个工厂子类继承自工厂基类，并只负责一个产品的创建</li>
<li>一个类的实例化延迟到工厂子类</li>
<li>未理解其用途和价值</li>
</ol>
<h3 id="1522-代码框架"><a class="markdownIt-Anchor" href="#1522-代码框架"></a> 15.2.2 代码框架</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Product</span>
<span class="token keyword">class</span> <span class="token class-name">Graphic</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError

<span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span>Graphic<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Rendering a circle..."</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span>Graphic<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Rendering a rectangle..."</span>
    
<span class="token comment"># Factory</span>
<span class="token keyword">class</span> <span class="token class-name">GraphicFactory</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create_graphic</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Graphic<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError        

<span class="token keyword">class</span> <span class="token class-name">CircleFactory</span><span class="token punctuation">(</span>GraphicFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create_graphic</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Graphic<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Circle<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">RectangleFactory</span><span class="token punctuation">(</span>GraphicFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create_graphic</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Graphic<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Rectangle<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># client</span>
<span class="token keyword">def</span> <span class="token function">client_code</span><span class="token punctuation">(</span>factory<span class="token punctuation">:</span> GraphicFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    graphic <span class="token operator">=</span> factory<span class="token punctuation">.</span>create_graphic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>graphic<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    circle_factory <span class="token operator">=</span> CircleFactory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client_code<span class="token punctuation">(</span>circle_factory<span class="token punctuation">)</span>    
    
    circle <span class="token operator">=</span> Circle<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 直接初始化，不好么？</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="153-抽象工厂模式"><a class="markdownIt-Anchor" href="#153-抽象工厂模式"></a> 15.3 抽象工厂模式</h2>
<h3 id="1531-基础概念"><a class="markdownIt-Anchor" href="#1531-基础概念"></a> 15.3.1 基础概念</h3>
<ol>
<li>
<p>针对多种分类的产品或具有二级分类的产品</p>
</li>
<li>
<p>将产品本身和产品构造进行解耦，可在构造部分进行复杂设计</p>
<p>一个工厂可以构造多种产品</p>
</li>
</ol>
<h3 id="1532-应用案例"><a class="markdownIt-Anchor" href="#1532-应用案例"></a> 15.3.2 应用案例</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token comment"># 抽象产品</span>
<span class="token keyword">class</span> <span class="token class-name">RenderEngine</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">ExportFormat</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">export</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">OpenGL</span><span class="token punctuation">(</span>RenderEngine<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Rendering with OpenGL..."</span>

<span class="token keyword">class</span> <span class="token class-name">DirectX</span><span class="token punctuation">(</span>RenderEngine<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Rendering with DirectX..."</span>

<span class="token keyword">class</span> <span class="token class-name">SVGExporter</span><span class="token punctuation">(</span>ExportFormat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">export</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Exporting to </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">format</span><span class="token punctuation">&#125;</span></span><span class="token string"> format"</span></span>

<span class="token keyword">class</span> <span class="token class-name">PNGExporter</span><span class="token punctuation">(</span>ExportFormat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">export</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Exporting to </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">format</span><span class="token punctuation">&#125;</span></span><span class="token string"> format"</span></span>
    
    
<span class="token comment"># 抽象工厂</span>
<span class="token keyword">class</span> <span class="token class-name">GraphicFactory</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">create_render_engine</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> RenderEngine<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">create_export_format</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> ExportFormat<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
<span class="token comment"># 具体工厂    </span>
<span class="token keyword">class</span> <span class="token class-name">OpenGLFactory</span><span class="token punctuation">(</span>GraphicFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create_render_engine</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> RenderEngine<span class="token punctuation">:</span>
        <span class="token keyword">return</span> OpenGL<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_export_format</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> ExportFormat<span class="token punctuation">:</span>
        <span class="token keyword">return</span> SVGExporter<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DirectXFactory</span><span class="token punctuation">(</span>GraphicFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create_render_engine</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> RenderEngine<span class="token punctuation">:</span>
        <span class="token keyword">return</span> DirectX<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_export_format</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> ExportFormat<span class="token punctuation">:</span>
        <span class="token keyword">return</span> PNGExporter<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
<span class="token comment"># 客户端</span>
<span class="token keyword">def</span> <span class="token function">client_code</span><span class="token punctuation">(</span>factory<span class="token punctuation">:</span> GraphicFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    render_engine <span class="token operator">=</span> factory<span class="token punctuation">.</span>create_render_engine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    export_format <span class="token operator">=</span> factory<span class="token punctuation">.</span>create_export_format<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>render_engine<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>export_format<span class="token punctuation">.</span>export<span class="token punctuation">(</span><span class="token string">"SVG"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>

    <span class="token comment"># 使用示例</span>
    opengl_factory <span class="token operator">=</span> OpenGLFactory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client_code<span class="token punctuation">(</span>opengl_factory<span class="token punctuation">)</span>

    directx_factory <span class="token operator">=</span> DirectXFactory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client_code<span class="token punctuation">(</span>directx_factory<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="16-命令模式"><a class="markdownIt-Anchor" href="#16-命令模式"></a> 16. 命令模式</h1>
<h2 id="161-基本概念"><a class="markdownIt-Anchor" href="#161-基本概念"></a> 16.1 基本概念</h2>
<ol>
<li>
<p>Command Pattern：将请求（命令）封装成一个对象，实现请求发送者和执行者（接受者）之间进行解耦</p>
</li>
<li>
<p>四要素：</p>
<ul>
<li><strong>命令（Command）</strong>：定义命令。</li>
<li><strong>接收者（Receiver）</strong>：接收并执行该命令。</li>
<li><strong>调用者（Invoker）</strong>：接收来自用户的命令，与用户进行交互。</li>
<li><strong>用户（Client）</strong>：命令的发送者</li>
</ul>
</li>
<li>
<p>宏命令</p>
<p>理解为组合命令即可</p>
</li>
</ol>
<h2 id="162-代码框架"><a class="markdownIt-Anchor" href="#162-代码框架"></a> 16.2 代码框架</h2>
<h3 id="1621-简单版"><a class="markdownIt-Anchor" href="#1621-简单版"></a> 16.2.1 简单版</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token comment"># define the command interface and the receiver interface</span>
<span class="token keyword">class</span> <span class="token class-name">CommandBase</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">ReceiverBase</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token comment"># define the concrete command and receiver</span>
<span class="token keyword">class</span> <span class="token class-name">ChatCommand</span><span class="token punctuation">(</span>CommandBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chat<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>chat <span class="token operator">=</span> chat
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">ChatReceiver</span><span class="token punctuation">(</span>ReceiverBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ChatReceiver: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Invoker</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>command <span class="token operator">=</span> <span class="token boolean">None</span>
        
    <span class="token keyword">def</span> <span class="token function">set_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">,</span> receiver<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># bind the command with the receiver</span>
        <span class="token keyword">if</span> <span class="token string">"chat"</span> <span class="token keyword">in</span> command<span class="token punctuation">:</span>
            receiver <span class="token operator">=</span> ChatReceiver<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> receiver <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> receiver
            command <span class="token operator">=</span> ChatCommand<span class="token punctuation">(</span>receiver<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>command <span class="token operator">=</span> command
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>command<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    invoker <span class="token operator">=</span> Invoker<span class="token punctuation">(</span><span class="token punctuation">)</span>
    invoker<span class="token punctuation">.</span>set_command<span class="token punctuation">(</span><span class="token string">"chat"</span><span class="token punctuation">)</span>
    invoker<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1622-宏命令版"><a class="markdownIt-Anchor" href="#1622-宏命令版"></a> 16.2.2 宏命令版</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># omit the CommandBase, ReceiverBase, ChatCommand, ChatReceiver</span>
 
<span class="token comment"># define the concrete command and receiver</span>
<span class="token keyword">class</span> <span class="token class-name">CookCommand</span><span class="token punctuation">(</span>CommandBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chat<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>chat <span class="token operator">=</span> chat
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token string">'Cooking'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">CookReceiver</span><span class="token punctuation">(</span>ReceiverBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"CookReceiver: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># macro command</span>
<span class="token keyword">class</span> <span class="token class-name">MacroCommand</span><span class="token punctuation">(</span>CommandBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> commands<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>commands <span class="token operator">=</span> commands
        
    <span class="token keyword">def</span> <span class="token function">add_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>commands<span class="token punctuation">.</span>append<span class="token punctuation">(</span>command<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">remove_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>commands<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>command<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> command <span class="token keyword">in</span> self<span class="token punctuation">.</span>commands<span class="token punctuation">:</span>
            command<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Invoker</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>command <span class="token operator">=</span> <span class="token boolean">None</span>
        
    <span class="token keyword">def</span> <span class="token function">set_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">,</span> receiver<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># bind the command with the receiver</span>
        <span class="token keyword">if</span> <span class="token string">"chat"</span> <span class="token operator">==</span> command<span class="token punctuation">:</span>
            receiver <span class="token operator">=</span> ChatReceiver<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> receiver <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> receiver
            command <span class="token operator">=</span> ChatCommand<span class="token punctuation">(</span>receiver<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token string">"cook&amp;chat"</span> <span class="token operator">==</span> command<span class="token punctuation">:</span>
            cook_receiver <span class="token operator">=</span> CookReceiver<span class="token punctuation">(</span><span class="token punctuation">)</span>
            chat_receiver <span class="token operator">=</span> ChatReceiver<span class="token punctuation">(</span><span class="token punctuation">)</span>
            command <span class="token operator">=</span> MacroCommand<span class="token punctuation">(</span><span class="token punctuation">[</span>CookCommand<span class="token punctuation">(</span>chat_receiver<span class="token punctuation">)</span><span class="token punctuation">,</span> ChatCommand<span class="token punctuation">(</span>chat_receiver<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>command <span class="token operator">=</span> command
        
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>command<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    invoker <span class="token operator">=</span> Invoker<span class="token punctuation">(</span><span class="token punctuation">)</span>
    invoker<span class="token punctuation">.</span>set_command<span class="token punctuation">(</span><span class="token string">"chat"</span><span class="token punctuation">)</span>
    invoker<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="17-备忘模式"><a class="markdownIt-Anchor" href="#17-备忘模式"></a> 17. 备忘模式</h1>
<h2 id="171-基本概念"><a class="markdownIt-Anchor" href="#171-基本概念"></a> 17.1 基本概念</h2>
<ol>
<li>
<p>Memento Pattern：用于捕获一个对象的内部状态，并在不破坏封装性的前提下，将这些状态存储起来，以便之后可以恢复到之前的状态</p>
<ul>
<li>针对有需要包保存/回复状态的框架，如快照，数据回滚等</li>
</ul>
</li>
<li>
<p>三要素：</p>
<ul>
<li><strong>Originator（原始发起者）</strong>：这个类负责<strong>创建</strong>一个备忘录来记录它的内部状态。当需要<strong>恢复</strong>状态的时候，它会从备忘录中获取信息。</li>
<li><strong>Memento（备忘录）</strong>：这个对象用来<strong>存储</strong>发起者的内部状态。
<ul>
<li>可备份一组属性</li>
</ul>
</li>
<li><strong>Caretaker（管理者）</strong>：这个类用来<strong>管理</strong>备忘录对象。
<ul>
<li>可管理多个备忘录</li>
</ul>
</li>
</ul>
</li>
<li>
<p>三要素之间的关系：</p>
<ul>
<li>Memento只负责存储状态</li>
<li>Originator负责创建memento和从memento中恢复的两个动作实现</li>
<li>memento创建后的管理，以及恢复时向originator提供目标memento，由Caretaker负责</li>
</ul>
<p>此时满足了“<strong>职责分离</strong>”原则</p>
</li>
</ol>
<h2 id="172-代码框架"><a class="markdownIt-Anchor" href="#172-代码框架"></a> 17.2 代码框架</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy

<span class="token keyword">class</span> <span class="token class-name">Memento</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_state</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_state<span class="token punctuation">)</span>
    

<span class="token keyword">class</span> <span class="token class-name">Originator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># do something to change the state</span>
    <span class="token keyword">def</span> <span class="token function">set_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> state

    <span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Memento<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">restore</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> memento<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_state <span class="token operator">=</span> memento<span class="token punctuation">.</span>get_state<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Caretaker</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># use a dict when you want to save multiple originator states</span>
        self<span class="token punctuation">.</span>_mementos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add_memento</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> memento<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_mementos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>memento<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_memento</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_mementos<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    originator <span class="token operator">=</span> Originator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    caretaker <span class="token operator">=</span> Caretaker<span class="token punctuation">(</span><span class="token punctuation">)</span>

    originator<span class="token punctuation">.</span>set_state<span class="token punctuation">(</span><span class="token string">"state1"</span><span class="token punctuation">)</span>

    <span class="token comment"># save the state</span>
    caretaker<span class="token punctuation">.</span>add_memento<span class="token punctuation">(</span>originator<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span>_state<span class="token punctuation">)</span>

    <span class="token comment"># restore the state</span>
    originator<span class="token punctuation">.</span>restore<span class="token punctuation">(</span>caretaker<span class="token punctuation">.</span>get_memento<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span>_state<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="18-享元模式"><a class="markdownIt-Anchor" href="#18-享元模式"></a> 18. 享元模式</h1>
<h2 id="181-基础概念"><a class="markdownIt-Anchor" href="#181-基础概念"></a> 18.1 基础概念</h2>
<ol>
<li>
<p>Flyweight Pattern，能共享的对象是轻量级（细粒度的）的（因为需要共享）</p>
</li>
<li>
<p><strong>对于可共享的对象而言，状态分为两种</strong></p>
<ul>
<li>内部状态（Intrinsic State）：可以共享的，存在对象内部的，不会随环境而改变的</li>
<li>外部状态（Extrinsic State）：每个对象独有的，存在外部的，随环境而改变</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Colour</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> colour<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Intrinsic State</span>
        self<span class="token punctuation">.</span>_colour <span class="token operator">=</span> colour
        
    <span class="token keyword">def</span> <span class="token function">print_with_colour</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># text is Extrinsic State</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>_colour<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>text<span class="token punctuation">&#125;</span></span><span class="token string">\033[0m"</span></span><span class="token punctuation">)</span>
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    red <span class="token operator">=</span> Colour<span class="token punctuation">(</span><span class="token string">"\033[31m"</span><span class="token punctuation">)</span>
    red<span class="token punctuation">.</span>print_with_colour<span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>享元工厂（FlyweightFactory），理解成字典工厂即可</p>
<ul>
<li>负责管理享元对象</li>
</ul>
</li>
</ol>
<h2 id="182-代码框架"><a class="markdownIt-Anchor" href="#182-代码框架"></a> 18.2 代码框架</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Flyweight</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> intrinsic_state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>__intrinsic_state <span class="token operator">=</span> intrinsic_state

    <span class="token keyword">def</span> <span class="token function">operation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> extrinsic_state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Intrinsic state: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>__intrinsic_state<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Extrinsic state: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>extrinsic_state<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">FlyweightFactory</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>__flyweights <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">def</span> <span class="token function">get_flyweight</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> intrinsic_state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> intrinsic_state <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>__flyweights<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>__flyweights<span class="token punctuation">[</span>intrinsic_state<span class="token punctuation">]</span> <span class="token operator">=</span> Flyweight<span class="token punctuation">(</span>intrinsic_state<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__flyweights<span class="token punctuation">[</span>intrinsic_state<span class="token punctuation">]</span>
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    factory <span class="token operator">=</span> FlyweightFactory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flyweight <span class="token operator">=</span> factory<span class="token punctuation">.</span>get_flyweight<span class="token punctuation">(</span><span class="token string">'intrinsic state'</span><span class="token punctuation">)</span>
    flyweight<span class="token punctuation">.</span>operation<span class="token punctuation">(</span><span class="token string">'extrinsic state'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="19-访问模式"><a class="markdownIt-Anchor" href="#19-访问模式"></a> 19. 访问模式</h1>
<h2 id="191-基础概念"><a class="markdownIt-Anchor" href="#191-基础概念"></a> 19.1 基础概念</h2>
<ol>
<li>Visitor Pattern，将数据结构和操作（算法）解耦。可在不改变数据结构的前提下，增加新操作。</li>
<li>三要素：
<ul>
<li>访问者 Visitor：操作</li>
<li>数据节点 DataNode：数据对象</li>
<li>对象结构 ObjectStructure：数据对象的容器</li>
</ul>
</li>
</ol>
<h2 id="192-代码框架"><a class="markdownIt-Anchor" href="#192-代码框架"></a> 19.2 代码框架</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token keyword">class</span> <span class="token class-name">DataNode</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">Visitor</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">ChatNode</span><span class="token punctuation">(</span>DataNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        visitor<span class="token punctuation">.</span>visit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">CookNode</span><span class="token punctuation">(</span>DataNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        visitor<span class="token punctuation">.</span>visit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">ChatVisitor</span><span class="token punctuation">(</span>Visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ChatVisitor visiting </span><span class="token interpolation"><span class="token punctuation">&#123;</span>node<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">ObjectStructure</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>node<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> node <span class="token keyword">in</span> self<span class="token punctuation">.</span>nodes<span class="token punctuation">:</span>
            node<span class="token punctuation">.</span>accept<span class="token punctuation">(</span>visitor<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    chat <span class="token operator">=</span> ChatNode<span class="token punctuation">(</span><span class="token string">"chat"</span><span class="token punctuation">)</span>
    cook <span class="token operator">=</span> CookNode<span class="token punctuation">(</span><span class="token string">"cook"</span><span class="token punctuation">)</span>

    object_structure <span class="token operator">=</span> ObjectStructure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    object_structure<span class="token punctuation">.</span>add_node<span class="token punctuation">(</span>chat<span class="token punctuation">)</span>
    object_structure<span class="token punctuation">.</span>add_node<span class="token punctuation">(</span>cook<span class="token punctuation">)</span>

    chat_visitor <span class="token operator">=</span> ChatVisitor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    object_structure<span class="token punctuation">.</span>visit<span class="token punctuation">(</span>chat_visitor<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>注意</strong>：依靠访问模式，可实现双分派。未曾见到实际使用案例。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DataNode</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># 通过调用访问者的哪个visit方法，实现第二次分派</span>
        visitor<span class="token punctuation">.</span>visit_a<span class="token punctuation">(</span>self<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Visitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">visit_a</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">visit_b</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">ObjectStructure</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>node<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 通过调用哪个node的accept方法，实现第一次分派</span>
        self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="20-模板模式"><a class="markdownIt-Anchor" href="#20-模板模式"></a> 20 模板模式</h1>
<ol>
<li>
<p>模板模式（Template Method Pattern）：定义了一个算法的骨架，而将一些步骤延迟到子类中实现。</p>
<ul>
<li>先写抽象基类，其中定义关键接口</li>
<li>后写继承自基类的具体实现</li>
</ul>
<p>抽象积累为后续的所有实现，定义了统一的接口</p>
</li>
</ol>
<h1 id="21-桥接模式"><a class="markdownIt-Anchor" href="#21-桥接模式"></a> 21 桥接模式</h1>
<h2 id="211-基本概念"><a class="markdownIt-Anchor" href="#211-基本概念"></a> 21.1 基本概念</h2>
<ol>
<li>
<p>Bridge Pattern：抽象和实现分离，使两者可独立变化。</p>
<p>这个定义就很抽象，甚至误导。</p>
</li>
<li>
<p>实操上是</p>
<ul>
<li>先把代码框架<strong>按模块和层级</strong>划分好</li>
<li>并且用抽象基类把这个框架搭起来，把重要的接口定义好</li>
</ul>
<p>桥接模式的定义和抽象基类代码框架的概念上的关系是</p>
<ul>
<li>抽象：最大（最外层）的那个抽象基类</li>
<li>实现：最大的抽象基类的子模块（尽管也是抽象基类）</li>
</ul>
</li>
<li>
<p>适用：推荐复杂代码框架都这么干</p>
</li>
</ol>
<h2 id="212-代码样例"><a class="markdownIt-Anchor" href="#212-代码样例"></a> 21.2 代码样例</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token keyword">class</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">apply_color</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">Red</span><span class="token punctuation">(</span>Color<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">apply_color</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Red color"</span>

<span class="token keyword">class</span> <span class="token class-name">Green</span><span class="token punctuation">(</span>Color<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">apply_color</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Green color"</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span>Shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_color <span class="token operator">=</span> color

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Drawing </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>_color<span class="token punctuation">.</span>apply_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> circle"</span></span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">(</span>Shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_color <span class="token operator">=</span> color

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Drawing </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>_color<span class="token punctuation">.</span>apply_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> square"</span></span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    red_color <span class="token operator">=</span> Red<span class="token punctuation">(</span><span class="token punctuation">)</span>
    green_color <span class="token operator">=</span> Green<span class="token punctuation">(</span><span class="token punctuation">)</span>

    red_circle <span class="token operator">=</span> Circle<span class="token punctuation">(</span>red_color<span class="token punctuation">)</span>
    red_square <span class="token operator">=</span> Square<span class="token punctuation">(</span>red_color<span class="token punctuation">)</span>

    green_circle <span class="token operator">=</span> Circle<span class="token punctuation">(</span>green_color<span class="token punctuation">)</span>
    green_square <span class="token operator">=</span> Square<span class="token punctuation">(</span>green_color<span class="token punctuation">)</span>

    red_circle<span class="token punctuation">.</span>draw<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: Drawing Red color circle</span>
    red_square<span class="token punctuation">.</span>draw<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: Drawing Red color square</span>
    green_circle<span class="token punctuation">.</span>draw<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: Drawing Green color circle</span>
    green_square<span class="token punctuation">.</span>draw<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: Drawing Green color square</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于桥接模式定义而言，shape是抽象，Color是实现</p>
<h1 id="22-解释模式"><a class="markdownIt-Anchor" href="#22-解释模式"></a> 22 解释模式</h1>
<ol>
<li>
<p>Interpreter Pattern：用于处理语言语法或表达式的解析问题</p>
</li>
<li>
<p>四要素：</p>
<ul>
<li><strong>Abstract Expression (抽象表达式)</strong>：抽象类或接口，定义接口 <code>interpret()</code>。</li>
<li><strong>Terminal Expression (终结符表达式)</strong>：语法中最小的单元逻辑</li>
<li><strong>Non-terminal Expression (非终结符表达式)</strong>：语法中每一条规则对应一个非终结符表达式</li>
<li><strong>Context (上下文)</strong>：包含外部信息或数据，这些信息或数据可能会影响表达式的解释。</li>
</ul>
<p>对于<code>a + b + c</code>而言，<code>a</code>就是终结符表达式，<code>+</code>就是非终结符表达式，在解析该字符串含义时产生的中间信息，保存在上下文中</p>
</li>
<li>
<p>除非要自己构建某种语法，否则这种模式用不上</p>
</li>
</ol>
<h1 id="附录a分派"><a class="markdownIt-Anchor" href="#附录a分派"></a> 附录A：分派</h1>
<h2 id="a1-概念"><a class="markdownIt-Anchor" href="#a1-概念"></a> A.1 概念</h2>
<p>（<strong>此处为根据网上资料汇总得到，有待查证</strong>）</p>
<ol>
<li>
<p>多态（Polymorphism，java中似乎翻译成宗量）依赖分派（Dispatch）实现</p>
<ul>
<li>分派：是选择并执行一个方法的过程（选哪个函数执行）</li>
</ul>
</li>
<li>
<p>分派类型可按以下角度进行划分</p>
<ul>
<li>分派时间：静态分派（Static Dispatch），动态分派（Dynamic Dispatch）</li>
<li>分派依据：单分派（Single Dispatch），多分派（Multiple Dispatch）</li>
</ul>
</li>
<li>
<p>静态分派：在编译期确定调用哪个方法</p>
<ul>
<li>例如，C++中函数重载（Overload），根据不同参数类型和数量进行分派</li>
</ul>
</li>
<li>
<p>动态分派：在运行期确定调用哪个方法</p>
<ul>
<li>例如，C++中虚函数的重写（Override），根据对象的实际类型来分派</li>
</ul>
</li>
<li>
<p>单分派：根据一个参数类型（通常是接受者类型）来分派</p>
</li>
<li>
<p>多分派：根据多个参数类型来分派</p>
<ul>
<li>Common Lisp 或者 Haskell 某些语言的特性</li>
<li>似乎特指<strong>运行时</strong>，否则C<ins>应该也算多分派了，通常认为C</ins>是单分派</li>
</ul>
<p>C++中的重载支持静态多分派，而虚函数支持动态单分派</p>
</li>
</ol>
<h2 id="a2-python与分派"><a class="markdownIt-Anchor" href="#a2-python与分派"></a> A.2 Python与分派</h2>
<p>在python中讨论分派，意义是不大的</p>
<h3 id="a21-单分派"><a class="markdownIt-Anchor" href="#a21-单分派"></a> A.2.1 单分派</h3>
<p>实现python函数重载</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> functools <span class="token keyword">import</span> singledispatch

<span class="token decorator annotation punctuation">@singledispatch</span>
<span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string">"Unsupported type"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@process<span class="token punctuation">.</span>register</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing integer: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>arg<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@process<span class="token punctuation">.</span>register</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing string: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>arg<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 测试</span>
process<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>      <span class="token comment"># 输出: Processing integer: 5</span>
process<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token comment"># 输出: Processing string: hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="a22-动态多分派"><a class="markdownIt-Anchor" href="#a22-动态多分派"></a> A.2.2 （动态）多分派</h3>
<p>使用第三方库</p>
<pre class="line-numbers language-none"><code class="language-none">pip install multipledispatch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multipledispatch <span class="token keyword">import</span> dispatch

<span class="token decorator annotation punctuation">@dispatch</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Adding two integers: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">&#125;</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>a <span class="token operator">+</span> b<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@dispatch</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Concatenating strings: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">&#125;</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>a <span class="token operator">+</span> b<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 测试</span>
add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>      <span class="token comment"># 输出: Adding two integers: 5 + 3 = 8</span>
add<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">" world"</span><span class="token punctuation">)</span> <span class="token comment"># 输出: Concatenating strings: hello +  世界 = hello world</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="附录bpython中的copy"><a class="markdownIt-Anchor" href="#附录bpython中的copy"></a> 附录B：Python中的copy</h1>
<ol>
<li>python官方关于copy的解释：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/copy.html">https://docs.python.org/zh-cn/3/library/copy.html</a></li>
</ol>
<h2 id="b1-浅拷贝"><a class="markdownIt-Anchor" href="#b1-浅拷贝"></a> B.1 浅拷贝</h2>
<ol>
<li>
<p>浅拷贝 (Shallow Copy)</p>
<ul>
<li>会创建一个新对象，并**<mark>将原对象的引用插入到新对象中</mark>**（核心点）。</li>
<li>对于不可变类型（如字符串、数字等），这意味着新旧对象中的这些值是完全独立的；</li>
<li>但对于<strong>可变类型</strong>（如列表、字典等），<strong>原始对象的改变会影响浅拷贝的对象，因为它们共享相同的元素</strong>。
<ul>
<li>类也在此情况中</li>
</ul>
</li>
</ul>
</li>
<li>
<p>可变类型的样例</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> copy <span class="token keyword">import</span> copy<span class="token punctuation">,</span> deepcopy

original_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
shallow_copied_list <span class="token operator">=</span> copy<span class="token punctuation">(</span>original_list<span class="token punctuation">)</span>

<span class="token comment"># 情况1：修改原始列表中的子列表</span>
original_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Original List:"</span><span class="token punctuation">,</span> original_list<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Shallow Copied List:"</span><span class="token punctuation">,</span> shallow_copied_list<span class="token punctuation">)</span>

<span class="token comment"># 情况2: 修改原始列表</span>
original_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Original List:"</span><span class="token punctuation">,</span> original_list<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Shallow Copied List:"</span><span class="token punctuation">,</span> shallow_copied_list<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre class="line-numbers language-none"><code class="language-none">Original List: [[1, 2, 5], [3, 4]]
Shallow Copied List: [[1, 2, 5], [3, 4]]
Original List: [[1, 2, 5], [3, 4], [6, 7]]
Shallow Copied List: [[1, 2, 5], [3, 4]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>类的浅拷贝</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> copy <span class="token keyword">import</span> copy<span class="token punctuation">,</span> deepcopy

<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>li <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
        
        
a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> copy<span class="token punctuation">(</span>a<span class="token punctuation">)</span>

b<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span>
b<span class="token punctuation">.</span>li<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>li<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">1
[4, 2, 3]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ol>
<h2 id="b2-深拷贝"><a class="markdownIt-Anchor" href="#b2-深拷贝"></a> B.2 深拷贝</h2>
<ol>
<li>
<p>Deep Copy</p>
<ul>
<li>不仅会创建新对象，还会<strong>递归地拷贝所有嵌套的对象</strong>。</li>
</ul>
<p>这样，<strong>新对象就完全独立于原对象</strong>，对新对象所做的任何修改都不会影响到原对象。</p>
</li>
</ol>
<h1 id="附录c-设计模式的分类"><a class="markdownIt-Anchor" href="#附录c-设计模式的分类"></a> 附录C: 设计模式的分类</h1>
<h2 id="c1-行为型模式"><a class="markdownIt-Anchor" href="#c1-行为型模式"></a> C.1 行为型模式</h2>
<p>这类模式关注的是算法与对象间的基本行为。它们帮助定义对象之间的责任分配，或者如何进行通信。</p>
<ul>
<li>模板方法模式（Template Method）</li>
<li>命令模式（Command）</li>
<li>责任链模式（Chain of Responsibility）</li>
<li>解释器模式（Interpreter）</li>
<li>迭代器模式（Iterator）</li>
<li>中介者模式（Mediator）</li>
<li>备忘录模式（Memento）</li>
<li>观察者模式（Observer）</li>
<li>状态模式（State）</li>
<li>策略模式（Strategy）</li>
<li>访问者模式（Visitor）</li>
</ul>
<h2 id="c2-结构型模式"><a class="markdownIt-Anchor" href="#c2-结构型模式"></a> C.2 结构型模式</h2>
<p>这些模式关注于简化系统的设计通过提供一个简单的接口来掩盖复杂的子系统。它们通常处理类或对象的组合，并且经常用于创建更灵活的类结构。</p>
<ul>
<li>适配器模式（Adapter）</li>
<li>桥接模式（Bridge）</li>
<li>组合模式（Composite）</li>
<li>装饰模式（Decorator）</li>
<li>外观模式（Facade）</li>
<li>享元模式（Flyweight）</li>
<li>代理模式（Proxy）</li>
</ul>
<h2 id="c3-创建型模式"><a class="markdownIt-Anchor" href="#c3-创建型模式"></a> C.3 创建型模式</h2>
<p>这类模式提供了一种在创建对象时隐藏创建逻辑的方式，而不是使用直接的对象实例化。它们帮助将对象的创建与其使用解耦。</p>
<ul>
<li>单例模式（Singleton）</li>
<li>原型模式（Prototype）: 克隆模式</li>
<li>工厂方法模式（Factory Method）：第15.2节</li>
<li>抽象工厂模式（Abstract Factory）：第15.3节</li>
<li>构建者模式（Builder）</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer"><div class="post-widgets">
      <div id="needsharebutton-postbottom">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    </div>
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>小王同学
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://a171232886.github.io/2024/10/09/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="23种经典设计模式">https://a171232886.github.io/2024/10/09/设计模式/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/02/08/frp%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/" rel="prev" title="frp服务搭建">
                  <i class="fa fa-chevron-left"></i> frp服务搭建
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小王同学</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>




<div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("12/1/2021 00:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
</div>


<!-- 引入Mermaid -->
<script src="https://unpkg.com/mermaid@latest/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: true,
    // 这里可以设置Mermaid的一些选项
  });
</script>
    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.10/dist/mermaid.min.js","integrity":"sha256-CmZCFVnvol9YL23PfjDflGY5nJwE+Mf/JN+8v+tD/34="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha256-94CNZ/bJtwrBYZrXhCOBvpB4rZUzBnvAsirFv31TMGo=" crossorigin="anonymous">



  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script>
  <script>
      pbOptions = {};
        pbOptions.iconStyle = "default";
        pbOptions.boxForm = "horizontal";
        pbOptions.position = "bottomCenter";
        pbOptions.networks = "Wechat,QQZone,Weibo,Douban,Twitter,Facebook";
      new needShareButton('#needsharebutton-postbottom', pbOptions);
  </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"a171232886","repo":"a171232886.github.io","client_id":"7db126fef08edb747111","client_secret":"10b3181737137f93813d578729875281ac61edd9","admin_user":"a171232886","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"80ee0b7e476ff29c4336e2a5416e7075"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div id="moon-menu-item-back2bottom" class="moon-menu-item">
      <i class='fas fa-chevron-down'></i>    </div>
    
    <div id="moon-menu-item-back2top" class="moon-menu-item">
      <i class='fas fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
</body>
</html>
