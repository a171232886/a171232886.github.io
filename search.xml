<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Bibtex格式类型</title>
    <url>/2021/09/09/Bibtex%E6%A0%BC%E5%BC%8F%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<p>出于保留资源和查找方便，转载自https://blog.csdn.net/kmsj0x00/article/details/85318057</p>
<span id="more"></span>
<table><thead><tr><th>类型</th><th>简介</th><th>必需关键字</th><th>可省略关键字</th></tr></thead><tbody><tr><td>@article</td><td>期刊或杂志上的一篇文章。</td><td>author, title, journal, year.</td><td>volume, number, pages, month, note.</td></tr><tr><td>@book</td><td>有确定出版社的书籍。</td><td>author或editor, title, publisher, year.</td><td>volume或number, series, address, edition, month, note.</td></tr><tr><td>@booklet</td><td>印制的有封皮的作品，但没有出版社或赞助机构的名称。</td><td>title.</td><td>author, howpublished, address, month, year, note.</td></tr><tr><td>@inbook</td><td>一本书的一部分(章，节或某些页)。</td><td>author或editor, title, chapter和/或pages, publisher,year.</td><td>volume或number, series, type, address, edition, month, note.</td></tr><tr><td>@incollection</td><td>一本书中有自己题目的一部分。</td><td>author, title, booktitle, publisher, year.</td><td>editor, volume或number, series, type, chapter, pages, address, edition, month, note.</td></tr><tr><td>@conference/@inproceedings</td><td>会议论文集中的一篇文章。</td><td>author, title, booktitle, year.</td><td>editor, volume或number, series, pages, address, month, organization, publisher, note.</td></tr><tr><td>@manual</td><td>科技文档。</td><td>title.</td><td>author, organization, address, edition, month, year, note.</td></tr><tr><td>@mastersthesis</td><td>硕士论文。</td><td>author, title, school, year.</td><td>type, address, month, note.</td></tr><tr><td>@misc</td><td>不属于其它任何类型的作品。</td><td>没有。</td><td>author, title, howpublished, month, year, note.</td></tr><tr><td>@phdthesis</td><td>博士论文。</td><td>author, title, school, year.</td><td>type, address, month, note.</td></tr><tr><td>@proceedings</td><td>会议论文集。</td><td>title, year.</td><td>editor,volume或number, series, address, month, organization, publisher, note.</td></tr><tr><td>@techreport</td><td>学校或其它研究机构印制的报告。</td><td>author, title, institution, year.</td><td>type, number, address, month, note.</td></tr><tr><td>@unpublished</td><td>有作者和标题的还未出版的作品。</td><td>author, title, note.</td><td>month, year.</td></tr></tbody></table>
]]></content>
      <categories>
        <category>笔记</category>
        <category>LaTex和Markdown</category>
      </categories>
  </entry>
  <entry>
    <title>CNN中感受野的计算</title>
    <url>/2021/11/23/CNN%E4%B8%AD%E6%84%9F%E5%8F%97%E9%87%8E%E7%9A%84%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<h1 id="概念"><a class="markdownIt-Anchor" href="#概念"></a> 概念</h1>
<p>感受野 (receptive field, RF)是卷积神经网络每一层输出的特征图上的像素点在<strong>原始图像</strong>上映射的区域大小。</p>
<p>在网上看到了一张很好的图，可以表示整个关系。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/124ac2bdd2674529aed1c51fb6a454a3.png" width="80%"> 
<p><a href="https://www.cnblogs.com/objectDetect/p/5947169.html">图片来源</a></p>
</div> 
<p>注意：计算感受野大小时，忽略了图像边缘的影响，即<strong>不考虑padding的大小</strong>。</p>
<span id="more"></span>
<h1 id="计算公式"><a class="markdownIt-Anchor" href="#计算公式"></a> 计算公式</h1>
<p>第k层的的感受野：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>l</mi><mi>i</mi></msub><mo>=</mo><msub><mi>l</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mo stretchy="false">(</mo><munderover><mo>∏</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></munderover><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{l_i}={l_{i-1}} + (\prod_{n = 1}^{i - 1} s_n )( {k_i}-1 )
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.267113em;"></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8116690000000004em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>层卷积核大小，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">s_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示步长。<strong>注意连乘中只到<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，不包含<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></strong>。</p>
<p>做一道题</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/8ab1b767797a460db1ccfcbbe59810a6.png" width="80%"> 
</div> 
<p>可以得到</p>
<table>
<thead>
<tr>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></th>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k_i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></th>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></th>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>l</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">l_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">-</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">1</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">2</td>
<td style="text-align:center">1</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">10</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">2</td>
<td style="text-align:center">1</td>
<td style="text-align:center">18</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">2</td>
<td style="text-align:center">1</td>
<td style="text-align:center">26</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">30</td>
</tr>
</tbody>
</table>
<p>这里边把输入看做第0层，第0层的感受野为1。<strong>并将池化层等同卷积层处理。</strong></p>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://www.cnblogs.com/objectDetect/p/5947169.html">卷积神经网络物体检测之感受野大小计算</a></li>
<li><a href="https://arxiv.org/abs/1603.07285">A guide to convolution arithmetic for deep learning</a></li>
<li><a href="http://shawnleezx.github.io/blog/2017/02/11/calculating-receptive-field-of-cnn/">Calculating Receptive Field of CNN</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>CSDN和Typora的Markdown插入思维导图</title>
    <url>/2022/02/05/CSDN%E5%92%8CTypora%E7%9A%84Mlarkdown%E6%8F%92%E5%85%A5%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>因为打算使用Markdown做笔记，想找一种方法可在Markdown中插入思维导图。这种方法必须满足三点：（1）免费（2）简单（3）插入导图可编辑。网上一通找，在见到各种千奇百怪的方法之后，看见人家Typora官方给出了方法，而CSDN的帮助文档也有简单教程插入Mermaid流程图。<mark>按照<a href="https://support.typora.io/Draw-Diagrams-With-Markdown/">Typora官方的方法</a>，在CSDN上测试发现基本没问题</mark>。于是，我把它翻译成中文放在这里，示例代码已经过改良。</p>
<p>想直接看思维导图的，直接看目录中的<code>另一种Flowcharts</code>即可。</p>
<span id="more"></span>
<h1 id="在markdown中画流程图"><a class="markdownIt-Anchor" href="#在markdown中画流程图"></a> 在Markdown中画（流程）图</h1>
<p>Typora集成了几种画（流程）图的方法，在设置中启用即可。但Typora仍推荐使用插入图片的方法插流程图。因为Markdown像其他格式文件转换可能会出现问题。（但我们就用Markdown，所以这个问题不存在。）</p>
<h1 id="mermaid插件"><a class="markdownIt-Anchor" href="#mermaid插件"></a> Mermaid插件</h1>
<p><a href="https://mermaid-js.github.io/mermaid/#/">Mermaid官网</a>除了Sequence图和Flowcharts两种，还支持Gantt图，class图，state图和饼图。</p>
<h2 id="sequence-diagramsuml图"><a class="markdownIt-Anchor" href="#sequence-diagramsuml图"></a> Sequence Diagrams（UML图）</h2>
<p>使用了<a href="https://bramp.github.io/js-sequence-diagrams/">js-sequence</a>，按照代码生成一个渲染后的图表。CSDN和Typora可直接使用。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sequenceDiagram
Alice-<span class="token operator">>></span>Bob: Hello Bob, how are you?
Note right of Bob: Bob thinks
Bob--<span class="token operator">>></span>Alice: I am good thanks<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">sequenceDiagram
Alice->>Bob: Hello Bob, how are you?
Note right of Bob: Bob thinks
Bob-->>Alice: I am good thanks!</pre>
<h2 id="flowcharts"><a class="markdownIt-Anchor" href="#flowcharts"></a> Flowcharts</h2>
<p>使用<a href="http://flowchart.js.org/">flowchart.js</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">flowchat
<span class="token assign-left variable">st</span><span class="token operator">=</span><span class="token operator">></span>start: Start
<span class="token assign-left variable">op</span><span class="token operator">=</span><span class="token operator">></span>operation: Your Operation
<span class="token assign-left variable">cond</span><span class="token operator">=</span><span class="token operator">></span>condition: Yes or No?
<span class="token assign-left variable">e</span><span class="token operator">=</span><span class="token operator">></span>end

st-<span class="token operator">></span>op-<span class="token operator">></span>cond
cond<span class="token punctuation">(</span>yes<span class="token punctuation">)</span>-<span class="token operator">></span>e
cond<span class="token punctuation">(</span>no<span class="token punctuation">)</span>-<span class="token operator">></span>op<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>不推荐的原因：CSDN、Typora、Hexo互不相同！</p>
<h2 id="另一种flowcharts"><a class="markdownIt-Anchor" href="#另一种flowcharts"></a> 另一种Flowcharts</h2>
<p><font face="黑体"  color=#FF0000 size=4><strong>个人推荐，可用做思维导图</strong>。</font></p>
<pre class="line-numbers language-Bash" data-language="Bash"><code class="language-Bash">graph LR
A[Hard edge] --&gt;B(Round edge)
B --&gt; C&#123;Decision&#125;
C --&gt;|One| D[Result one]
C --&gt;|Two| E[Result two]
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">	graph LR
	A[Hard edge] -->B(Round edge)
    B --> C{Decision}
    C -->|One| D[Result one]
    C -->|Two| E[Result two]</pre>
<h2 id="gantt图甘特图"><a class="markdownIt-Anchor" href="#gantt图甘特图"></a> Gantt图（甘特图）</h2>
<p>可参考<a href="https://mermaid-js.github.io/mermaid/#/gantt">Gantt diagrams</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gantt
dateFormat  YYYY-MM-DD
title Adding GANTT diagram functionality to mermaid

section A section
Completed task            :done,    des1, <span class="token number">2014</span>-01-06,2014-01-08
Active task               :active,  des2, <span class="token number">2014</span>-01-09, 3d
Future task               <span class="token builtin class-name">:</span>         des3, after des2, 5d
Future task2               <span class="token builtin class-name">:</span>         des4, after des3, 5d

section Critical tasks
Completed task <span class="token keyword">in</span> the critical line :crit, done, <span class="token number">2014</span>-01-06,24h
Implement parser and jison          :crit, done, after des1, 2d
Create tests <span class="token keyword">for</span> parser             :crit, active, 3d
Future task <span class="token keyword">in</span> critical line        :crit, 5d
Create tests <span class="token keyword">for</span> renderer           :2d
Add to mermaid                      :1d

section Documentation
Describe gantt syntax               :active, a1, after des1, 3d
Add gantt diagram to demo page      :after a1  , 20h
Add another diagram to demo page    :doc1, after a1  , 48h

section Last section
Describe gantt syntax               :after doc1, 3d
Add gantt diagram to demo page      <span class="token builtin class-name">:</span> 20h
Add another diagram to demo page    <span class="token builtin class-name">:</span> 48h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">        gantt
        dateFormat  YYYY-MM-DD
        title Adding GANTT diagram functionality to mermaid

        section A section
        Completed task            :done,    des1, 2014-01-06,2014-01-08
        Active task               :active,  des2, 2014-01-09, 3d
        Future task               :         des3, after des2, 5d
        Future task2               :         des4, after des3, 5d

        section Critical tasks
        Completed task in the critical line :crit, done, 2014-01-06,24h
        Implement parser and jison          :crit, done, after des1, 2d
        Create tests for parser             :crit, active, 3d
        Future task in critical line        :crit, 5d
        Create tests for renderer           :2d
        Add to mermaid                      :1d

        section Documentation
        Describe gantt syntax               :active, a1, after des1, 3d
        Add gantt diagram to demo page      :after a1  , 20h
        Add another diagram to demo page    :doc1, after a1  , 48h

        section Last section
        Describe gantt syntax               :after doc1, 3d
        Add gantt diagram to demo page      : 20h
        Add another diagram to demo page    : 48h</pre>
<h2 id="class图类图"><a class="markdownIt-Anchor" href="#class图类图"></a> Class图（类图）</h2>
<p>可参考<a href="https://mermaid-js.github.io/mermaid/#/classDiagram">Class diagrams</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">classDiagram
      Animal <span class="token operator">&lt;</span><span class="token operator">|</span>-- Duck
      Animal <span class="token operator">&lt;</span><span class="token operator">|</span>-- Fish
      Animal <span class="token operator">&lt;</span><span class="token operator">|</span>-- Zebra
   	  Animal <span class="token builtin class-name">:</span> +int age
     	  Animal <span class="token builtin class-name">:</span> +String gender
      Animal: +isMammal<span class="token punctuation">(</span><span class="token punctuation">)</span>
      Animal: +mate<span class="token punctuation">(</span><span class="token punctuation">)</span>
      class Duck<span class="token punctuation">&#123;</span>
          +String beakColor
          +swim<span class="token punctuation">(</span><span class="token punctuation">)</span>
          +quack<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      class Fish<span class="token punctuation">&#123;</span>
          <span class="token parameter variable">-int</span> sizeInFeet
          -canEat<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      class Zebra<span class="token punctuation">&#123;</span>
          +bool is_wild
          +run<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">classDiagram
      Animal <|-- Duck
      Animal <|-- Fish
      Animal <|-- Zebra
      Animal : +int age
      Animal : +String gender
      Animal: +isMammal()
      Animal: +mate()
      class Duck{
          +String beakColor
          +swim()
          +quack()
      }
      class Fish{
          -int sizeInFeet
          -canEat()
      }
      class Zebra{
          +bool is_wild
          +run()
      }</pre>
<h2 id="state-图"><a class="markdownIt-Anchor" href="#state-图"></a> State 图</h2>
<p>这个图CSDN帮助文档中没有引入，但实际上可以生成，只是大小不能控制。此处效果图为Tpyora截图。</p>
<p>而Tpyora(v0.11.18)不支持<code>direction LR</code>选项。</p>
<p>但这个State图如果开发好的话，是比Flowcharts好的。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">stateDiagram
    <span class="token punctuation">[</span>*<span class="token punctuation">]</span> --<span class="token operator">></span> A
    A --<span class="token operator">></span> B
    B --<span class="token operator">></span> C
    
    state B <span class="token punctuation">&#123;</span>
           direction LR
        a --<span class="token operator">></span> b
    <span class="token punctuation">&#125;</span>
    B --<span class="token operator">></span> D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">	stateDiagram
	[*] --> A
	A --> B
	B --> C
	    
	state B {
	    direction LR
	    a --> b
	}
	B --> D</pre>
<h2 id="饼图"><a class="markdownIt-Anchor" href="#饼图"></a> 饼图</h2>
<pre><code><pre class="line-numbers language-none"><code class="language-none">pie
    title Pie Chart
    &quot;Dogs&quot; : 386
    &quot;Cats&quot; : 85
    &quot;Rats&quot; : 150 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre>
<pre class="mermaid">pie
    title Pie Chart
    "Dogs" : 386
    "Cats" : 85
    "Rats" : 150</pre>
<h1 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h1>
<ol>
<li><a href="https://support.typora.io/Draw-Diagrams-With-Markdown/">Typora官方的方法</a></li>
<li><a href="https://mermaid-js.github.io/mermaid/">mermaid</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>LaTex和Markdown</category>
      </categories>
  </entry>
  <entry>
    <title>Git命令上传文件到GitHub</title>
    <url>/2021/11/02/Git%E5%91%BD%E4%BB%A4%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0GitHub/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>好不容易做完一个论文代码，要公开到Github上，此时有两种选择：（1）在GitHub上进行拖拽上传（2）Git命令上传。对于文件数不多的程序可以用拖拽上传，但动辄文件数上百的程序这样显然就不合适，因为每次拖拽上传最大文件数有限制。你总不能直接上传一个压缩包吧，那样也太显示你的水平了。</p>
<span id="more"></span>
<p>这时就要用到Git命令了。尽管Git是一个优秀的版本控制命令，但对于我这种单人小项目并且在固定服务器上运行的程序编写者而言，Git的价值不大。搞一堆Git控制命令，有粘贴复制方便吗，有直接开两个窗口直接对比程序异同直观吗？</p>
<p>因此，Git命令在目前阶段对我最大的用处是上传Github。但这涉及的命令并不简单，探索了一点时间才解决，故在此处整理出来。</p>
<h1 id="前置条件"><a class="markdownIt-Anchor" href="#前置条件"></a> 前置条件</h1>
<ol>
<li>拥有Github账号</li>
<li>此时可以访问Github，（不能访问的别问我怎么办，我也不知道）</li>
<li>安装好了Git软件</li>
</ol>
<p><a href="https://git-scm.com/downloads">官网安装Git</a></p>
<p>Git推荐教程：<a href="https://www.liaoxuefeng.com/wiki/896043488029600/896067074338496">廖雪峰</a></p>
<h1 id="初始化并上传github"><a class="markdownIt-Anchor" href="#初始化并上传github"></a> 初始化并上传Github</h1>
<p>一共三部分，核心9条命令，依次来</p>
<h2 id="第一部分git初始设置"><a class="markdownIt-Anchor" href="#第一部分git初始设置"></a> 第一部分：Git初始设置</h2>
<h3 id="设置本地git用户名"><a class="markdownIt-Anchor" href="#设置本地git用户名"></a> 设置本地Git用户名</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">"Name"</span> 
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">"email@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>例如，Name 和 <a href="mailto:email@example.com">email@example.com</a> 可分别为 twodog 和 <a href="mailto:twodog@qq.com">twodog@qq.com</a></p>
<h3 id="设置和github的ssh传输密钥"><a class="markdownIt-Anchor" href="#设置和github的ssh传输密钥"></a> 设置和Github的SSH传输密钥</h3>
<ol>
<li>用你在注册Github账户是的邮箱，然后一路回车</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"youremail@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>进入C:\Users\WH.ssh，找一个叫‘id_rsa.pub’的文件（公钥）</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/a7f63bc4d5e54d80943607d6650c05f3.JPG?x-oss-process=image" width="80%"> 
</div> 
<h2 id="第二部分用git对本地程序初始化"><a class="markdownIt-Anchor" href="#第二部分用git对本地程序初始化"></a> 第二部分：用Git对本地程序初始化</h2>
<p>（这么说肯定不标准，还望各位大佬别笑）实际上是用Git对本地程序建立一个“变更记录”</p>
<h3 id="进入到程序文件夹"><a class="markdownIt-Anchor" href="#进入到程序文件夹"></a> 进入到程序文件夹。</h3>
<p>（别学我，最好别有中文路径）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>WH<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>新建文件夹<span class="token punctuation">\</span>TIR<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="初始化并提交"><a class="markdownIt-Anchor" href="#初始化并提交"></a> 初始化并提交</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">--all</span>   <span class="token comment"># 添加所有文件</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"first"</span>  <span class="token comment"># 提交修改</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="第三部分上传github"><a class="markdownIt-Anchor" href="#第三部分上传github"></a> 第三部分：上传Github</h2>
<h3 id="修改一下分支名"><a class="markdownIt-Anchor" href="#修改一下分支名"></a> 修改一下分支名</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch <span class="token parameter variable">-M</span> main <span class="token comment"># 为了和Github默认分支保持一致</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="添加远端库名"><a class="markdownIt-Anchor" href="#添加远端库名"></a> 添加远端库名</h3>
<p>比如你刚在Github上创建了一个库，库名为TIR。现在告诉Git，要把这些程序上传到这个库TJUMMG/TIR，这个库在本地命名为origin</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> remote <span class="token function">add</span> origin git@github.com:TJUMMG/TIR.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="上传"><a class="markdownIt-Anchor" href="#上传"></a> 上传</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> push <span class="token parameter variable">-u</span> origin main<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="结束"><a class="markdownIt-Anchor" href="#结束"></a> 结束</h1>
]]></content>
      <categories>
        <category>笔记</category>
        <category>其他</category>
      </categories>
  </entry>
  <entry>
    <title>Hexo+GitHub博客搭建</title>
    <url>/2021/11/08/Hexo-GitHub%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>某晚，像孩童般充满好奇心的Y同学在努力探索如何在GitHub上搭建个人博客。小王在各种失败的打击后，已经不再对任何事情感到好奇并愿意探究。但以前确实见过以github.io为名的网站。查了一下视频教程短的仅有5分钟，详细的也不过30分钟，再加上小王早已对CSDN的弹窗广告不满，所以决定尝试一下。于是在一个忙里偷闲的晚上，终于建立自己的网站。</p>
<span id="more"></span>
<p>在一番探索后，小王决定记录一下这个过程。整体流程主要参考<a href="https://www.bilibili.com/video/BV1mU4y1j72n?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click">保姆级Hexo+github搭建个人博客</a></p>
<h1 id="前期准备"><a class="markdownIt-Anchor" href="#前期准备"></a> 前期准备</h1>
<h2 id="git-下载和安装"><a class="markdownIt-Anchor" href="#git-下载和安装"></a> Git 下载和安装</h2>
<ol>
<li>在<a href="https://git-scm.com/downloads">官方网站</a> ，找到合适的安装包并下载。</li>
<li>安装过程就是一路Next，没有什么需要注意的</li>
<li>附带推荐一份Git教程：<a href="https://www.liaoxuefeng.com/wiki/896043488029600">廖雪峰的Git教程</a></li>
<li>装好了可以查看一下版本</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="nodejs"><a class="markdownIt-Anchor" href="#nodejs"></a> Node.js</h2>
<ol>
<li><a href="https://nodejs.org/en/download/">官方网站</a></li>
<li>找了一个写的很好的安装教程推荐：<a href="https://www.cnblogs.com/liuqiyun/p/8133904.html">刘奇云的安装教程</a></li>
<li>总结一下就是，下载安装包，一路Next，然后更改缓存位置并设置环境变量</li>
<li>查看一下node.js的安装情况</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">node</span> <span class="token parameter variable">-v</span>  <span class="token comment"># 查看Node.js的版本</span>
<span class="token function">npm</span> <span class="token parameter variable">-v</span>   <span class="token comment"># 查看Node.js自带的npm的版本，npm相当于python中的pip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="注册github账号并建库"><a class="markdownIt-Anchor" href="#注册github账号并建库"></a> 注册Github账号并建库</h2>
<ol>
<li>在<a href="https://github.com/">Github官网</a>的“Sign Up”处直接注册就行，需要一个已有的邮箱即可。</li>
<li>新建一个库，<a href="http://xn--XXX-c88d89x23q.github.io">库名为XXX.github.io</a>，其中XXX是你的用户名，<a href="http://xn--a171232886-lv8rx27o.github.io">比如a171232886.github.io</a>。这样写，GitHub才能把这个库“翻译”成网页。然后点击Create repository。</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/6b014465c70c4815bc2014e403eeb25e.JPG?x-oss-process=image" width="80%"> 
</div> 
<h1 id="第一步git和github的初步配置"><a class="markdownIt-Anchor" href="#第一步git和github的初步配置"></a> 第一步：Git和GitHub的初步配置</h1>
<p>主要解决一下文件传输问题</p>
<h2 id="设置本地git用户名"><a class="markdownIt-Anchor" href="#设置本地git用户名"></a> 设置本地Git用户名</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">"Name"</span> 
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">"email@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>例如，Name 和 <a href="mailto:email@example.com">email@example.com</a> 可分别为 twodog 和 <a href="mailto:twodog@qq.com">twodog@qq.com</a></p>
<h2 id="设置和github的ssh传输密钥"><a class="markdownIt-Anchor" href="#设置和github的ssh传输密钥"></a> 设置和Github的SSH传输密钥</h2>
<ol>
<li>用你在注册Github账户是的邮箱，然后一路回车</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"youremail@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>进入<code>C:\Users\WH\.ssh</code>，找一个叫‘id_rsa.pub’的文件（公钥）</li>
<li>登入Github，进入Setting，设置SSH keys。里面需要用到公钥，就把id_rsa.pub文件中的内容输入</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/a7f63bc4d5e54d80943607d6650c05f3.JPG?x-oss-process=image" width="80%"> 
</div> 
<h1 id="第二步安装hexo"><a class="markdownIt-Anchor" href="#第二步安装hexo"></a> 第二步：安装Hexo</h1>
<p>Hexo是一个写网页的框架，可以理解为深度学习力的Pytorch</p>
<h2 id="安装hexo"><a class="markdownIt-Anchor" href="#安装hexo"></a> 安装Hexo</h2>
<p>-g表示全局安装</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-cli <span class="token parameter variable">-g</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>如果出现关于权限问题的错误，以管理员身份运行cmd，再执行以上命令。</strong></p>
<h1 id="第三步建立博客并上传到github"><a class="markdownIt-Anchor" href="#第三步建立博客并上传到github"></a> 第三步：建立博客并上传到Github</h1>
<h2 id="建立hexo博客"><a class="markdownIt-Anchor" href="#建立hexo博客"></a> 建立Hexo博客</h2>
<p>其实关于这里，<a href="https://hexo.io/">Hexo官网</a>已经讲得很清楚了。建议<strong>以管理员身份运行cmd</strong></p>
<h3 id="1-使用hexo初始化"><a class="markdownIt-Anchor" href="#1-使用hexo初始化"></a> 1. 使用Hexo初始化</h3>
<p>新建一个文件夹用于存放Blog文件，比如E:\Blog，然后初始化</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">E:        <span class="token comment"># windows下跳转到E盘</span>
<span class="token builtin class-name">cd</span> Blog   <span class="token comment"># 进入Blog文件夹</span>
hexo init <span class="token comment"># 初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>此处的初始化命令，可能会受到访问Github的网速影响（Github是外网，但没被大陆屏蔽）。比如出现以下情况：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">E:<span class="token punctuation">\</span><span class="token punctuation">\</span>Blog<span class="token operator">></span>hexo init
INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git
fatal: unable to access <span class="token string">'https://github.com/hexojs/hexo-starter.git/'</span><span class="token builtin class-name">:</span> OpenSSL SSL_read: Connection was reset, errno <span class="token number">10054</span>
WARN  <span class="token function">git</span> clone failed. Copying data instead
FATAL <span class="token punctuation">&#123;</span>
  err: <span class="token punctuation">[</span>Error: EPERM: operation not permitted, <span class="token function">mkdir</span> <span class="token string">'E:\'</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
    errno: -4048,
    code: <span class="token string">'EPERM'</span>,
    syscall: <span class="token string">'mkdir'</span>,
    path: <span class="token string">'E:\\'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> Something's wrong. Maybe you can <span class="token function">find</span> the solution here: %s http://hexo.io/docs/troubleshooting.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果你有代理可在cmd中进行以下操作，对当前cmd的网络连接进行<strong>临时</strong>代理，1080是端口号，取决于你的代理设置。详见<a href="https://www.cnblogs.com/macrored/p/12190799.html">windows终端命令行下使用网络代理</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">HTTP_PROXY</span><span class="token operator">=</span>http://127.0.0.1:1080
<span class="token builtin class-name">set</span> <span class="token assign-left variable">HTTPS_PROXY</span><span class="token operator">=</span>http://127.0.0.1:1080<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>取消临时代理</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">netsh winhttp reset proxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>那么如何获取代理呢？我不知道，你自己找！</p>
<h3 id="2-打开本地服务器进行网页本地预览"><a class="markdownIt-Anchor" href="#2-打开本地服务器进行网页本地预览"></a> 2. 打开本地服务器，进行网页本地预览</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>cmd中会显示，访问http://localhost:4000，即可看到预览效果</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">INFO  Hexo is running at http:<span class="token operator">/</span><span class="token operator">/</span>localhost:4000 <span class="token punctuation">.</span> Press Ctrl+C to stop<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/62c4731aecda41858e8a7279fdc58186.JPG?x-oss-process=image" width="80%"> 
</div> 
<h3 id="3-设置_configyml"><a class="markdownIt-Anchor" href="#3-设置_configyml"></a> 3. 设置_config.yml</h3>
<ol>
<li>找到E:\Blog\_config.yml文件，用记事本打开，如果你用VSCode更好。</li>
<li>在底部的</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Deployment</span>
<span class="token comment">## Docs: https://hexo.io/docs/one-command-deployment</span>
deploy:
  type: <span class="token string">''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>改为一下，当然需要你把“a171232886”替换成你自己的Github用户名</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Deployment</span>
<span class="token comment">## Docs: https://hexo.io/docs/one-command-deployment</span>
deploy: 
  type: <span class="token function">git</span>
  repository: git@github.com:a171232886/a171232886.github.io.git
  branch: main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这一步是告诉Hexo，网页和相关文件往哪传。<strong>注意是main，不是master。</strong></p>
<h3 id="4-生成网页并上传"><a class="markdownIt-Anchor" href="#4-生成网页并上传"></a> 4. 生成网页并上传</h3>
<ol>
<li>生成</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>安装一个包，方便上传部署。 别忘了<strong>以管理员身份运行cmd</strong>。<strong>要在博客目录下进行</strong>，成功之后会看见<code>.deploy_git</code>文件夹</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> hexo-deployer-git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>否则执行hexo d 会出现</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ERROR Deployer not found: <span class="token function">git</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>上传</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="第四步欣赏网页"><a class="markdownIt-Anchor" href="#第四步欣赏网页"></a> 第四步：欣赏网页</h1>
<ol>
<li><a href="http://xn--XXX-y46f956ftv1ao5o.github.io">直接访问XXX.github.io</a>，XXX是你的Github账号，<a href="http://xn--a171232886-lv8rx27o.github.io">比如a171232886.github.io</a></li>
<li>现在你就可以看到部署到Github上的博客了，并且全世界都可以访问</li>
<li>停下来，休息一下，喝杯咖啡，给小王点个赞。</li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>Hexo+NexT8.8使用Gitalk</title>
    <url>/2021/11/08/Hexo-NexT8-8%E4%BD%BF%E7%94%A8Gitalk/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>作为一个博客，总得有评论区吧。而评论区的插件需要第三方来完成，有些还需要单独注册。本着尽量少注册，尽量少泄露信息的原则，我使用Gitalk作为评论区插件。NexT主题已经集成了Gitalk。这也是我使用NexT主题的直接原因。</p>
<span id="more"></span>
<p>网上这么多教程，那你为什么要再写一篇呢？因为那些十篇有九篇不能用。不是说那些博客写错了，是过时了。因为<strong>现在NexT的版本已经到8.8</strong>，很多东西已经不一样了。</p>
<p>我现在的相关程序均采用截至到2021/11/8最新的版本，hexo 5.4.0，node 16.13.0，NexT 8.8.1。</p>
<h1 id="github的oauth"><a class="markdownIt-Anchor" href="#github的oauth"></a> Github的OAuth</h1>
<p>这东西可以理解为，一个口令</p>
<ol>
<li>登录Github，依次找到Settings/Developer settings/OAuth Apps，然后New OAuth App，进入<a href="https://github.com/settings/applications/new">申请</a>。按以下格式填写就可以。<strong>注意，用https</strong></li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/3ae6e306a6624fb98f0aa4ea3eab464e.JPG?x-oss-process=image" width="50%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/d02bb3aa27b543c093ca772910b7b342.JPG?x-oss-process=image" width="60%"> 
</div> 
当然，要是忘记Client secrets，可以再申请一个新的，并将以前的作废。
<h1 id="配置next"><a class="markdownIt-Anchor" href="#配置next"></a> 配置NexT</h1>
<p>找到E:\Blog\themes\next\_config.yml。<strong>注意是next文件下下面，不是根目录下面。</strong></p>
<ol>
<li>启用评论区</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Multiple Comment System Support</span>
comments:
  <span class="token comment"># Available values: tabs | buttons</span>
  style: tabs
  <span class="token comment"># Choose a comment system to be displayed by default.</span>
  <span class="token comment"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances</span>
  active: gitalk
  <span class="token comment"># Setting `true` means remembering the comment system selected by the visitor.</span>
  storage: <span class="token boolean">true</span>
  <span class="token comment"># Lazyload all comment systems.</span>
  lazyload: <span class="token boolean">false</span>
  <span class="token comment"># Modify texts or order for any naves, here are some examples.</span>
  nav:
    gitalk:
     order: <span class="token parameter variable">-1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>配置gitalk相关信息，把刚才的client_id和client_secret填入。其他部分参照以下代码修改。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Gitalk</span>
<span class="token comment"># For more information: https://gitalk.github.io</span>
gitalk:
  enable: <span class="token boolean">true</span>
  github_id: a171232886 <span class="token comment"># GitHub repo owner</span>
  repo: a171232886.github.io <span class="token comment"># Repository name to store issues</span>
  client_id: 7db126fef08edb747111 <span class="token comment"># GitHub Application Client ID</span>
  client_secret: ************ac61edd9 <span class="token comment"># GitHub Application Client Secret</span>
  admin_user: a171232886 <span class="token comment"># GitHub repo owner and collaborators, only these guys can initialize gitHub issues</span>
  distraction_free_mode: <span class="token boolean">true</span> <span class="token comment"># Facebook-like distraction free mode</span>
  <span class="token comment"># When the official proxy is not available, you can change it to your own proxy address</span>
  proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token
  <span class="token comment"># https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token # This is official proxy address</span>
  <span class="token comment"># Gitalk's display language depends on user's browser or system environment</span>
  <span class="token comment"># If you want everyone visiting your site to see a uniform language, you can set a force language value</span>
  <span class="token comment"># Available values: en | es-ES | fr | ru | zh-CN | zh-TW</span>
  language: zh-CN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="初始化评论区"><a class="markdownIt-Anchor" href="#初始化评论区"></a> 初始化评论区</h1>
<ol>
<li>首先执行以下代码</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo clean  <span class="token comment"># 清除缓存</span>
hexo g
hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>打开网页以后会看到</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/1f13f09d201846c1bbc0467726473e10.JPG?x-oss-process=image" width="30%"> 
</div> 
3. 登录，会弹出一个授权询问，授权。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/0438e0dd44c74bdca891a136fa7fa996.JPG?x-oss-process=image" width="50%"> 
</div> 
4. 最终可以看到
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/cda28a535430456a9cceee40124e5b7c.JPG?x-oss-process=image" width="50%"> 
</div> 
<h1 id="致谢"><a class="markdownIt-Anchor" href="#致谢"></a> 致谢</h1>
<ol>
<li><a href="https://www.toimc.com/hexo-usage-3/">hexo主题next中gitalk配置与评论初始化</a></li>
</ol>
<h1 id="问题解答"><a class="markdownIt-Anchor" href="#问题解答"></a> 问题解答</h1>
<p>Q：出现这种状况怎么办？</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/3f5946f870e14003a60b9ab96b4e1653.JPG?x-oss-process=image" width="30%"> 
</div> 
A：查一下E:\\Blog\\theme\\next\\_config.yml中的gitalk的proxy是不是```https://github.com/login/oauth/access_token```。
<p>如果是，改为<code>https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</code></p>
<p>因为github官方API，可能会限制调用！</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>Hexo-NexT8添加CC协议</title>
    <url>/2021/11/18/Hexo-NexT8-8%E6%B7%BB%E5%8A%A0CC%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>写完文章以后，想加个版权协议保护一下自己的劳动成果。（小声说：写的文章本来就没人看，根本用不着版权保护。而且版权保护只针对尊重版权的人。）</p>
<p>为什么要写这篇博客，写完还单独列出来？因为网上的教程都过时了，无法在NexT8.8上成功使用。</p>
<p>以下是经过探索后的正确方法。</p>
<span id="more"></span>
<h1 id="修改配置文件"><a class="markdownIt-Anchor" href="#修改配置文件"></a> 修改配置文件</h1>
<p>打开E:\Blog\themes\next\_config.yml，找到creative_commons，修改为以下即可。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Creative Commons 4.0 International License.</span>
<span class="token comment"># See: https://creativecommons.org/about/cclicenses/</span>
creative_commons:
  <span class="token comment"># Available values: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | cc-zero</span>
  license: by-nc-sa
  <span class="token comment"># Available values: big | small</span>
  size: small
  sidebar: <span class="token boolean">false</span>
  post: <span class="token boolean">true</span>
  <span class="token comment"># You can set a language value if you prefer a translated version of CC license, e.g. deed.zh</span>
  <span class="token comment"># CC licenses are available in 39 languages, you can find the specific and correct abbreviation you need on https://creativecommons.org</span>
  language: zh-CN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h1>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/528d85317ff44320b1944e0d82c7221f.JPG" width="80%"> 
</div> 
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>Hexo+NexT添加分享功能</title>
    <url>/2021/11/08/Hexo-NexT%E6%B7%BB%E5%8A%A0%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>能评论，还要能分享。好在NexT已经集成了一些插件。</p>
<span id="more"></span>
<h1 id="插件need-more-share"><a class="markdownIt-Anchor" href="#插件need-more-share"></a> 插件Need More Share</h1>
<p>首先要提一下，<a href="https://github.com/theme-next/awesome-next">NexT官方</a>提供了一些插件，还都不错。集成分享功能在这个页面：<a href="https://github.com/theme-next/hexo-next-share">https://github.com/theme-next/hexo-next-share</a></p>
<ol>
<li>
<p>管理员身份打开cmd，安装</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">E:        <span class="token comment"># windows下跳转到E盘</span>
<span class="token builtin class-name">cd</span> Blog   <span class="token comment"># 进入Blog文件夹</span>
<span class="token function">npm</span> <span class="token function">install</span> theme-next/hexo-next-share<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>NexT官方提供三个分享插件：Likely，Need More Share和Share.js。比较了一下，选择Need More Share。进入其<a href="https://github.com/revir/need-more-share2">项目页面</a>，需要安装：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> grunt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ol>
<h1 id="配置文件"><a class="markdownIt-Anchor" href="#配置文件"></a> 配置文件</h1>
<ol>
<li>
<p>在E:\Blog\themes\next\_config.yml中添加以下代码片段</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># NeedMoreShare2</span>
<span class="token comment"># Dependencies: https://github.com/theme-next/theme-next-needmoreshare2</span>
<span class="token comment"># For more information: https://github.com/revir/need-more-share2</span>
<span class="token comment"># iconStyle: default | box</span>
<span class="token comment"># boxForm: horizontal | vertical</span>
<span class="token comment"># position: top / middle / bottom + Left / Center / Right</span>
<span class="token comment"># networks:</span>
<span class="token comment"># Weibo | Wechat | Douban | QQZone | Twitter | Facebook | Linkedin | Mailto | Reddit | Delicious | StumbleUpon | Pinterest</span>
<span class="token comment"># GooglePlus | Tumblr | GoogleBookmarks | Newsvine | Evernote | Friendfeed | Vkontakte | Odnoklassniki | Mailru</span>
needmoreshare:
  enable: <span class="token boolean">true</span>
  cdn:
    js: //cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js
    css: //cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css
  postbottom:
    enable: <span class="token boolean">true</span>
    options:
      iconStyle: box
      boxForm: horizontal
      position: bottomCenter
      networks: Wechat,QQZone,Weibo,Douban,Twitter,Facebook
  float:
    enable: <span class="token boolean">false</span>
    options:
      iconStyle: box
      boxForm: horizontal
      position: middleRight
      networks: Wechat,QQZone,Weibo,Douban,Twitter,Facebook<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>更新</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo clean
hexo g <span class="token parameter variable">-d</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>最终会在文章尾见到，以下图标</p>
</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/7867d512fe354ec28c4fb5f08303e4a9.JPG" width="50%"> 
</div> 
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>Hexo+Next主题的一些实用插件和美化升级</title>
    <url>/2021/11/08/Hexo-Next%E4%B8%BB%E9%A2%98%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<p>一些实用技巧记录，随时更新</p>
<span id="more"></span>
<h1 id="添加右上角图标folk-github"><a class="markdownIt-Anchor" href="#添加右上角图标folk-github"></a> 添加右上角图标folk github</h1>
<ol>
<li>
<p>找到自己喜欢的样式：<a href="http://tholman.com/github-corners/">http://tholman.com/github-corners/</a>, 并复制代码</p>
</li>
<li>
<p>打开： E:\Blog\themes\next\layout\_layout.njk，添加</p>
</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"headband"</span><span class="token operator">></span><span class="token operator">&lt;</span>/div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--下面一行插入复制代码，注意换成自己的github地址：href<span class="token operator">=</span><span class="token string">"https://github.com/a171232886"</span>--<span class="token operator">></span>
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"https://github.com/a171232886"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"github-corner"</span> aria-label<span class="token operator">=</span><span class="token string">"View source on GitHub"</span><span class="token operator">></span><span class="token operator">&lt;</span>svg <span class="token assign-left variable">width</span><span class="token operator">=</span><span class="token string">"80"</span> <span class="token assign-left variable">height</span><span class="token operator">=</span><span class="token string">"80"</span> <span class="token assign-left variable">viewBox</span><span class="token operator">=</span><span class="token string">"0 0 250 250"</span> <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"</span> aria-hidden<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span><span class="token operator">&lt;</span>path <span class="token assign-left variable">d</span><span class="token operator">=</span><span class="token string">"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"</span><span class="token operator">></span><span class="token operator">&lt;</span>/path<span class="token operator">></span><span class="token operator">&lt;</span>path <span class="token assign-left variable">d</span><span class="token operator">=</span><span class="token string">"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"</span> <span class="token assign-left variable">fill</span><span class="token operator">=</span><span class="token string">"currentColor"</span> <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"transform-origin: 130px 106px;"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"octo-arm"</span><span class="token operator">></span><span class="token operator">&lt;</span>/path<span class="token operator">></span><span class="token operator">&lt;</span>path <span class="token assign-left variable">d</span><span class="token operator">=</span><span class="token string">"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"</span> <span class="token assign-left variable">fill</span><span class="token operator">=</span><span class="token string">"currentColor"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"octo-body"</span><span class="token operator">></span><span class="token operator">&lt;</span>/path<span class="token operator">></span><span class="token operator">&lt;</span>/svg<span class="token operator">></span><span class="token operator">&lt;</span>/a<span class="token operator">></span><span class="token operator">&lt;</span>style<span class="token operator">></span>.github-corner:hover .octo-arm<span class="token punctuation">&#123;</span>animation:octocat-wave 560ms ease-in-out<span class="token punctuation">&#125;</span>@keyframes octocat-wave<span class="token punctuation">&#123;</span><span class="token number">0</span>%,100%<span class="token punctuation">&#123;</span>transform:rotate<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token number">20</span>%,60%<span class="token punctuation">&#123;</span>transform:rotate<span class="token punctuation">(</span>-25deg<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token number">40</span>%,80%<span class="token punctuation">&#123;</span>transform:rotate<span class="token punctuation">(</span>10deg<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>@media <span class="token punctuation">(</span>max-width:500px<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>.github-corner:hover .octo-arm<span class="token punctuation">&#123;</span>animation:none<span class="token punctuation">&#125;</span>.github-corner .octo-arm<span class="token punctuation">&#123;</span>animation:octocat-wave 560ms ease-in-out<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span>/style<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="添加站内搜索"><a class="markdownIt-Anchor" href="#添加站内搜索"></a> 添加站内搜索</h1>
<p>一个实用的NexT<a href="https://theme-next.iissnan.com/">指导网站</a></p>
<ol>
<li>安装</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-searchdb <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>编辑E:\Blog\ _config.yml，任意位置新增</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">search:
  path: search.xml
  field: post
  format: html
  limit: <span class="token number">10000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>编辑E:\Blog\themes\next\_config.yml，修改</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Local search</span>
local_search:
  enable: <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="主页显示项目"><a class="markdownIt-Anchor" href="#主页显示项目"></a> 主页显示项目</h1>
<ol>
<li>编辑E:\Blog\themes\next\_config.yml，修改</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">menu:
  home: / <span class="token operator">||</span> fa fa-home
  <span class="token comment">#tags: /tags/ || fa fa-tags</span>
  categories: /categories/ <span class="token operator">||</span> fa fa-th
  archives: /archives/ <span class="token operator">||</span> fa fa-archive
  about: /about/ <span class="token operator">||</span> fa fa-user
  <span class="token comment">#schedule: /schedule/ || fa fa-calendar</span>
  <span class="token comment">#sitemap: /sitemap.xml || fa fa-sitemap</span>
  <span class="token comment">#commonweal: /404/ || fa fa-heartbeat</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>新建相应文件，比如categories</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page categories<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>修改categories\<a href="http://index.md">index.md</a></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">---
title: 分类
date: <span class="token number">2021</span>-11-08 <span class="token number">20</span>:06:58
type: <span class="token string">'categories'</span>
---<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="moon-cake-进度显示和上下滑动"><a class="markdownIt-Anchor" href="#moon-cake-进度显示和上下滑动"></a> moon-cake 进度显示和上下滑动</h1>
<ol>
<li>下载，<a href="https://github.com/jiangtj-lab/hexo-cake-moon-menu">官方链接</a></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-cake-moon-menu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>编辑E:\Blog\themes\next\_config.yml，添加</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">moon_menu:
  back2top:
    enable: <span class="token boolean">true</span>
    icon: fas fa-chevron-up
    order: <span class="token parameter variable">-1</span>
  back2bottom:
    enable: <span class="token boolean">true</span>
    icon: fas fa-chevron-down
    order: <span class="token parameter variable">-2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="代码颜色"><a class="markdownIt-Anchor" href="#代码颜色"></a> 代码颜色</h1>
<p><a href="https://theme-next.js.org/highlight/">官方的代码颜色的可用方案</a></p>
<p>包括了种类，预览效果和使用方式。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e91a8eb7f21d4d4cae164b66c511f5df.png#pic_center=80%x80%" width="80%"> 
</div> 
<ol>
<li>首先修改 Hexo的 _config.yml</li>
<li>再修改 NexT的 _config.yml</li>
<li>执行<code>hexo clean</code>，再<code>hexo g</code></li>
</ol>
<h1 id="首页只显示文章摘要"><a class="markdownIt-Anchor" href="#首页只显示文章摘要"></a> 首页只显示文章摘要</h1>
<p>以前那种每页显示固定字数的选项没了，现在手动设置：</p>
<ol>
<li>整体设置 NexT的 _config.yml<br />
将<code>excerpt_description: true</code>设为<code>true</code></li>
<li>在每个文章中插入<code>&lt;!--more--&gt;</code>,然后首页只显示该行以上的部分。</li>
</ol>
<h1 id="next8动画背景canvas-nest"><a class="markdownIt-Anchor" href="#next8动画背景canvas-nest"></a> NexT8动画背景Canvas Nest</h1>
<p>添加图片作为背景，但找不到合适的图片。NexT8自带的Canvas ribbon，每次点击背景变化过大，不太好。找来找去，就Nest挺合适，但NexT8已经不在集成Nest效果。</p>
<p>这部分完全转载自<a href="https://hxhowl.com/posts/e6f9a475/">blog - hexo NexT主题下配置和美化</a>，实测有效。</p>
<ol>
<li>首先在hexo目录下安装动画库：</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> themes/next
<span class="token function">git</span> clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="2">
<li>在next主题下的_config.yml找到canvas_ribbon，在下面添加Canvas-nest动画的配置</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Canvas-nest</span>
<span class="token comment"># Dependencies: https://github.com/theme-next/theme-next-canvas-nest</span>
canvas_nest:
  enable: <span class="token boolean">true</span>
  onmobile: <span class="token boolean">true</span> <span class="token comment"># display on mobile or not</span>
  color: <span class="token string">"0,0,255"</span> <span class="token comment"># RGB values, use ',' to separate</span>
  opacity: <span class="token number">0.5</span> <span class="token comment"># the opacity of line: 0~1</span>
  zIndex: <span class="token parameter variable">-1</span> <span class="token comment"># z-index property of the background</span>
  count: <span class="token number">99</span> <span class="token comment"># the number of lines</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>在博客根目录下的source文件夹，创建_data文件夹</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token builtin class-name">source</span>
<span class="token function">mkdir</span> _data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="4">
<li>创建footer.swig文件，添加内容</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>script <span class="token assign-left variable">color</span><span class="token operator">=</span><span class="token string">"0,0,255"</span> <span class="token assign-left variable">opacity</span><span class="token operator">=</span><span class="token string">"0.5"</span> <span class="token assign-left variable">zIndex</span><span class="token operator">=</span><span class="token string">"-1"</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token string">"99"</span> <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"</span><span class="token operator">></span><span class="token operator">&lt;</span>/script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="5">
<li>在next主题下的_config.yml找到_config.yml中找到custom_file_path添加一行配置<code>footer: source/_data/footer.swig</code></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Define custom file paths.</span>
<span class="token comment"># Create your custom files in site directory `source/_data` and uncomment needed files below.</span>
custom_file_path:
  <span class="token comment">#head: source/_data/head.njk</span>
  <span class="token comment">#header: source/_data/header.njk</span>
  <span class="token comment">#sidebar: source/_data/sidebar.njk</span>
  <span class="token comment">#postMeta: source/_data/post-meta.njk</span>
  <span class="token comment">#postBodyEnd: source/_data/post-body-end.njk</span>
  <span class="token comment">#footer: source/_data/footer.njk</span>
  footer: source/_data/footer.swig
  <span class="token comment">#bodyEnd: source/_data/body-end.njk</span>
  <span class="token comment">#variable: source/_data/variables.styl</span>
  <span class="token comment">#mixin: source/_data/mixins.styl</span>
  <span class="token comment">#style: source/_data/styles.styl</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="6">
<li>重启hexo</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo clean
hexo g
hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="修改链接样式"><a class="markdownIt-Anchor" href="#修改链接样式"></a> 修改链接样式</h1>
<p>对<code>./themes/next/source/css/_common/components/post/post-body.styl</code>最后添加内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.post-body a <span class="token punctuation">&#123;</span>
  color: <span class="token comment">#428BCA;</span>
  font-weight: bold<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="latex公式编辑问题"><a class="markdownIt-Anchor" href="#latex公式编辑问题"></a> LaTeX公式编辑问题</h1>
<p>研究了好久，决定还是使用<code>mathjax</code>，其实<code>KaTeX</code>也挺好的。</p>
<ol>
<li>卸载默认的marked，安装新的pandoc</li>
</ol>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> un hexo-renderer-marked
<span class="token function">npm</span> i hexo-renderer-pandoc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="2">
<li>
<p>设置next下的_config.yml，将<code>mathjax</code>启用</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mathjax</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Available values: none | ams | all</span>
  <span class="token key atrule">tags</span><span class="token punctuation">:</span> none<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>注意：<strong>Hexo下的Mathjax没有那么智能，整体公式写法尽量简单，能少加括号的就少加。否则会出现Mathjax官方可以识别出来，但是Hexo编译不出来的情况。</strong></p>
</li>
<li>
<p><a href="https://www.mathjax.org/#demo">mathjax官方demo</a>，可以在上面试试公式</p>
</li>
<li>
<p>尽管mathjax遵循LaTeX语法，但有可能还会出现一些不同的地方。这有两个参考：</p>
<ul>
<li><a href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference</a></li>
<li><a href="https://blog.csdn.net/weixin_30725467/article/details/96659102">在Hexo中渲染MathJax数学公式</a></li>
</ul>
</li>
</ol>
<h1 id="使用mermaid绘制流程图"><a class="markdownIt-Anchor" href="#使用mermaid绘制流程图"></a> 使用mermaid绘制流程图</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> hexo-filter-mermaid-diagrams<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>修改NexT的_config.yml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Mermaid tag</span>
<span class="token key atrule">mermaid</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Available themes: default | dark | forest | neutral</span>
  <span class="token key atrule">theme</span><span class="token punctuation">:</span>
    <span class="token key atrule">light</span><span class="token punctuation">:</span> default
    <span class="token key atrule">dark</span><span class="token punctuation">:</span> dark<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="mermaid的flowchart基础语法"><a class="markdownIt-Anchor" href="#mermaid的flowchart基础语法"></a> mermaid的flowchart基础语法</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">  <span class="token operator">&lt;</span>pre <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"mermaid"</span><span class="token operator">></span>  flowchart LR
    subgraph TOP
      direction TB
      subgraph B1
          direction RL
          i1 --<span class="token operator">></span>f1
      end
      subgraph B2
          direction BT
          i2 --<span class="token operator">></span>f2
      end
    end
    A --<span class="token operator">></span> TOP --<span class="token operator">></span> B
    B1 --<span class="token operator">></span> B<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/pre<span class="token operator">></span>



<span class="token operator">&lt;</span>pre <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"mermaid"</span><span class="token operator">></span>  flowchart LR
    subgraph TOP
      direction TB
      subgraph B1
          direction RL
          i1 --<span class="token operator">></span>f1
      end
      subgraph B2
          direction BT
          i2 --<span class="token operator">></span>f2
      end
    end
    A --<span class="token operator">></span> TOP --<span class="token operator">></span> B
    B1 --<span class="token operator">></span> B<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/pre<span class="token operator">></span>

<span class="token comment"># 访客统计</span>
next的_config.yml中busuanzi_count的enable设为true即可。
```yml
<span class="token comment"># Show Views / Visitors of the website / page with busuanzi.</span>
<span class="token comment"># For more information: http://ibruce.info/2015/04/04/busuanzi/</span>
busuanzi_count:
  enable: <span class="token boolean">true</span>
  total_visitors: <span class="token boolean">true</span>
  total_visitors_icon: fa fa-user
  total_views: <span class="token boolean">true</span>
  total_views_icon: fa fa-eye
  post_views: <span class="token boolean">true</span>
  post_views_icon: far fa-eye<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="文章目录相关"><a class="markdownIt-Anchor" href="#文章目录相关"></a> 文章目录相关</h1>
<h2 id="默认展开"><a class="markdownIt-Anchor" href="#默认展开"></a> 默认展开</h2>
<p>如果文章内容是多级目录，默认二级目录是合并的。这样给阅读带来不便，可设置为默认展开。<br />
next的_config.yml中toc的expand_all设为true</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">toc</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Automatically add list number to toc.</span>
  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># If true, all words will placed on next lines if header width longer then sidebar width.</span>
  <span class="token key atrule">wrap</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># If true, all level of TOC in a post will be displayed, rather than the activated part of it.</span>
  <span class="token key atrule">expand_all</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Maximum heading depth of generated toc.</span>
  <span class="token key atrule">max_depth</span><span class="token punctuation">:</span> <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="取消自动编号"><a class="markdownIt-Anchor" href="#取消自动编号"></a> 取消自动编号</h2>
<p><code>number: false</code></p>
<h2 id="每行目录显示全部"><a class="markdownIt-Anchor" href="#每行目录显示全部"></a> 每行目录显示全部</h2>
<p><code>wrap: true</code>，此时每行过长的目录标题会转行显示。</p>
<h1 id="网站运行天数"><a class="markdownIt-Anchor" href="#网站运行天数"></a> 网站运行天数</h1>
<p>在<code>.\themes\next\layout\_partials\footer.njk</code>最后添加，注意修改<code>var grt= new Date(&quot;12/1/2021 00:00:00&quot;);</code>中的时间。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timeDate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>载入天数...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>times<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>载入时分秒...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">createtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> grt<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"12/1/2021 00:00:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        now<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        days <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span> dnum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span>
        hours <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> dnum<span class="token punctuation">)</span><span class="token punctuation">;</span> hnum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>hnum<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>hnum <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> hnum<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> minutes <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span><span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> dnum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> hnum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mnum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>mnum<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>mnum <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> mnum<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
        seconds <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> dnum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> hnum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> mnum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        snum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>snum<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>snum <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> snum<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"timeDate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"本站已安全运行 "</span><span class="token operator">+</span>dnum<span class="token operator">+</span><span class="token string">" 天 "</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"times"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hnum <span class="token operator">+</span> <span class="token string">" 小时 "</span> <span class="token operator">+</span> mnum <span class="token operator">+</span> <span class="token string">" 分 "</span> <span class="token operator">+</span> snum <span class="token operator">+</span> <span class="token string">" 秒"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token string">"createtime()"</span><span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="网页底部去掉强力驱动"><a class="markdownIt-Anchor" href="#网页底部去掉强力驱动"></a> 网页底部去掉“强力驱动”</h1>
<p>比如想去掉“由 Hexo &amp; NexT.Gemini 强力驱动”，在<code>.\themes\next\layout\_partials\footer.njk</code>中将以下代码注释掉。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&#123;%- if theme.footer.powered %&#125;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>powered-by<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    &#123;%- set next_site = 'https://theme-next.js.org' if theme.scheme === 'Gemini' else 'https://theme-next.js.org/' + theme.scheme | lower + '/' %&#125;
    &#123;&#123;- __('footer.powered', next_url('https://hexo.io', 'Hexo') + ' &amp; ' + next_url(next_site, 'NexT.' + theme.scheme)) &#125;&#125;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
&#123;%- endif %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但我认为Hexo和NexT应该在我的网页上留有名字，毕竟帮了我很大忙，于是将其放在了友情链接中。</p>
<h1 id="友情链接的设置"><a class="markdownIt-Anchor" href="#友情链接的设置"></a> 友情链接的设置</h1>
<p>next的_config.yml中Blog rolls进行设置</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Blog rolls</span>
<span class="token key atrule">links_settings</span><span class="token punctuation">:</span>
  <span class="token key atrule">icon</span><span class="token punctuation">:</span> fa fa<span class="token punctuation">-</span>globe
  <span class="token key atrule">title</span><span class="token punctuation">:</span> 友情链接
  <span class="token comment"># Available values: block | inline</span>
  <span class="token key atrule">layout</span><span class="token punctuation">:</span> inline

  <span class="token key atrule">links</span><span class="token punctuation">:</span>
  <span class="token key atrule">Hexo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//hexo.io
  <span class="token key atrule">NexT</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//theme<span class="token punctuation">-</span>next.js.org/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="社交链接添加图标"><a class="markdownIt-Anchor" href="#社交链接添加图标"></a> 社交链接添加图标</h1>
<h2 id="添加社交连接"><a class="markdownIt-Anchor" href="#添加社交连接"></a> 添加社交连接</h2>
<p>在next的_config.yml中social中进行设置。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">social</span><span class="token punctuation">:</span>
  <span class="token key atrule">GitHub</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/a171232886 <span class="token punctuation">|</span><span class="token punctuation">|</span> fab fa<span class="token punctuation">-</span>github
  <span class="token key atrule">CSDN</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//blog.csdn.net/a171232886 <span class="token punctuation">|</span><span class="token punctuation">|</span> fa fa<span class="token punctuation">-</span>book<span class="token punctuation">-</span>open

<span class="token key atrule">social_icons</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">icons_only</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">transition</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="添加图标"><a class="markdownIt-Anchor" href="#添加图标"></a> 添加图标</h2>
<p>添加的图标应该是<a href="https://fontawesome.dashgame.com/">Font Awesome</a>这里面已经有的图标。找到合适的图标，复制代码在上面<code>||</code>后直接时候即可。注意不要删掉原有的fa或者fab。</p>
<h1 id="头像设置"><a class="markdownIt-Anchor" href="#头像设置"></a> 头像设置</h1>
<p>在next的_config.yml中avatar设置。将头像图片放在<code>./source/images/</code>中，修改url地址。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Sidebar Avatar</span>
<span class="token key atrule">avatar</span><span class="token punctuation">:</span>
  <span class="token comment"># Replace the default image and set the url here.</span>
  <span class="token key atrule">url</span><span class="token punctuation">:</span> /images/header.jpg
  <span class="token comment"># If true, the avatar will be displayed in circle.</span>
  <span class="token key atrule">rounded</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># If true, the avatar will be rotated with the cursor.</span>
  <span class="token key atrule">rotated</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="致谢"><a class="markdownIt-Anchor" href="#致谢"></a> 致谢</h1>
<ol>
<li><a href="https://www.bilibili.com/video/BV16W411t7mq?spm_id_from=333.1007.top_right_bar_window_history.content.click">馨客栈分享</a></li>
<li><a href="https://www.jianshu.com/p/644264a8af2c">next6、7博客主题美化 2020-04-10</a></li>
<li><a href="https://hxhowl.com/posts/e6f9a475/">blog - hexo NexT主题下配置和美化</a></li>
<li><a href="https://dog.wtf/tech/making-hexo-next-theme-latex-math-equation-supported/">让 Hexo Next (v8.0.0) 支持 LaTeX 数学公式</a></li>
<li><a href="https://blog.csdn.net/qq_44219883/article/details/105178206">Hexo+next主题配置踩的坑</a></li>
<li><a href="https://blog.csdn.net/nightmare_dimple/article/details/86661502">Hexo博客优化之Next主题美化</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>Hexo使用NexT主题与完成第一篇博客</title>
    <url>/2021/11/08/Hexo%E4%BD%BF%E7%94%A8NexT%E4%B8%BB%E9%A2%98%E4%B8%8E%E5%AE%8C%E6%88%90%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>上次说到用Hexo在Github上建立个人博客。Hexo博客所使用的主题默认是Landscape，其实挺简洁大方的。但是由于种种原因，也许是因为功能少，现在需要更换一个主题，比如NexT。</p>
<p>同时，现在要开始完成自己的第一篇博客。</p>
<span id="more"></span>
<h1 id="hexo的主题"><a class="markdownIt-Anchor" href="#hexo的主题"></a> Hexo的主题</h1>
<p>官方在https://hexo.io/themes/, 罗列了348种主题。挑一款自己最喜欢的吧。同时，使用Hexo的大佬们也会在自己的Github网站分享自己的改良版主题。由于NexT主题集成的插件多（网上的教程多），小王转向了NexT。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/df6cc39b1e1e4d97820855ecfb700fe8.JPG?x-oss-process=image" width="80%"> 
</div> 
<h2 id="next主题"><a class="markdownIt-Anchor" href="#next主题"></a> NexT主题</h2>
<p><a href="https://github.com/next-theme/hexo-theme-next">NexT主题官网</a>上提供了各种丰富的资源</p>
<h3 id="主题切换"><a class="markdownIt-Anchor" href="#主题切换"></a> 主题切换</h3>
<ol>
<li>下载主题，首先打开cmd</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">E:        <span class="token comment"># windows下跳转到E盘</span>
<span class="token builtin class-name">cd</span> Blog   <span class="token comment"># 进入Blog文件夹</span>
<span class="token function">git</span> clone https://github.com/next-theme/hexo-theme-next themes/next <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>配置文件</li>
</ol>
<p>找到E:\Blog\_config.yml文件，用记事本打开，如果你用VSCode更好。<br />
将</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">theme: landscape<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>改为以下并保存</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">theme: next<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>补充安装</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i hexo-renderer-swig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>否则，你在hexo g 会看见</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% extends <span class="token string">'_layout.swig'</span> %<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>% <span class="token function">import</span> <span class="token string">'_macro/post.swig'</span> as post_template %<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="4">
<li>本地预览</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo g
hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>访问http://localhost:4000/</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/c2e834445518407a9dc268612abee2ee.JPG?x-oss-process=image" width="80%"> 
</div> 
5. 上传GitHub
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="创建第一篇博客"><a class="markdownIt-Anchor" href="#创建第一篇博客"></a> 创建第一篇博客</h1>
<p>Hexo提供了<a href="https://hexo.io/zh-cn/docs/">官方中文文档</a>，里面写的已经较为详细。</p>
<ol>
<li>创建一篇文章名为test</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后会显示</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">INFO  Created: E:<span class="token punctuation">\</span><span class="token punctuation">\</span>Blog<span class="token punctuation">\</span><span class="token punctuation">\</span>source<span class="token punctuation">\</span><span class="token punctuation">\</span>_posts<span class="token punctuation">\</span><span class="token punctuation">\</span>test.md<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>打开E:\Blog\source\_posts\test.md进行编辑。Markdown语法如果不会的话，可以看看CSDN给你的第一篇博客，里面很详细。总之，Markdown比LaTex要简单很多。比如以下这样，</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">---
title: <span class="token builtin class-name">test</span>
date: <span class="token number">2021</span>-11-08 <span class="token number">13</span>:49:15
tag：
---

<span class="token builtin class-name">test</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>生成网页并上传</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo g <span class="token parameter variable">-d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="文章分类"><a class="markdownIt-Anchor" href="#文章分类"></a> 文章分类</h1>
<p>如果文章过多，肯定需要分类处理，对md文件头可以这样处理。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">---
title: <span class="token builtin class-name">test</span>
date: <span class="token number">2021</span>-11-08 <span class="token number">13</span>:49:15
categories: 
- <span class="token punctuation">[</span>笔记<span class="token punctuation">]</span>
---<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时，这篇文章就会被分到“笔记”中。</p>
<h1 id="配置文件的其他更改"><a class="markdownIt-Anchor" href="#配置文件的其他更改"></a> 配置文件的其他更改</h1>
<p>找到E:\Blog\_config.yml文件，可修改以下几处：</p>
<ol>
<li>网页Site的相关设置，剩下的可以自己探索：</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Site</span>
title: 小王同学
subtitle: <span class="token string">''</span>
description: <span class="token string">''</span>
keywords:
author: 小王同学
language: zh-CN
timezone: <span class="token string">'Asia/Shanghai'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>URL改成自己的网址</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># URL</span>
<span class="token comment">## Set your site url here. For example, if you use GitHub Page, set url as 'https://username.github.io/project'</span>
url: https://a171232886.github.io/
permalink: :year/:month/:day/:title/
permalink_defaults:
pretty_urls:
  trailing_index: <span class="token boolean">true</span> <span class="token comment"># Set to false to remove trailing 'index.html' from permalinks</span>
  trailing_html: <span class="token boolean">true</span> <span class="token comment"># Set to false to remove trailing '.html' from permalinks</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="致谢"><a class="markdownIt-Anchor" href="#致谢"></a> 致谢</h1>
<ol>
<li><a href="https://blog.csdn.net/qq_41170983/article/details/109381893">https://blog.csdn.net/qq_41170983/article/details/109381893</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>MOT16论文笔记</title>
    <url>/2021/10/14/MOT16%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="专栏前言"><a class="markdownIt-Anchor" href="#专栏前言"></a> 专栏前言</h1>
<p>这是目标跟踪专栏第一篇文章。看论文需要记笔记，否则忘得很快。这姑且算是给自己看的阅读笔记，但又希望别人也看，因为别人能提出一些我注意不到的问题或是直接纠正某些错误。但整体上是给自己看的，所以不像其他阅读笔记，这里只包含我认为的重点和我的疑问。</p>
<span id="more"></span>
<h1 id="本文前言"><a class="markdownIt-Anchor" href="#本文前言"></a> 本文前言</h1>
<p>一直觉得了解一个领域方向，应该先了解这个方向的评价指标和数据集。因为这两样东西定义了研究的问题和前进方向。现在了解的是多目标跟踪，因此选了一篇较为经典的《MOT16: A Benchmark for Multi-Object Tracking》</p>
<p><a href="https://arxiv.org/abs/1603.00831">原文链接</a></p>
<p><a href="https://motchallenge.net/">MOT官网链接</a></p>
<h1 id="数据集简介"><a class="markdownIt-Anchor" href="#数据集简介"></a> 数据集简介</h1>
<p>一共14个视频，7个训练，7个测试。测试集没给真值。标注分为两部分，一部分是每帧检测结果det.txt，另一部分是gt.txt。</p>
<h2 id="分类"><a class="markdownIt-Anchor" href="#分类"></a> 分类</h2>
<p>分为三大类，12小类。总之，作者在一番精彩论述和分析后，在评价指标中重点关注行人（Pedestrian）这一类。</p>
<h2 id="标注"><a class="markdownIt-Anchor" href="#标注"></a> 标注</h2>
<h3 id="dettxt"><a class="markdownIt-Anchor" href="#dettxt"></a> det.txt</h3>
<p>论文中举例</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>, -1, <span class="token number">794.2</span>, <span class="token number">47.5</span>, <span class="token number">71.2</span>, <span class="token number">174.8</span>, <span class="token number">67.5</span>, -1, <span class="token parameter variable">-1</span>
<span class="token number">1</span>, -1, <span class="token number">164.1</span>, <span class="token number">19.6</span>, <span class="token number">66.5</span>, <span class="token number">163.2</span>, <span class="token number">29.4</span>, -1, <span class="token parameter variable">-1</span>
<span class="token number">1</span>, -1, <span class="token number">875.4</span>, <span class="token number">39.9</span>, <span class="token number">25.3</span>, <span class="token number">145.0</span>, <span class="token number">19.6</span>, -1, <span class="token parameter variable">-1</span>
<span class="token number">2</span>, -1, <span class="token number">781.7</span>, <span class="token number">25.1</span>, <span class="token number">69.2</span>, <span class="token number">170.2</span>, <span class="token number">58.1</span>, -1, <span class="token parameter variable">-1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>对应含义为</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">帧号，轨迹ID，四个值组成的BBox，无效，无效<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中BBox=（x，y，w，h），x和y是目标左上角点坐标。在实际的数据集文件中，无效的“-1”有三个，而论文中只有两个。</p>
<h3 id="gttxt"><a class="markdownIt-Anchor" href="#gttxt"></a> gt.txt</h3>
<p>论文中举例</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>, <span class="token number">1</span>, <span class="token number">794.2</span>, <span class="token number">47.5</span>, <span class="token number">71.2</span>, <span class="token number">174.8</span>, <span class="token number">1</span>, <span class="token number">1</span>, <span class="token number">0.8</span>
<span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">164.1</span>, <span class="token number">19.6</span>, <span class="token number">66.5</span>, <span class="token number">163.2</span>, <span class="token number">1</span>, <span class="token number">1</span>, <span class="token number">0.5</span>
<span class="token number">2</span>, <span class="token number">4</span>, <span class="token number">781.7</span>, <span class="token number">25.1</span>, <span class="token number">69.2</span>, <span class="token number">170.2</span>, <span class="token number">0</span>, <span class="token number">12</span>, <span class="token number">1</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>对应含义为</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">帧号，轨迹ID，四个值组成的BBox，标志位，目标类别，目标可见比例<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中，</p>
<ul>
<li>标志位为1时在计算评估指标时考虑该目标的跟踪情况，为0时不考虑。</li>
<li>目标类别是指该目标所属文中列出12种目标的哪一类。</li>
<li>由于在对数据集进行标注时，标注的真值会对目标遮挡部分或画面外部分进行估计。也就是真值的BBox区域可能会有一部分是看不见目标的。目标可见比例，就是指可见部分和整个BBox的比例，应该是面积之比，文中未提到。</li>
</ul>
<h1 id="评估指标"><a class="markdownIt-Anchor" href="#评估指标"></a> 评估指标</h1>
<h2 id="两个前提假设"><a class="markdownIt-Anchor" href="#两个前提假设"></a> 两个前提假设</h2>
<p>一方面，人们为了好给跟踪器排名，希望找到一个综合性的指标。但另一方面，人们又担心一个指标，所包含的信息，不如多个指标，（类似于均值和方差所代表的实际意义不能相互替代）。作者明显倾向于后者，并确立了两个基本出发点。</p>
<h3 id="tpfpfn的定义"><a class="markdownIt-Anchor" href="#tpfpfn的定义"></a> TP,FP,FN的定义</h3>
<p>文中原文“It is a true positive (TP) that describes an actual (annotated) target, or whether the output is a false alarm (or false positive, FP)”“A target that is missed by any hypothesis is a false negative (FN). ”</p>
<p>结合后文的例子，<strong>我的理解是，TP是指能正确匹配的目标，FP是指错误匹配的目标，FN是指未进行匹配的目标。</strong>（此处如有问题，请指正，不胜感激！）</p>
<h3 id="一一映射"><a class="markdownIt-Anchor" href="#一一映射"></a> 一一映射</h3>
<p>即，一个真值只能和一个跟踪结果对应，一个跟踪结果只能和一个真值对应。</p>
<h3 id="文中举例"><a class="markdownIt-Anchor" href="#文中举例"></a> 文中举例</h3>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/066506fc663e4a7c9e6453d455d0fb6e.JPG#pic_center" width="50%"> 
</div> 
<p>根据文中表述，上图虚线表示真值轨迹，灰色区域代表匹配时的阈值范围。红线或蓝线表示跟踪结果的轨迹（红色和蓝色表示不同跟踪结果）。实心圆表示该目标正确匹配，空心圆表示该目标未能正确匹配。数字表示第几帧。同一帧中两个圆的距离，应该是表示检测结果之间和检测结果与真值之间的距离。</p>
<p>文中认为上图FP有4个，FN有5个。黑色空心框5个表示未匹配的目标，蓝色空心框表示错误匹配的目标。套用上文我对TP,FP和FN的理解正好能解释。</p>
<p>（这部分文中共列举了四种跟踪中的情况，对MOTA的理解很有帮助，建议阅读原文）</p>
<h2 id="mota"><a class="markdownIt-Anchor" href="#mota"></a> MOTA</h2>
<p>全称Multiple Object Tracking Accuracy，取值范围<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mo>−</mo><mi mathvariant="normal">∞</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">(-\infty, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">∞</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>，</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">O</mi><mi mathvariant="normal">T</mi><mi mathvariant="normal">A</mi></mrow><mo>=</mo><mn>1</mn><mo>−</mo><mfrac><mrow><munder><mo>∑</mo><mi>t</mi></munder><mrow><mo fence="true">(</mo><msub><mrow><mi mathvariant="normal">F</mi><mi mathvariant="normal">N</mi></mrow><mi>t</mi></msub><mo>+</mo><msub><mrow><mi mathvariant="normal">F</mi><mi mathvariant="normal">P</mi></mrow><mi>t</mi></msub><mo>+</mo><msub><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">D</mi><mi mathvariant="normal">S</mi><mi mathvariant="normal">W</mi></mrow><mi>t</mi></msub><mo fence="true">)</mo></mrow></mrow><mrow><munder><mo>∑</mo><mi>t</mi></munder><msub><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">T</mi></mrow><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathrm{MOTA}=1-\frac{\sum_{t}\left(\mathrm{FN}_{t}+\mathrm{FP}_{t}+\mathrm{IDSW}_{t}\right)}{\sum_{t} \mathrm{GT}_{t}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">O</span><span class="mord mathrm">T</span><span class="mord mathrm">A</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.4254200000000004em;vertical-align:-0.9857100000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4397100000000003em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1308459999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1308459999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathrm">F</span><span class="mord mathrm">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">F</span><span class="mord mathrm">P</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">D</span><span class="mord mathrm">S</span><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9857100000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi>G</mi><mi>T</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">{GT}_{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧上全部的标注目标数量，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi>F</mi><mi>N</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">{FN}_{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧上全部未匹配目标数量，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi>F</mi><mi>P</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">{FP}_{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧上全部匹配错误目标数量，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi>I</mi><mi>D</mi><mi>S</mi><mi>W</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">{IDSW}_{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧上ID变换总数。Identity Switch，IDSW，指目标轨迹号的变化次数，越低越好。一条轨迹理想情况下，跟踪结果的轨迹号不会发生变化，但实际情况不然，详见文中共列举了四种跟踪情况的第一种。</p>
<h2 id="motp"><a class="markdownIt-Anchor" href="#motp"></a> MOTP</h2>
<p>全称Multiple Object Tracking Precision，<strong>注意是衡量正确匹配的目标和真值之间</strong>，</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">O</mi><mi mathvariant="normal">T</mi><mi mathvariant="normal">P</mi></mrow><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>t</mi><mo separator="true">,</mo><mi>i</mi></mrow></munder><msub><mi>d</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>t</mi></munder><msub><mi>c</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathrm{MOTP}=\frac{\sum_{t, i} d_{t, i}}{\sum_{t} c_{t}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">O</span><span class="mord mathrm">T</span><span class="mord mathrm">P</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.561528em;vertical-align:-0.9857100000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.575818em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1308459999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.825818em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9857100000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">c_{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧正确匹配的数量，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{t, i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>表示第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span>帧上第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>个目标跟踪结果的BBox和标注BBox之间的IoU.</p>
<h2 id="mt和ml"><a class="markdownIt-Anchor" href="#mt和ml"></a> MT和ML</h2>
<ul>
<li>对于一条轨迹，能成功跟踪轨迹的80%以上，（不考虑轨迹号是否发生变化），称这个目标MT（Mostly Tracked）</li>
<li>对于一条轨迹，能成功跟踪轨迹的20%以下，称这个目标MT（Mostly Lost）。</li>
<li>介于80%和20%之间的，称为PT（Partially Tracked）。</li>
</ul>
<h2 id="fm"><a class="markdownIt-Anchor" href="#fm"></a> FM</h2>
<p>原文：the number of track fragmentations (FM) counts how many times a ground truth trajectory is<br />
interrupted (untracked).<br />
计算方式：we also provide the relative number of fragmentations as FM / Recall</p>
<h2 id="idsw"><a class="markdownIt-Anchor" href="#idsw"></a> IDSW</h2>
<p>原文：identity switch, IDSW is counted if a ground truth target i is matched to track j and the last known assignment was k != j.</p>
<p>计算方式：We also state the relative number of ID switches, which is computed as IDSW / Recall</p>
<h1 id="疑问"><a class="markdownIt-Anchor" href="#疑问"></a> 疑问</h1>
<ol>
<li>
<p>在4.1.3（2）中 “All result boxes that overlap &gt; 50% with one of these classes (distractor, static person, reflection, person on vehicle) are removed from the solution.” 如果遮挡物和目标的IoU大于50%怎么办？</p>
</li>
<li>
<p>FM指标从文中的表述来看是统计标注真值的评价指标？</p>
</li>
<li>
<p>表7中MOTA下面的$\pm$9.2等，是文中所提出的Robustness，即MOTA在各个视频下的标准差？</p>
</li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>目标跟踪</category>
      </categories>
  </entry>
  <entry>
    <title>Linux学习笔记</title>
    <url>/2022/02/14/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="一-操作系统"><a class="markdownIt-Anchor" href="#一-操作系统"></a> 一、操作系统</h1>
<ol>
<li>概念：硬件上的第一层软件。</li>
</ol>
<pre class="mermaid">   graph LR
   硬件-->操作系统-->应用软件</pre>
<ol start="2">
<li>
<p>分类：</p>
<ul>
<li>桌面操作系统：Windows、macOS、linux</li>
<li>移动移动端操作系统：Android、IOS</li>
<li>服务器操作系统：Linux、Windows</li>
<li>嵌入式操作系统：Android（底层为Linux）</li>
</ul>
<p>Linux免费、稳定、高效。</p>
</li>
</ol>
<span id="more"></span>
<ol start="3">
<li>
<p>Linux的分类<br />
内核：硬件和应用程序之间。</p>
<ul>
<li>稳定版：稳</li>
<li>开发版：新</li>
</ul>
<p>发行版：在内核上加了一些软件。<br />
内核和发行版本之间的关系，类似于原生安卓和华为/小米系统之间关系。</p>
</li>
</ol>
<pre class="mermaid">graph LR
Linux-->Redhat系列
Redhat系列-->RHEL
Redhat系列-->CentOS
Redhat系列-->Fedora

Linux-->Debian系列
Debian系列-->Debian
Debian系列-->Ubuntu</pre>
<h1 id="二-linux基础"><a class="markdownIt-Anchor" href="#二-linux基础"></a> 二、Linux基础</h1>
<h2 id="一文件结构"><a class="markdownIt-Anchor" href="#一文件结构"></a> （一）文件结构</h2>
<ol>
<li>
<p>根目录<code>/</code></p>
</li>
<li>
<p><code>/home</code>普通用户的家目录，<code>/root</code>系统管理员（超级用户）</p>
</li>
<li>
<p><code>/bin</code>可执行二进制文件目录（软件安装目录）</p>
</li>
<li>
<p><code>/media</code>(<code>/mnt</code>)挂载点</p>
</li>
<li>
<p><code>/etc</code>系统配置文件</p>
</li>
<li>
<p><code>/var</code>日志文件</p>
</li>
</ol>
<h2 id="二常用命令"><a class="markdownIt-Anchor" href="#二常用命令"></a> （二）常用命令</h2>
<h3 id="1-小技巧"><a class="markdownIt-Anchor" href="#1-小技巧"></a> 1. 小技巧</h3>
<ul>
<li>
<p><code>clear</code>命令行清屏；</p>
</li>
<li>
<p><code>tab</code>键自动补全；</p>
</li>
<li>
<p>↑↓找命令，ctrl+c终止；</p>
</li>
<li>
<p><code>命令 --help</code>显示帮助；</p>
</li>
</ul>
<h3 id="2-cd-路径切换文件夹"><a class="markdownIt-Anchor" href="#2-cd-路径切换文件夹"></a> 2. <code>cd 路径</code>切换文件夹，</h3>
<ul>
<li>
<p><code>pwd</code>查看当前路径，</p>
</li>
<li>
<p><code>./</code>当前目录下一层，<code>../</code>当前目录上一层。<code>cd ../</code></p>
</li>
</ul>
<p>注：<code>cd ~</code>回到自己家，<code>cd -</code>相当于电视频道回看</p>
<h3 id="3-ls查看当前路径下文件目录"><a class="markdownIt-Anchor" href="#3-ls查看当前路径下文件目录"></a> 3. <code>ls</code>查看当前路径下文件目录</h3>
<ul>
<li><code>ls -a</code>显示所有文件目录（包括隐藏文件）</li>
<li><code>ls -l</code>或<code>ls -lh</code>显示文件目录，包括权限、所有者、创建时间</li>
<li><code>ls 路径</code> 显示这个路径下的文件</li>
<li><code>ls a*</code>查看名以a开头的文件，<code>ls *d</code>查看名以d结尾的文件。*称为通配符，可代表多个字符</li>
</ul>
<p>不太重要的提示</p>
<ul>
<li>
<p><code>ls a?</code>中?表示任意的一个字符</p>
</li>
<li>
<p><code>ls [abc]d</code>列出名为abc中任意一个且以d结尾的文件，<code>ls [a-x]d</code>和之前的区别是从a到x的任意一个字符</p>
</li>
<li>
<p>当文件名为*x，查看时使用<code>ls \*x</code></p>
</li>
</ul>
<h3 id="4-mkdir-路径文件夹名创建文件夹"><a class="markdownIt-Anchor" href="#4-mkdir-路径文件夹名创建文件夹"></a> 4. <code>mkdir 路径+文件夹名</code>创建文件夹</h3>
<ul>
<li>
<p><code>mkdir 路径+文件夹名 -p</code> 自动创建父目录</p>
</li>
<li>
<p><code>mkdir 路径+文件夹名 路径+文件夹名</code>或者<code>mkdir 路径/&#123;文件夹名1,文件夹名2&#125;</code>同时创建两个文件夹</p>
<p><code>mkdir 2/&#123;3,4&#125;</code></p>
</li>
<li>
<p><code>mkdir .4</code>创建一个名称为4的隐藏文件夹</p>
</li>
</ul>
<h3 id="5-touch-文件名创建文件"><a class="markdownIt-Anchor" href="#5-touch-文件名创建文件"></a> 5. <code>touch 文件名</code>创建文件</h3>
<p>如<code>touch 1.txt</code>，但推荐<code>gedit 1.txt</code>创建并打开</p>
<h3 id="6rm-文件名删除文件"><a class="markdownIt-Anchor" href="#6rm-文件名删除文件"></a> 6.<code>rm 文件名</code>删除文件</h3>
<ul>
<li><code>rm 文件夹名 -r</code> 删除文件夹</li>
<li><code>rm *</code> 删除所有文件，不包括隐藏文件</li>
</ul>
<h3 id="7-cp复制命令"><a class="markdownIt-Anchor" href="#7-cp复制命令"></a> 7. cp复制命令</h3>
<ul>
<li><code>cp 1.txt a</code>将1.txt复制到文件夹a中</li>
<li><code>cp 1.txt a/2.txt</code>将1.txt复制到文件夹a中，命名为2.txt</li>
<li><code>cp a b -r</code>拷贝文件夹</li>
</ul>
<p>不太重要的提示</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/0efbb43c17ae4c85acb5237ef2d50260.png" width="80%"> 
</div> 
<h3 id="8mv移动命令剪切和重命名"><a class="markdownIt-Anchor" href="#8mv移动命令剪切和重命名"></a> 8.mv移动命令（剪切）和重命名，</h3>
<p>可直接参考cp命令，包含-f，-i，-v</p>
<ul>
<li>
<p><code>mv 1.txt 2.txt</code>相当于将1.txt<mark>重命名</mark>为2.txt</p>
</li>
<li>
<p>移动文件夹不需要-r</p>
</li>
</ul>
<h3 id="9-cat和重定向"><a class="markdownIt-Anchor" href="#9-cat和重定向"></a> 9. cat和重定向</h3>
<ul>
<li>重定向：将结果返回到其他地方，<code>&gt;</code>覆盖，<code>&gt;&gt;</code>追加。</li>
</ul>
<p>​		ls &gt;1.txt```将本该显示在终端中的结果返回到1.txt中，若1.txt不存在，直接创建。</p>
<ul>
<li>cat：将文件的内容直接显示在终端中</li>
</ul>
<p>​		<code>cat 1.txt</code>，<code>cat 1.txt 2.txt</code></p>
<p>两个联合使用：<code>cat 1.txt 2.txt &gt; 3.txt</code> 将两个文件内容合并到3.txt中。</p>
<h3 id="10-more-查看文件"><a class="markdownIt-Anchor" href="#10-more-查看文件"></a> 10. more 查看文件</h3>
<p>如<code>more 1.txt</code> 当1.txt文件内容比较多的时候，分页显示。空格\回车下滑，b上划，q退出</p>
<h3 id="11-管道"><a class="markdownIt-Anchor" href="#11-管道"></a> 11. 管道<code>|</code></h3>
<p>将线左边的命令的输出作为线右边的命令的输入</p>
<p>比如<code>ls -l | more</code>，但b上划无效</p>
<h2 id="三权限相关命令"><a class="markdownIt-Anchor" href="#三权限相关命令"></a> （三）权限相关命令</h2>
<h3 id="1-rwx权限"><a class="markdownIt-Anchor" href="#1-rwx权限"></a> 1.  rwx权限</h3>
<p>当使用<code>ls -l</code>查看时</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 权限 相同文件数 用户 组	大小	创建时间	文件夹名</span>
drwxrwxr-x <span class="token number">2</span> wh wh <span class="token number">4096</span> <span class="token number">2</span>月  <span class="token number">12</span> <span class="token number">20</span>:53 howaa
-rw-rw-r-- <span class="token number">1</span> wh wh    <span class="token number">4</span> <span class="token number">2</span>月  <span class="token number">12</span> <span class="token number">22</span>:58 test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>权限中d代表文件夹，-代表文件</li>
<li>rwx rwx r-x，r可读，w可写，x可执行（若为目录，x表示是否可进入），-表示非。比如最后一个，可读不可写可执行。</li>
<li>权限分为三部分：文件拥有者的，文件拥有组的，当前组之外的用户</li>
<li>相同文件数是指文件内容相同，在硬链接处会用到</li>
</ul>
<h3 id="2-chmod"><a class="markdownIt-Anchor" href="#2-chmod"></a> 2. chmod</h3>
<p>（1） chmod u/g/o/a +/-/= 文件名</p>
<ul>
<li>
<p>u：用户，g：组，o：其他，a：所有</p>
</li>
<li>
<p>+：添加权限，-：减少权限，=：制定权限</p>
</li>
</ul>
<p>例如<code>chmod g+w 1.txt</code></p>
<p>（2）数字法</p>
<ul>
<li>将rwx看成三位二进制数，1表示拥有该权限，0表示没有。如二进制的111表示可读可写可执行，而<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>111</mn><msub><mo stretchy="false">)</mo><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>7</mn><msub><mo stretchy="false">)</mo><mn>10</mn></msub></mrow><annotation encoding="application/x-tex">(111)_2=(7)_{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">1</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>有三组权限，所以有三个十进制数字。如<code>chmod 777 1.txt</code>表示用户、组、其他用户均拥有读写执行权限。</li>
<li>对文件夹<code>-R</code>，<code>chmod 777 -R test</code>表示对test文件夹下所有文件的权限均变成777。</li>
</ul>
<p>​</p>
<h2 id="四链接和搜索"><a class="markdownIt-Anchor" href="#四链接和搜索"></a> （四）链接和搜索</h2>
<h3 id="1-软链接快捷方式"><a class="markdownIt-Anchor" href="#1-软链接快捷方式"></a> 1. 软链接(快捷方式)</h3>
<p><code>ln -s 1.txt 1_soft</code>给1.txt创建一个名为1_soft的快捷方式。</p>
<p>快捷方式仅仅记录给出文件的名称。当名称相同的文件覆盖后，不影响快捷方式。</p>
<p>注意：</p>
<ul>
<li>若不在本文件所在路径下创建，需要在源文件和软连接处<mark>均使用绝对路径</mark>。</li>
<li>可给文件夹创建软连接</li>
</ul>
<h3 id="2-硬链接随时同步的备份"><a class="markdownIt-Anchor" href="#2-硬链接随时同步的备份"></a> 2. 硬链接（随时同步的备份）</h3>
<p><code>ln 1.txt 1_hard</code>给1.txt创建一个名为1_hard的快捷方式，但保存内容。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/f377bc5d65864b6f9ef9fd874f8cc7e7.png" width="80%"> 
</div> 
<p>注意：</p>
<ul>
<li>硬链接内容和源文件内容会同步变化</li>
<li>在源文件丢失后，硬链接内容不受影响</li>
<li>硬连接不能给目录创建</li>
</ul>
<h3 id="3-grep-搜索文件内容"><a class="markdownIt-Anchor" href="#3-grep-搜索文件内容"></a> 3. grep 搜索文件内容</h3>
<ul>
<li><code>grep hello 1.txt</code>在1.txt中寻找&quot;hello’’</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/74af5e2888f44b5abb726d8a3f018b25.png" width="80%"> 
</div> 
<ul>
<li><code>grep hello a -r</code>在文件夹a下的所有文件中寻找&quot;hello’’</li>
<li><code>grep -n ^h 1.txt</code>查找以h开头的，<code>grep -n h$ 1.txt</code>查找以h结尾的。<mark>空格也算字符。</mark></li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/0bc6ab110f624d048f8b482d4c55030d.png" width="80%"> 
</div> 
<h3 id="4-find找文件"><a class="markdownIt-Anchor" href="#4-find找文件"></a> 4. find找文件</h3>
<p><code>find a -name 1.txt</code>在目录a下查找1.txt</p>
<p><code>find a -name '*.txt'</code>在目录a下查找名尾为&quot;.txt&quot;的文件</p>
<h2 id="五打包与压缩"><a class="markdownIt-Anchor" href="#五打包与压缩"></a> （五）打包与压缩</h2>
<h3 id="1-tar打包"><a class="markdownIt-Anchor" href="#1-tar打包"></a> 1. tar打包</h3>
<ul>
<li><code>tar -cvf txt.tar 1.txt 2</code>将1.txt和文件夹2打包成名为txt.tar的文件，且显示进度</li>
<li><code>tar -cvf txt.tar *.txt</code>将所有txt文件。。。</li>
<li><code>tar -tf txt.tar</code>查看打包中的文件名单</li>
<li><code>tar -xf txt.tar -C t2</code>将文件解包到t2文件夹中（但必须现有t2文件夹）</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/6746b71c1afd46bebd8e0deb6d979c08.png" width="80%"> 
</div> 
<p>注意:</p>
<ul>
<li>
<p>f要在参数最后且必须包含，v在打包或解包都可用，t仅列出不解包</p>
</li>
<li>
<p>-C解包指定目录</p>
</li>
</ul>
<h3 id="2-gzip-压缩"><a class="markdownIt-Anchor" href="#2-gzip-压缩"></a> 2. gzip 压缩</h3>
<ul>
<li><code>gzip -r txt.tar</code> 压缩txt.tar生成txt.tar.gz</li>
<li><code>gzip -d txt.tar.gz</code> 解压txt.tar.gz生成txt.tar</li>
</ul>
<h3 id="3一步到位的打包和压缩参数z"><a class="markdownIt-Anchor" href="#3一步到位的打包和压缩参数z"></a> 3.一步到位的打包和压缩（参数z）</h3>
<ul>
<li>
<p><code>tar -czf txt.tar.gz *txt</code>直接生成txt.tar.gz</p>
</li>
<li>
<p><code>tar -xzf txt.tar.gz -C tar</code>解压到tar</p>
</li>
</ul>
<h3 id="4-bzip2"><a class="markdownIt-Anchor" href="#4-bzip2"></a> 4. bzip2</h3>
<ul>
<li>用法和gzip相同，生成的是<code>.tar.bz2</code>文件</li>
<li>与tar结合一步到位时，使用参数j：
<ul>
<li><code>tar -cjf txt.tar.bz2 *txt</code></li>
<li><code>tar -xjf txt.tar.bz2 *txt</code></li>
</ul>
</li>
</ul>
<h3 id="5-zip和unzip"><a class="markdownIt-Anchor" href="#5-zip和unzip"></a> 5. zip和unzip</h3>
<ul>
<li>
<p><code>zip -r zz *txt</code>将所有txt文件压缩到名为<code>zz.zip</code>的压缩包下</p>
</li>
<li>
<p><code>unzip -d zz zz.zip</code>将<code>zz.zip</code>解压到zz文件夹下（文件夹若不存在直接创建）</p>
</li>
</ul>
<p>压缩率：zip&lt;gzip&lt;bzip2，bz2最好</p>
<p>通用性：zip&gt;gzip&gt;bzip2</p>
<h2 id="六账户相关"><a class="markdownIt-Anchor" href="#六账户相关"></a> （六）账户相关</h2>
<ol>
<li>
<p>which 查看可执行程序位置，如<code>which vim</code></p>
</li>
<li>
<p>添加账户<code>sudo adduser username</code></p>
</li>
<li>
<p>删除账户<code>sudo userdel -r username</code></p>
</li>
<li>
<p>切换到username用户<code>su username</code></p>
</li>
<li>
<p>设置账户密码<code>passwd</code></p>
<p><code>sudo passwd root</code>直接设置root账户密码</p>
</li>
<li>
<p><code>exit</code>退出当前账户（或终端）</p>
</li>
<li>
<p>关闭某个用户<code>sudo pkill -u username</code></p>
</li>
<li>
<p><code>who</code>查看当前所有登录的账户（或终端），ubuntu下只查看当前登录的账户</p>
</li>
<li>
<p>关机与重启</p>
</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/5fcfaca9ec6844fbb492d9507702b4ed.png" width="80%"> 
</div> 
<p>​	一般来说就是用<code>sudo reboot</code></p>
<h2 id="七vim记事本"><a class="markdownIt-Anchor" href="#七vim记事本"></a> （七）vim记事本</h2>
<ol>
<li><code>vim 1.txt</code>打开1.txt</li>
<li>在准备修改前，输入<code>i</code></li>
<li>编辑结束后，按<code>Esc</code>，退出编辑模式</li>
<li>输入<code>:wq</code>（或<code>:wq!</code>），保存退出。</li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch中的torch.nn.functional.conv2d与深度可分离卷积和标准卷积</title>
    <url>/2021/11/24/Pytorch%E4%B8%ADtorch.nn.functional.conv2d%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%8F%AF%E5%88%86%E7%A6%BB%E5%8D%B7%E7%A7%AF%E5%92%8C%E6%A0%87%E5%87%86%E5%8D%B7%E7%A7%AF/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>是在研究训练过程中遇到的</p>
<h1 id="fconv2d与nnconv2d"><a class="markdownIt-Anchor" href="#fconv2d与nnconv2d"></a> F.conv2d与nn.Conv2d</h1>
<p>也就是torch.nn.functional.conv2d实际上是torch.nn.Conv2d的另一个用法，<strong>可以直接指定卷积核和偏置的值。</strong> 这在通常情况下是用不到的，因为卷积核的值都是训练得到的。但在一些相关运算（correlation）时，需要指定卷积核的值。首先回顾一下nn.Conv2d</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Conv2d的用法</span>
<span class="token keyword">import</span> torch
x1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
conv <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
                       out_channels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                       kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
out <span class="token operator">=</span> conv<span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<span id="more"></span>
<p>计算过程可由下图得到。具体分析，详见上一篇博客<a href="https://blog.csdn.net/a171232886/article/details/121467164">Pytorch中的卷积、空洞卷积和组卷积</a></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/3ca26f6859104d77924c4fa33c614e2a.JPG" width="80%"> 
</div> 
<p>对于输入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，输出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">{C_{out}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>个维度时，所需要的的卷积核维度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">，</mi><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(C_{out}，C_{in},H_{k},W_{k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。先假设BatchSize大小 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 与这个过程无关，也就是一个Batch中的所有输入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>都被同一组卷积核卷积，因此上图只画出了其中一个输入的卷积过程。</p>
<h2 id="fconv2d"><a class="markdownIt-Anchor" href="#fconv2d"></a> F.conv2d</h2>
<p>先看看官方定义<br />
<code>torch.nn.functional.conv2d(input, weight, bias=None, stride=1, padding=0, dilation=1, groups=1) → Tensor</code></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/651932e5021d49baba4877c682ffc53b.JPG" width="80%"> 
</div>
<p>看着和Conv2d一样，但其中的groups在里面是干什么的？不要紧，先看一个最基础的例子，即输入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，输出通道数<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">C_{out}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>。根据上面的分析，可以得到卷积核的维度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,C_{in},H_{k},W_{k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> f

z1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 卷积核</span>
x1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输入</span>

out_1 <span class="token operator">=</span> f<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> z1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out_1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># 结果</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>于是我们可以到一个直观的理解：<strong>F.conv2d 中的weight，就是卷积核，其维度是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(C_{out},C_{in},H_{k},W_{k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></strong>。</p>
<p>上面这句话是全文的核心。改变weight的第一个维度，直接影响输出大小。</p>
<p>上面那个例子也就是目标跟踪中SiamFC在跟踪时的Correlation过程，</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/93960306e9e7467db5cdc1e9e0403500.JPG" width="80%"> 
</div> 
<h1 id="标准卷积考虑batch的影响"><a class="markdownIt-Anchor" href="#标准卷积考虑batch的影响"></a> 标准卷积考虑Batch的影响</h1>
<p>上面是假设BatchSize大小<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span>与这个过程无关，也就是一个Batch中的所有输入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>都被同一组卷积核卷积。那要不是这样呢，比如<strong>SiamFC的训练过程</strong>。</p>
<p>输入x维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，被用作卷积核的z输入维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B,C_{in},H_{k},W_{k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。想要达成的效果是：<br />
<code>x[0,:,:,:]</code>和<code>z[0,:,:,:]</code>进行卷积，<code>x[1,:,:,:]</code>和<code>z[1,:,:,:]</code>进行卷积，以此类推。每个卷积的过程就是标准卷积。</p>
<p><strong>此时需要用到分组卷积和reshape，针对输入</strong>，关于分组卷积详见上一篇博客<a href="https://blog.csdn.net/a171232886/article/details/121467164">Pytorch中的卷积、空洞卷积和组卷积</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">batch <span class="token operator">=</span> <span class="token number">8</span>
z8 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span>batch<span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
x8 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span>batch<span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>

x8_ <span class="token operator">=</span> x8<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token operator">*</span>batch<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
out_3 <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x8_<span class="token punctuation">,</span> z8<span class="token punctuation">,</span> groups<span class="token operator">=</span>batch<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>out_3<span class="token punctuation">.</span>shape）

<span class="token comment"># 结果</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后进行<code>out_3.reshape([8, 1, 129, 129])</code>，即可。</p>
<p>这里你可能会问reshape不影响顺序，进而会导致错误吗？<strong>pytorch中的reshape时是首先填满最内侧维度的，然后才填充外侧维度。这种方式不影响计算结果。</strong></p>
<p>直观一点的图</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/c7dcad9f519944d7ae36ee16599de3d5.JPG" width="80%"> 
</div> 
<h1 id="深度可分离卷积"><a class="markdownIt-Anchor" href="#深度可分离卷积"></a> 深度可分离卷积</h1>
<p>Depth-corr，SiamRPN++中的使用方式。先研究简的跟踪过程：<br />
要求输入x的维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，z的维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,C_{in},H_{k},W_{k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，输出维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,C_{in},H_{out},W_{out})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，也就是x的第一个维度和z的第一个维度进行卷积，第二个和第二个，依次类推。。。</p>
<p>有了上面的基础，现在研究起来也变得容易了，还是<strong>用分组卷积和reshape，针对卷积核</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">chanel <span class="token operator">=</span> <span class="token number">256</span>
z1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>chanel<span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>chanel<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

z1_dw <span class="token operator">=</span> z1<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span>chanel<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
out_2 <span class="token operator">=</span> f<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> z1_dw<span class="token punctuation">,</span> groups<span class="token operator">=</span>chanel<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>out_2<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="深度可分离卷积考虑batch"><a class="markdownIt-Anchor" href="#深度可分离卷积考虑batch"></a> 深度可分离卷积考虑Batch</h1>
<p>也就相当于SiamRPN++的训练过程。</p>
<p>输入x维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B,C_{in},H_{in},W_{in})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，被用作卷积核的z输入维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(B,C_{in},H_{k},W_{k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。想要达成的效果是：<br />
<code>x[0,:,:,:]</code>和<code>z[0,:,:,:]</code>进行卷积，<code>x[1,:,:,:]</code>和<code>z[1,:,:,:]</code>进行卷积，以此类推。每个卷积的过程就是深度可分离卷积。</p>
<p>如果前面看懂了，这里应该就能学以致用了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">z8 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span>batch<span class="token punctuation">,</span>channel<span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x8 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span>batch<span class="token punctuation">,</span>channel<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

x8_ <span class="token operator">=</span> x8<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>batch<span class="token operator">*</span>channel<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
z8_dw <span class="token operator">=</span> z8<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span>batch<span class="token operator">*</span>channel<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

out_4 <span class="token operator">=</span> f<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x8_<span class="token punctuation">,</span> z8_dw<span class="token punctuation">,</span> groups<span class="token operator">=</span>channel<span class="token operator">*</span>batch<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out_1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://pytorch.org/docs/1.3.1/nn.functional.html?highlight=conv2d#torch.nn.functional.conv2d">https://pytorch.org/docs/1.3.1/nn.functional.html?highlight=conv2d#torch.nn.functional.conv2d</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch中的BatchNorm</title>
    <url>/2021/11/24/Pytorch%E4%B8%AD%E7%9A%84BatchNorm/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>首先放一张四种归一化的对比</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/efc7b75904e7420597d81fd0f0f6fc93.JPG" width="80%"> 
</div> 
<span id="more"></span>
<h1 id="batchnorm"><a class="markdownIt-Anchor" href="#batchnorm"></a> BatchNorm</h1>
<p>最基础的这个。原论文给出的流程：</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/133e7dc0aca5415bad430d7a6cca6fc6.JPG" width="50%"> 
</div> 
就是先对送进来的数据计算均值和方差，然后归一化，最后再拟合一下。
再对应一下pytorch中的公式。没问题，可以完美对应。
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi mathvariant="normal">E</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo></mrow><msqrt><mrow><mi mathvariant="normal">Var</mi><mo>⁡</mo><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo>+</mo><mi>ϵ</mi></mrow></msqrt></mfrac><mo>∗</mo><mi>γ</mi><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">y=\frac{x-\mathrm{E}[x]}{\sqrt{\operatorname{Var}[x]+\epsilon}} * \gamma+\beta
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.557em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="mord mathrm">a</span><span class="mord mathrm">r</span></span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">ϵ</span></span></span><span style="top:-2.8950000000000005em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30499999999999994em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathrm">E</span></span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span></span></p>
<h2 id="先看看pytorch怎么使用的"><a class="markdownIt-Anchor" href="#先看看pytorch怎么使用的"></a> 先看看Pytorch怎么使用的</h2>
<p><code>torch.nn.BatchNorm2d(num_features, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
bn <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment"># bn.eval()</span>
y <span class="token operator">=</span> bn<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>bn<span class="token punctuation">.</span>running_mean<span class="token punctuation">)</span>  <span class="token comment"># 均值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bn<span class="token punctuation">.</span>running_var<span class="token punctuation">)</span>   <span class="token comment"># 方差</span>

tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0029</span><span class="token punctuation">,</span>  <span class="token number">0.0019</span><span class="token punctuation">,</span>  <span class="token number">0.0008</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.9955</span><span class="token punctuation">,</span> <span class="token number">0.9959</span><span class="token punctuation">,</span> <span class="token number">1.0055</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>有以下的地方需要注意：</p>
<p>（1）bn.eval()会使bn.training=False,running_mean和running_var不再更新；train()则相反。</p>
<p>（2）bn.running_mean为均值，bn.running_var是方差。</p>
<p>再看看bn都包含什么</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/7ca28be3536d4b0093e864c693e9ab4f.JPG" width="80%"> 
</div> 
可以发现：
<p>（1）running_mean和running_var是初始值分别是0和1，而维度是输入channel的值。</p>
<p>（2）weight和bias默认为1和0</p>
<p>（3）training=True（你可能会说track_running_stats=True，但我至今没发现这两项的实际作用有啥区别），running_mean和running_var默认随数据更新。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> self<span class="token punctuation">.</span>training <span class="token keyword">and</span> self<span class="token punctuation">.</span>track_running_stats<span class="token punctuation">:</span>
    <span class="token comment"># TODO: if statement only here to tell the jit to skip emitting this when it is None</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>num_batches_tracked <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># type: ignore[has-type]</span>
        self<span class="token punctuation">.</span>num_batches_tracked <span class="token operator">=</span> self<span class="token punctuation">.</span>num_batches_tracked <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># type: ignore[has-type]</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>momentum <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># use cumulative moving average</span>
            exponential_average_factor <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_batches_tracked<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># use exponential moving average</span>
            exponential_average_factor <span class="token operator">=</span> self<span class="token punctuation">.</span>momentum<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也就是training 和 track_running_stats同时为True的时候才更新状态。</p>
<p>（4）还有一项难以解释的，momentum默认为0.1</p>
<h2 id="momentum"><a class="markdownIt-Anchor" href="#momentum"></a> momentum</h2>
<p>这一项看了好半天，去看原论文<a href="https://arxiv.org/abs/1502.03167">Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift</a>，里面没提到（给出的流程在上面。)</p>
<p>而pytorch官方解释也是不太清楚</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/8ea6660ca53940da99435535a326bf95.JPG" width="80%"> 
</div> 
明显，momentum用于更新均值和方差。但是这个x的上标是怎么回事？对拟合后的数据进行计算均值和方差？
<p>咱还是想办法试一下吧。用两个输入x1~N(0,1) 和 x2~N(1,4)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># x1~N(0,1)</span>
x1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
bn <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
y1 <span class="token operator">=</span> bn<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>bn<span class="token punctuation">.</span>running_mean<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bn<span class="token punctuation">.</span>running_var<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'data:'</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y1<span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>var<span class="token punctuation">(</span>y1<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># x2~N(1,4)</span>
x2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span><span class="token number">1</span>
y2 <span class="token operator">=</span> bn<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>bn<span class="token punctuation">.</span>running_mean<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bn<span class="token punctuation">.</span>running_var<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'data:'</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y2<span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>var<span class="token punctuation">(</span>y2<span class="token punctuation">)</span><span class="token punctuation">)</span>


tensor<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">0.0001</span><span class="token punctuation">,</span>  <span class="token number">0.0001</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0006</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0004</span><span class="token punctuation">,</span> <span class="token number">1.0002</span><span class="token punctuation">,</span> <span class="token number">0.9998</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
data<span class="token punctuation">:</span> tensor<span class="token punctuation">(</span><span class="token number">0.</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MeanBackward0<span class="token operator">></span><span class="token punctuation">)</span> tensor<span class="token punctuation">(</span><span class="token number">1.0000</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>VarBackward0<span class="token operator">></span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1006</span><span class="token punctuation">,</span> <span class="token number">0.1004</span><span class="token punctuation">,</span> <span class="token number">0.1006</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.2988</span><span class="token punctuation">,</span> <span class="token number">1.3021</span><span class="token punctuation">,</span> <span class="token number">1.2999</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
data<span class="token punctuation">:</span> tensor<span class="token punctuation">(</span><span class="token number">2.9724e-09</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MeanBackward0<span class="token operator">></span><span class="token punctuation">)</span> tensor<span class="token punctuation">(</span><span class="token number">1.0000</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>VarBackward0<span class="token operator">></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时没有反向传播，所以weight和bias一直是1和0。首先来看，bn的输出y1,y2~N(0,1)达到了预期效果。在执行y1 = bn(x1)后的running_mean和bn.running_var也很好解释。</p>
<p>问题在于在执行y2 = bn(x2)后，running_mean和bn.running_var分别是0.1和1.3，这是怎么来的？</p>
<p>看Pytorch的解释的意思，难道是计算E((1-m)*x1+m*x2)和D((1-m)*x1+m*x2)，结果怎么算怎么不对。</p>
<p><strong>实际上应该是这样</strong><br />
<strong>running_mean = (1-m)*E(x1) + m*E(x2) = (1-0.1)*0+0.1*1 = 0.1</strong><br />
<strong>running_var = (1-m)*D(x1) + m*D(x2) = (1-0.1)*1+0.1*4 = 1.3</strong></p>
<h1 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h1>
<ol>
<li><a href="https://arxiv.org/abs/1803.08494">Group Normalization</a></li>
<li><a href="https://arxiv.org/abs/1502.03167">Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch中的Conv1d和Conv3d</title>
    <url>/2021/11/22/Pytorch%E4%B8%AD%E7%9A%84Conv1d%E5%92%8CConv3d/</url>
    <content><![CDATA[<h1 id="conv1d"><a class="markdownIt-Anchor" href="#conv1d"></a> Conv1d</h1>
<p><code>torch.nn.Conv1d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros')</code></p>
<p>和Conv2d处理<code>[N,C,H,W]</code>相比，只是处理处理的数据为<code>[N,C,L]</code>，其余相同。</p>
<span id="more"></span>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv1d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>out_channels<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>kernel_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下图的红色部分的计算过程，实际上就是这段代码。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/9bb2167bc4c9488fbf22d9bdd3a05ad1.png" width="50%"> 
</div> 
<h1 id="conv3d"><a class="markdownIt-Anchor" href="#conv3d"></a> Conv3d</h1>
<p><code>torch.nn.Conv3d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros')</code></p>
<p>处理数据为<code>[N,C,D,H,W]</code>，针对视频数据。对于公式计算，完全可以将D维度等同于H和W处理。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv3d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>out_channels<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上述代码可以看做有10帧图像，每帧图像3通道，宽高为[255,255]。3d卷积核size在(D,H,W)三个维度上分别为（4,3,3）。输出为2通道的253*253的图像，共8帧。</p>
<p>对于上述代码情况，我将其过程图画在下面。(花了半个晚上才画好)</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e83e5fc8f80c4d4c98491b6210a850aa.jpg" width="80%"> 
</div> 
<p>注意：</p>
<ol>
<li>
<p>每个卷积核为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi>D</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>h</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(D_k,h_k,W_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，所有卷积核（Weight）的维度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>D</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>h</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(C_{out},C_{in},D_k,h_k,W_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。</p>
</li>
<li>
<p>输出channel为2，因此有2种颜色的卷积核；输入channel为3，因为每个颜色的卷积核有3个（蓝块内）。</p>
</li>
<li>
<p>卷积核在输入数据（蓝块）内有三个移动方向，分别为D方向、H方向和W方向。三个方向优先级等同，就像在二维卷积中无所谓先遍历H方向，还是先遍历W方向。</p>
</li>
<li>
<p>参考二维卷积，应该是卷积核和对应位置的输入数据先相乘再求和得到一个值，然后在三个方向上移动，最终生成中间的“卷积中间结果”。将相同颜色的“卷积中间结果”相加得到最终的输出，即得到对应的输出通道值。</p>
</li>
<li>
<p>bias的维度是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[C_{out}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，一个输出维度对应一个偏置量。</p>
</li>
</ol>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://arxiv.org/abs/1408.5882">Convolutional Neural Networks for Sentence Classification</a></li>
<li><a href="https://pytorch.org/docs/1.4.0/nn.html?highlight=conv3d#torch.nn.Conv3d">Pytorch API</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch中的卷积、空洞卷积和组卷积</title>
    <url>/2021/11/21/Pytorch%E4%B8%AD%E7%9A%84%E5%8D%B7%E7%A7%AF%E3%80%81%E7%A9%BA%E6%B4%9E%E5%8D%B7%E7%A7%AF%E5%92%8C%E7%BB%84%E5%8D%B7%E7%A7%AF/</url>
    <content><![CDATA[<h1 id="标准卷积conv2d"><a class="markdownIt-Anchor" href="#标准卷积conv2d"></a> 标准卷积Conv2d</h1>
<p>最基础的卷积。下面图虽然丑了点，但足够说明问题了。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/eca4f622ceaf4ba6a6e98fc5aa733200.JPG" width="80%"> 
</div> 
注：
	（1） kernel的值在初始化中是随机生成的，可以每个值之间都不一样。				   
	（2）每个通道只对应一个bias值。
<span id="more"></span>	
<h2 id="具体操作"><a class="markdownIt-Anchor" href="#具体操作"></a> 具体操作</h2>
<p><code>torch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros')</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> a<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>:</mo><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>O</mi><mi>u</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>:</mo><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><msub><mi>C</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>W</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">         Input:(N, C_{in}, H_{in}, W_{in}) \\
        Output:(N, C_{out}, H_{out}, W_{out})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">n</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">⌊</mo><mfrac><mrow><msub><mi>H</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mn>2</mn><mo>×</mo><mtext>padding</mtext><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>−</mo><mtext>dilation</mtext><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>×</mo><mo stretchy="false">(</mo><mtext>kernel_size</mtext><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn></mrow><mrow><mtext>stride</mtext><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mfrac><mo>+</mo><mn>1</mn><mo fence="true">⌋</mo></mrow></mrow><annotation encoding="application/x-tex">  H_{out} = \left\lfloor\frac{H_{in}  + 2 \times \text{padding}[0] - \text{dilation}[0]
\times (\text{kernel\_size}[0] - 1) - 1}{\text{stride}[0]} + 1\right\rfloor </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">⌊</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">stride</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6999999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">padding</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">dilation</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">kernel_size</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">⌋</span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">⌊</mo><mfrac><mrow><msub><mi>W</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mn>2</mn><mo>×</mo><mtext>padding</mtext><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>−</mo><mtext>dilation</mtext><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>×</mo><mo stretchy="false">(</mo><mtext>kernel_size</mtext><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn></mrow><mrow><mtext>stride</mtext><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mfrac><mo>+</mo><mn>1</mn><mo fence="true">⌋</mo></mrow></mrow><annotation encoding="application/x-tex"> W_{out} = \left\lfloor\frac{W_{in}  + 2 \times \text{padding}[1] - \text{dilation}[1]
\times (\text{kernel\_size}[1] - 1) - 1}{\text{stride}[1]} + 1\right\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">⌊</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">stride</span></span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6999999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">padding</span></span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">dilation</span></span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">kernel_size</span></span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">⌋</span></span></span></span></span></span></span></p>
<p>注意：<br />
（1）如果把dilation=1带入，就是最基础的公式。<br />
（2）<strong>输出的H和W都会向下取整</strong></p>
<h1 id="空洞卷积"><a class="markdownIt-Anchor" href="#空洞卷积"></a> 空洞卷积</h1>
<p>通过torch.nn.Conv2d实现，设置不同的dilation。</p>
<p>作用是（1）用于扩大感受野。（2）不同的空洞率可以生成不同尺度的感受野。也就是可以通过不同空洞率来完成多尺度。这对于语义分割很有帮助。</p>
<p>缺点也很明显，跳过了一些信息。</p>
<p>先来一张示意图（图来自于网络）。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/8b216cc0908d4e8a85bfedc8fe729e33.gif" width="30%"> 
</div> 
上图表明：当kernel_size=3时，如果将dilation=2，就可以获得相当于kernel_size=5的感受野效果。dilation=3，相当于kernel_size=7。。。通过上面的公式计算，也可以验证。
<p>关于dilation的值可以这么理解，<strong>（dilation-1）就是两个卷积核的点之间插入的空格数</strong>。<br />
上图中卷积核中两个值的空余部分，可以是0。Pytorch中如何实现有待考证。</p>
<h1 id="组卷积"><a class="markdownIt-Anchor" href="#组卷积"></a> 组卷积</h1>
<p>通过torch.nn.Conv2d实现，设置不同的groups。</p>
<ol>
<li>
<p>groups = 1（默认值），就如同普通的卷积</p>
</li>
<li>
<p>groups = 2 分组卷积 ，相当于有两个卷积层，每一层的输入为原来输入通道数的一半，输出也为原来输出的一半，然后再连接：</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/473a62d211f844d4aeac7b50c5073a20.jpg" width="80%"> 
</div> 
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>groups<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 对权重强行赋值，前半部分全为0，后半部分全为1</span>
a1<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a1<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 查看y的值，发现前10个通道的值均为0，后10个通道的值均为45</span>
y <span class="token operator">=</span> a1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当group=3，4，…时，可按相同思路考虑。</p>
</li>
<li>
<p><strong>深度卷积depthwise，此时group=in_channels</strong>，也就是对每一个输入的通道分别用不同的卷积核卷积。out_channels必须是in_channels的整数倍。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>=</mo><mi>o</mi><mi>u</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>n</mi><mi>e</mi><mi>l</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>n</mi><mi>e</mi><mi>l</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">k=out\_channels /s in\_channels 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">s</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">s</span></span></span></span></span></p>
<p>可以这样理解：</p>
<p>假设<code>torch.nn.Conv2d(in_channels=10,out_channels=20,kernel_size=3,groups=10)</code>，<strong>input的第0个通道</strong>的值负责生成<strong>output的第0,1通道的值</strong>,input的第1个通道的值负责生成output的第2,3通道的值，以此类推。</p>
<p>类似的，当k = 1时，out_channels = in_channels,每一个卷积核分别和每一个输入的通道进行卷积，最后在concat起来。</p>
</li>
</ol>
<h1 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h1>
<ol>
<li><a href="https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md">https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md</a></li>
<li><a href="https://pytorch.org/docs/1.4.0/">https://pytorch.org/docs/1.4.0/</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch的SGD，Adam和RMSprop的分析和复现</title>
    <url>/2021/12/29/Pytorch%E7%9A%84SGD%EF%BC%8CAdam%E5%92%8CRMSprop%E7%9A%84%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>我总觉得，书本上说的是一回事，实际是另一回事。应实际看看优化器到底怎么算的，用矩阵运算把结果复现出来。</p>
<h1 id="sgd"><a class="markdownIt-Anchor" href="#sgd"></a> SGD</h1>
<p><a href="https://pytorch.org/docs/1.10.0/generated/torch.optim.SGD.html#torch.optim.SGD">官方文档</a></p>
<p>随机梯度下降(Stochastic Gradient Descent)，这要强调和GD的区别。书本上的GD是遍历完所有的样本之后进行一次梯度下降，SGD是在得到一个样本后进行一次梯度下降，mini-batch是进行一定数量的样本之后才进行一次梯度下降。而我们实际使用的时候，输入到optimizer的本身就是根据一个batch的样本得到的梯度。<strong>因此，尽管代码中名为“SGD”，实际上执行效果是书本上的mini-batch方案。</strong></p>
<span id="more"></span>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/bca6934b41f1400fa10ebc76fa6d0284.png#pic_center =80%x80%" width="80%"> 
</div> 
<p>说的已经比较明白了，但有三点要注意：</p>
<ol>
<li>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>θ</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\theta_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>就是初始参数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>g</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">g_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是第一次的梯度值</p>
</li>
<li>
<p><strong>nesterov的分支与实际情况不符，实际为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>g</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mo>+</mo><mi>μ</mi><msub><mi>b</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">g_t = g_t + \mu b_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></strong></p>
</li>
<li>
<p>当想使用nesterov时，要保证dampening=0且momentum&gt;0，否则出错。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> nesterov <span class="token keyword">and</span> <span class="token punctuation">(</span>momentum <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">or</span> dampening <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Nesterov momentum requires a momentum and zero dampening"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ol>
<p><strong>此外，官方文档明确指出：实现的算法和论文中的有一定出入！</strong> 有兴趣的可以进去看看，就是学习率位置的区别。</p>
<h1 id="adam"><a class="markdownIt-Anchor" href="#adam"></a> Adam</h1>
<p><a href="https://pytorch.org/docs/1.10.0/generated/torch.optim.Adam.html#torch.optim.Adam">官方文档</a></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/81915e4fe29345bdaf9e38c195d798f5.png#pic_center =80%x80%" width="80%"> 
</div> 
注意：
<p>amsgrad分支不同，实际情况为</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mover accent="true"><mi>v</mi><mo>^</mo></mover><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msubsup><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msubsup><mover accent="true"><mi>v</mi><mo>^</mo></mover><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msubsup><mo separator="true">,</mo><msub><mi>v</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{v}_{t}^{max}=max(\hat{v}_{t}^{max}, v_{t})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9414399999999999em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;">^</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;">^</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>θ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>−</mo><mi>γ</mi><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><msqrt><mo stretchy="false">(</mo></msqrt><msubsup><mover accent="true"><mi>v</mi><mo>^</mo></mover><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msubsup><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>β</mi><mn>2</mn><mi>t</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>ϵ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta_t=\theta_{t-1}-\gamma m_t /(\sqrt (\hat{v}_{t}^{max}/(1-\beta_2^t))+\epsilon)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.30499999999999994em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mopen" style="padding-left:1em;">(</span></span><span style="top:-2.8950000000000005em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30499999999999994em;"><span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;">^</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.043556em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7935559999999999em;"><span style="top:-2.4518920000000004em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">ϵ</span><span class="mclose">)</span></span></span></span></li>
</ul>
<h1 id="rmsprop"><a class="markdownIt-Anchor" href="#rmsprop"></a> RMSprop</h1>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/1110804e091a499f9add318a8ae62fab.png#pic_center =80%x80%" width="80%"> 
</div> 
<h1 id="代码实现"><a class="markdownIt-Anchor" href="#代码实现"></a> 代码实现</h1>
<p>通过改变<code>use_torch_optim</code>的值，来确定使用pytorch中的优化器（=1），还是自己写的优化器（=0）。观察两者的输出是否一样即可。</p>
<p>模型很简单，pred=WX，loss=mean(pred-Y)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os


<span class="token keyword">def</span> <span class="token function">seed_torch</span><span class="token punctuation">(</span>seed<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># random.seed(seed)</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PYTHONHASHSEED'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
    torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
    torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
    torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>benchmark <span class="token operator">=</span> <span class="token boolean">False</span>
    torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>deterministic <span class="token operator">=</span> <span class="token boolean">True</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Model<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>para <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 用于存储optim的相关变量</span>
        self<span class="token punctuation">.</span>para_pre <span class="token operator">=</span> self<span class="token punctuation">.</span>para

        <span class="token comment"># SGD相关</span>
        self<span class="token punctuation">.</span>gradient_pre <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># buffer, 相当于存速度</span>

        <span class="token comment"># Adam相关</span>
        self<span class="token punctuation">.</span>moment <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>velocity_max <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># RMSprop相关</span>
        self<span class="token punctuation">.</span>gradient_ave <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">calculate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>

        pred <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>para<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>para<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>pred <span class="token operator">-</span> y<span class="token punctuation">)</span>

        <span class="token keyword">return</span> pred<span class="token punctuation">,</span> loss


<span class="token keyword">def</span> <span class="token function">pytorch_optimizer</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> model<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span>

    pred<span class="token punctuation">,</span> loss <span class="token operator">=</span> model<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 置零导数</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>para


<span class="token keyword">def</span> <span class="token function">matrix_sgd</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> model<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> dampening<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> nesterov<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    pred<span class="token punctuation">,</span> loss <span class="token operator">=</span> model<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

    <span class="token comment"># 得到梯度</span>
    gradient <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> weight_decay <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        gradient <span class="token operator">=</span> gradient <span class="token operator">+</span> weight_decay <span class="token operator">*</span> model<span class="token punctuation">.</span>para_pre

    <span class="token keyword">if</span> momentum <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> idx <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            model<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> momentum <span class="token operator">*</span> model<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> dampening<span class="token punctuation">)</span> <span class="token operator">*</span> gradient
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            model<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> gradient
            model<span class="token punctuation">.</span>gradient_pre <span class="token operator">=</span> gradient

        <span class="token keyword">if</span> nesterov<span class="token punctuation">:</span>
            gradient <span class="token operator">=</span> gradient <span class="token operator">+</span> momentum <span class="token operator">*</span> model<span class="token punctuation">.</span><span class="token builtin">buffer</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            gradient <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token builtin">buffer</span>

    <span class="token comment"># 执行下降</span>
    model<span class="token punctuation">.</span>para<span class="token punctuation">.</span>data <span class="token operator">=</span> model<span class="token punctuation">.</span>para <span class="token operator">-</span> lr <span class="token operator">*</span> gradient  <span class="token comment"># 若按流程图，应是model.gradient_pre</span>

    <span class="token comment"># 保存当前梯度</span>
    model<span class="token punctuation">.</span>gradient_pre <span class="token operator">=</span> gradient

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>para


<span class="token keyword">def</span> <span class="token function">matrix_adam</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> model<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> betas<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">]</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-8</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> amsgrad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    beta1<span class="token punctuation">,</span> beta2 <span class="token operator">=</span> betas

    pred<span class="token punctuation">,</span> loss <span class="token operator">=</span> model<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token comment"># 得到梯度</span>
    gradient <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> weight_decay <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        gradient <span class="token operator">=</span> gradient <span class="token operator">+</span> weight_decay <span class="token operator">*</span> model<span class="token punctuation">.</span>para_pre

    model<span class="token punctuation">.</span>moment <span class="token operator">=</span> beta1 <span class="token operator">*</span> model<span class="token punctuation">.</span>moment <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>beta1<span class="token punctuation">)</span> <span class="token operator">*</span> gradient
    model<span class="token punctuation">.</span>velocity <span class="token operator">=</span> beta2 <span class="token operator">*</span> model<span class="token punctuation">.</span>velocity <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> beta2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>gradient <span class="token operator">*</span> gradient<span class="token punctuation">.</span>conj<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    moment <span class="token operator">=</span> model<span class="token punctuation">.</span>moment <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>beta1 <span class="token operator">**</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    velocity <span class="token operator">=</span> model<span class="token punctuation">.</span>velocity <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>beta2 <span class="token operator">**</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> amsgrad<span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>velocity_max <span class="token operator">=</span> torch<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>model<span class="token punctuation">.</span>velocity_max<span class="token punctuation">,</span> model<span class="token punctuation">.</span>velocity<span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>para<span class="token punctuation">.</span>data <span class="token operator">=</span> model<span class="token punctuation">.</span>para<span class="token operator">-</span> lr <span class="token operator">*</span> moment <span class="token operator">/</span> \
                          <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>model<span class="token punctuation">.</span>velocity_max <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>beta2 <span class="token operator">**</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> eps<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>para<span class="token punctuation">.</span>data <span class="token operator">=</span> model<span class="token punctuation">.</span>para <span class="token operator">-</span> lr <span class="token operator">*</span> moment <span class="token operator">/</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>velocity<span class="token punctuation">)</span> <span class="token operator">+</span> eps<span class="token punctuation">)</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>para

<span class="token keyword">def</span> <span class="token function">matrix_rmsprop</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> model<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> lr<span class="token punctuation">,</span>momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.99</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-8</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> centered<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    pred<span class="token punctuation">,</span> loss <span class="token operator">=</span> model<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token comment"># 得到梯度</span>
    gradient <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> weight_decay <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        gradient <span class="token operator">=</span> gradient <span class="token operator">+</span> weight_decay <span class="token operator">*</span> model<span class="token punctuation">.</span>para_pre
    
    model<span class="token punctuation">.</span>velocity <span class="token operator">=</span> alpha <span class="token operator">*</span> model<span class="token punctuation">.</span>velocity <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>alpha<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>gradient <span class="token operator">*</span> gradient<span class="token punctuation">.</span>conj<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    velocity <span class="token operator">=</span> model<span class="token punctuation">.</span>velocity

    <span class="token keyword">if</span> centered<span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>gradient_ave <span class="token operator">=</span> alpha <span class="token operator">*</span> model<span class="token punctuation">.</span>gradient_ave <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>alpha<span class="token punctuation">)</span> <span class="token operator">*</span> gradient
        velocity <span class="token operator">=</span> velocity <span class="token operator">-</span> model<span class="token punctuation">.</span>gradient_ave <span class="token operator">*</span> model<span class="token punctuation">.</span>gradient_ave<span class="token punctuation">.</span>conj<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> momentum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> momentum <span class="token operator">*</span> model<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">+</span> gradient <span class="token operator">/</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> eps<span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>para<span class="token punctuation">.</span>data <span class="token operator">=</span> model<span class="token punctuation">.</span>para <span class="token operator">-</span> lr <span class="token operator">*</span> model<span class="token punctuation">.</span><span class="token builtin">buffer</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>para<span class="token punctuation">.</span>data <span class="token operator">=</span> model<span class="token punctuation">.</span>para <span class="token operator">-</span> lr <span class="token operator">*</span> gradient <span class="token operator">/</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> eps<span class="token punctuation">)</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>para



<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>

    seed_torch<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
    use_torch_optim <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 判断是否采用pytorch的优化器</span>

    x <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    lr <span class="token operator">=</span> <span class="token number">0.01</span>
    batchsize <span class="token operator">=</span> <span class="token number">4</span>

    model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 一定要在开始训练之前定义optimizer，</span>
    <span class="token comment"># 不要再循环中定义！</span>
    <span class="token comment"># 否则每次训练optimizer都认为是一个新开始</span>
    <span class="token comment"># 相当于momentum=0的效果，dampening和nesterov也无效。</span>

    <span class="token comment"># optimizer = torch.optim.SGD(model.parameters(), lr=lr,</span>
    <span class="token comment">#                             momentum=0.1,</span>
    <span class="token comment">#                             dampening=0.1,</span>
    <span class="token comment">#                             weight_decay=0.1,</span>
    <span class="token comment">#                             nesterov=True)</span>

    optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">,</span>
                                 betas<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                 eps<span class="token operator">=</span><span class="token number">1e-8</span><span class="token punctuation">,</span>
                                 weight_decay<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
                                 amsgrad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># optimizer = torch.optim.RMSprop(model.parameters(), lr=lr,</span>
    <span class="token comment">#                                 momentum=0.1,</span>
    <span class="token comment">#                                 alpha=0.99,</span>
    <span class="token comment">#                                 eps=1e-8,</span>
    <span class="token comment">#                                 weight_decay=0.1,</span>
    <span class="token comment">#                                 centered=True)</span>

    <span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">if</span> use_torch_optim<span class="token punctuation">:</span>
            out <span class="token operator">=</span> pytorch_optimizer<span class="token punctuation">(</span>idx<span class="token punctuation">,</span> model<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> optimizer<span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># out = matrix_sgd(idx, model, x, y, lr,</span>
            <span class="token comment">#                  momentum=0.1,</span>
            <span class="token comment">#                  dampening=0,</span>
            <span class="token comment">#                  weight_decay=0.1,</span>
            <span class="token comment">#                  nesterov=True)</span>

            out <span class="token operator">=</span> matrix_adam<span class="token punctuation">(</span>idx<span class="token punctuation">,</span> model<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> lr<span class="token punctuation">,</span>
                                betas<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                eps<span class="token operator">=</span><span class="token number">1e-8</span><span class="token punctuation">,</span>
                                weight_decay<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
                                amsgrad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

            <span class="token comment"># out = matrix_rmsprop(idx, model, x, y, lr,</span>
            <span class="token comment">#                     momentum=0.1,</span>
            <span class="token comment">#                     alpha=0.99,</span>
            <span class="token comment">#                     eps=1e-8,</span>
            <span class="token comment">#                     weight_decay=0.1,</span>
            <span class="token comment">#                     centered=True)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://pytorch.org/docs/1.10.0/optim.html?highlight=torch%20optim#module-torch.optim">https://pytorch.org/docs/1.10.0/optim.html?highlight=torch optim#module-torch.optim</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch中的转置卷积</title>
    <url>/2021/11/22/Pytorch%E4%B8%AD%E7%9A%84%E8%BD%AC%E7%BD%AE%E5%8D%B7%E7%A7%AF/</url>
    <content><![CDATA[<h1 id="转置卷积transposed-convolution"><a class="markdownIt-Anchor" href="#转置卷积transposed-convolution"></a> 转置卷积(Transposed Convolution)</h1>
<p>又称为转置卷积。</p>
<p><code>torch.nn.ConvTranspose2d(in_channels, out_channels, kernel_size, stride=1, padding=0, output_padding=0, groups=1, bias=True, dilation=1, padding_mode='zeros')</code></p>
<h1 id="输出大小计算"><a class="markdownIt-Anchor" href="#输出大小计算"></a> 输出大小计算</h1>
<p>先说结论</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>s</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>2</mn><mi>p</mi><mo>+</mo><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">o&#x27; = (i&#x27; - 1)s + k - 2p+p&#x27;
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.996332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><strong><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">p&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>是<code>output_padding</code>，后面一直是在分析这个式子是怎么来的。</strong><br />
注：当有空洞卷积时，k=dilation[0]×(kernel_size[0]−1)+1</p>
<span id="more"></span>
<h2 id="起点"><a class="markdownIt-Anchor" href="#起点"></a> 起点</h2>
<p>首先回顾正常的卷积计算公式</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi><mo>=</mo><mrow><mo fence="true">⌊</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi><mo stretchy="false">)</mo></mrow><mi>s</mi></mfrac><mo fence="true">⌋</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">o = \left\lfloor {\frac{(i - k + 2p)}{s}} \right\rfloor  + 1 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">o</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">⌊</span></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">⌋</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>表示输入大小，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi></mrow><annotation encoding="application/x-tex">o</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">o</span></span></span></span>表示输出大小，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>表示卷积核大小，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span>表示pading，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span>表示卷积步长。正常来说，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>&gt;</mo><mo>=</mo><mi>o</mi></mrow><annotation encoding="application/x-tex">i&gt;=o</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">o</span></span></span></span></p>
<p>反卷积的输入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">i&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>输出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">o&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，而此时<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>&lt;</mo><mo>=</mo><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">i&#x27;&lt;=o&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.790992em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>。（毕竟我们的目的是放大图像。）<strong>带入上式得到以下，我们需要根据下面式子，反推出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">o&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>。</strong></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mrow><mo fence="true">⌊</mo><mfrac><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi></mrow><mi>s</mi></mfrac><mo fence="true">⌋</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i&#x27; = \left\lfloor {\frac{o&#x27; - k + 2p}{s}} \right\rfloor  + 1
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">⌊</span></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4288919999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">⌋</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<p>麻烦的是向下取整，所以分类讨论：</p>
<h2 id="可以整除"><a class="markdownIt-Anchor" href="#可以整除"></a> 可以整除</h2>
<p>即当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi></mrow><mo stretchy="false">)</mo><mi mathvariant="normal">%</mi><mi>s</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">({o&#x27; - k + 2p})\%{s}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span></span><span class="mclose">)</span><span class="mord">%</span><span class="mord"><span class="mord mathdefault">s</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>时，上式变为，</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mfrac><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi></mrow><mi>s</mi></mfrac><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i&#x27; = \frac{o&#x27; - k + 2p}{s} + 1
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1148919999999998em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4288919999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<p>此时反卷积的输入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">i&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>输出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">o&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>可以<strong>一一对应</strong>。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>s</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>2</mn><mi>p</mi></mrow><annotation encoding="application/x-tex">o&#x27; = (i&#x27; - 1)s + k - 2p
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span></span></span></span></span></p>
<p>代码验证</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                              out_channels<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                              kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
                              stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
                              padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                              output_padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> a2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也就是当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mn>5</mn><mi mathvariant="normal">，</mi><mi>k</mi><mo>=</mo><mn>3</mn><mi mathvariant="normal">，</mi><mi>s</mi><mo>=</mo><mn>2</mn><mi mathvariant="normal">，</mi><mi>p</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i&#x27;=5，k=3，s=2，p=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mn>11</mn></mrow><annotation encoding="application/x-tex">o&#x27;=11</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">1</span></span></span></span>。</p>
<h2 id="不可以整除"><a class="markdownIt-Anchor" href="#不可以整除"></a> 不可以整除</h2>
<p>即当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi></mrow><mo stretchy="false">)</mo><mi mathvariant="normal">%</mi><mi>s</mi><mi mathvariant="normal">≠</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">({o&#x27; - k + 2p})\%{s} \ne0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span></span><span class="mclose">)</span><span class="mord">%</span><span class="mord"><span class="mord mathdefault">s</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>时，向下取整不能去掉时。我们减去一部分，让它能取整。我们定义<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi><mo stretchy="false">)</mo><mi mathvariant="normal">%</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">p&#x27;=(o&#x27; - k + 2p)\% s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mord">%</span><span class="mord mathdefault">s</span></span></span></span>，也就是<code>output_padding</code></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi><mo>−</mo><mo stretchy="false">(</mo><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi><mo stretchy="false">)</mo><mi mathvariant="normal">%</mi><mi>s</mi></mrow><mi>s</mi></mfrac><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>p</mi><mo>−</mo><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup></mrow><mi>s</mi></mfrac><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
i&#x27; &amp;= \frac{o&#x27; - k + 2p - (o&#x27; - k + 2p)\% s}{s} + 1 \\
&amp;= \frac{o&#x27; - k + 2p - p&#x27;}{s} + 1
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.829784em;vertical-align:-2.164892em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.664892em;"><span style="top:-4.664892em;"><span class="pstrut" style="height:3.4288920000000003em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.4288920000000003em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.164892em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.664892em;"><span style="top:-4.664892em;"><span class="pstrut" style="height:3.4288920000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.428892em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mord">%</span><span class="mord mathdefault">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.4288920000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4288919999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.164892em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>反推得到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>s</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>2</mn><mi>p</mi><mo>+</mo><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">o&#x27; = (i&#x27; - 1)s + k - 2p+p&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>代码验证</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                              out_channels<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                              kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
                              stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
                              padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                              output_padding<span class="token operator">=</span><span class="token number">1</span>
                              <span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> a2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也就是当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mn>4</mn><mi mathvariant="normal">，</mi><mi>k</mi><mo>=</mo><mn>3</mn><mi mathvariant="normal">，</mi><mi>s</mi><mo>=</mo><mn>2</mn><mi mathvariant="normal">，</mi><mi>p</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">，</mi><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i&#x27;=4，k=3，s=2，p=0，p&#x27;=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">o&#x27;=10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span>。</p>
<p>回过头来说，这样直接减去一项合理吗？看着不合理，其实很合理。毕竟标准卷积也是向下取整。而这里只是取下界：</p>
<h1 id="综合起来"><a class="markdownIt-Anchor" href="#综合起来"></a> 综合起来</h1>
<p>前面一直是反推反推，还得考虑是否整除。难道你还让计算机挨个去世吗？显然不是，计算机知道的只是下面这个式子，</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>o</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>i</mi><mo mathvariant="normal">′</mo></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>s</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>2</mn><mi>p</mi><mo>+</mo><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">o&#x27; = (i&#x27; - 1)s + k - 2p+p&#x27;
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.996332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>等式右边的参数全都可以控制输入，也就是控制了输出。前文只不过是对这个式子的理解，当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">p&#x27;=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>是整除情况，当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>p</mi><mo mathvariant="normal">′</mo></msup><mi mathvariant="normal">≠</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">p&#x27;\ne0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>是不可整除情况。</p>
<h1 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h1>
<ol>
<li><a href="https://www.cnblogs.com/kk17/p/10111768.html">https://www.cnblogs.com/kk17/p/10111768.html</a></li>
<li><a href="https://www.zhihu.com/question/48279880">https://www.zhihu.com/question/48279880</a></li>
<li><a href="https://pytorch.org/docs/1.4.0/nn.html?highlight=torch%20nn%20convtranspose2d#torch.nn.ConvTranspose2d">https://pytorch.org/docs/1.4.0/nn.html?highlight=torch nn convtranspose2d#torch.nn.ConvTranspose2d</a></li>
<li><a href="https://arxiv.org/abs/1603.07285">A guide to convolution arithmetic for deep learning</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>ResNet结构详解</title>
    <url>/2021/12/16/ResNet%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="resnet的层数3450101到底指什么"><a class="markdownIt-Anchor" href="#resnet的层数3450101到底指什么"></a> ResNet的层数34,50,101到底指什么？</h1>
<p>答案并不直接，得分两步来看。</p>
<span id="more"></span>
<h2 id="首先看resnet34的对比图"><a class="markdownIt-Anchor" href="#首先看resnet34的对比图"></a> 首先看ResNet34的对比图</h2>
<p>不用看细节，也不用自己数。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/49c75f083d2a4ea4b53d6f05238b296d.JPG" width="30%"> 
</div> 
<p>这里的34层实际上是指左面的“34-layer-plain”中有34个层需要有可训练参数（卷积层和全连接层）。那么直接对比过来，ResNet34是指<strong>除去残差连接中的卷积层</strong>中的卷积层和全连接层。</p>
<p>你可能会问，残差连接不就一条线吗，哪来的可训练参数？但事实是，实线处没有，虚线处是有卷积层的，为了保证尺度相等。</p>
<h2 id="然后再看这个表"><a class="markdownIt-Anchor" href="#然后再看这个表"></a> 然后再看这个表</h2>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/c39c2f6e76da405294ffbff21139bca1.JPG#pic_center=100%x100%" width="80%"> 
</div> 
以34为例，34=1+2*（3+4+6+3）+1。
也就是，最上面的多少层是在**不考虑残差连接层中的卷积层**下，数出来“plain结构”中的可训练网络层，包含卷积层和全连接层；**而不是ResNet中所有的可训练网络层**。
<p>这一点搞了好久才搞清楚。</p>
<h1 id="resnet-到底是个什么结构"><a class="markdownIt-Anchor" href="#resnet-到底是个什么结构"></a> ResNet 到底是个什么结构</h1>
<p>你可能像我一样天真地认为，不就一个残差连接吗？那么好，有以下两个问题：（1）尺度不同怎么相加（2）如果采用Padding，具体参数是多少，是否一样？</p>
<p>事实上，ResNet-34和ResNet-50的基础结构是不一样的，这一点论文中明确指出了</p>
<h2 id="resnet-34"><a class="markdownIt-Anchor" href="#resnet-34"></a> ResNet-34</h2>
<p>残差结构是这个样子，和表中可以明显的对应，也对应第一张图中的<strong>实线连接</strong>结构。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/f225365bf1134cd8a0028e62b05ca2db.JPG" width="30%"> 
</div> 
让我们具体一点，紫色代表卷积层。这里为了通用性，没有画输入输出通道数。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/1b7c2752e674425f8bf424cbed3b05ae.JPG" width="30%"> 
</div> 
<h3 id="虚线结构"><a class="markdownIt-Anchor" href="#虚线结构"></a> 虚线结构</h3>
<p>比如ResNet34的Conv2_x的第一个卷积块，这里直接记为Conv3_1。它的输入是[56,56,64]（可根据conv2_x的输出[112,112,64]计算得到），但是Conv3_1的输出是[28,28,128]，<strong>维度不相等没有办直接相加，因此，添加了一个卷积层</strong>。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/a15d7abc931943cabcd5dbae7a65c733.JPG" width="30%"> 
</div> 
<p>具体一点，</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/2f3b7e4320ed4680beed05dd8e5a5b3a.png" width="50%"> 
</div> 
<p>有这两个结构以后就可以搭建整个网络了。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/1aa45ad308144357b3fc800f521c3c22.png" width="50%"> 
</div> 
<h2 id="resnet-50"><a class="markdownIt-Anchor" href="#resnet-50"></a> ResNet-50</h2>
<p>有了ResNet34的分析，再看这个就简单了。但是有一个不同在于一个残差单元内，ResNet50的维度发生了变化，比如从64到128。所以出现了三种不同的结构。</p>
<h3 id="第一种只用于conv2_1"><a class="markdownIt-Anchor" href="#第一种只用于conv2_1"></a> 第一种：只用于conv2_1</h3>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/939faf6fec624e5faa2c90f06544901c.JPG" width="40%"> 
</div> 
<h3 id="第二种所有的block中的非第一个"><a class="markdownIt-Anchor" href="#第二种所有的block中的非第一个"></a> 第二种：所有的Block中的非第一个</h3>
<p>以Conv2_2为例</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e670a6a908a24e6ea0fc00fe3d053467.png" width="40%"> 
</div> 
<h3 id="第三种conv3_1和conv4_1和conv5_1"><a class="markdownIt-Anchor" href="#第三种conv3_1和conv4_1和conv5_1"></a> 第三种：conv3_1和conv4_1和conv5_1</h3>
<p>相当于ResNet34的虚线结构，以conv3_1为例。此处以代码实现版本为准。需要同时处理尺度和维度的变化。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/d7fd508a72b04f9296fa1b92c4c3794e.JPG" width="60%"> 
</div> 
<p>以下是代码作者的注释</p>
<p>注意：原论文中，在虚线残差结构的主分支上，第一个1x1卷积层的步距是2，第二个3x3卷积层步距是1。<br />
但在pytorch官方实现过程中是第一个1x1卷积层的步距是1，第二个3x3卷积层步距是2，<br />
这么做的好处是能够在top1上提升大概0.5%的准确率。可参考Resnet v1.5<br />
<a href="https://ngc.nvidia.com/catalog/modelscripts/nvidia:resnet_50_v1_5_for_pytorch">https://ngc.nvidia.com/catalog/modelscripts/nvidia:resnet_50_v1_5_for_pytorch</a></p>
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1>
<ul>
<li>当通道需要增加或者H和W需要减半时，残差连接中是有卷积层的，卷积核1*1，步长为2，填充为0。</li>
<li>整个网络，无论主分支还是残差连接，在进行H和W减半时，是依赖的stride=2完成的。而padding只是负责当stride=1时，保证输入输出H和W相等。</li>
<li>回过头来看那张表，至少隐去了残差连接中的卷积层等相关信息，变成了笼统的将一个结构复制几遍。padding，stride，in_channel，out_channel等重要信息，需要自行补充后，才能搭建网络。</li>
</ul>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<p>基本上就是按照https://www.bilibili.com/video/BV1T7411T7wa?spm_id_from=333.999.0.0分析的<br />
代码来源https://github.com/WZMIAOMIAO/deep-learning-for-image-processing，也是这位UP主的。</p>
<p>感谢这位UP带我走出了很多误区！</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>SSIM和PSNR</title>
    <url>/2021/11/18/SSIM%E5%92%8CPSNR/</url>
    <content><![CDATA[<h1 id="ssim"><a class="markdownIt-Anchor" href="#ssim"></a> SSIM</h1>
<p>Structural Similarity（SSIM）结构相似性</p>
<span id="more"></span>
<h2 id="matlab版定义"><a class="markdownIt-Anchor" href="#matlab版定义"></a> Matlab版定义</h2>
<p>MatLab版见<a href="https://ww2.mathworks.cn/help/images/ref/ssim.html">官方介绍</a>。<br />
基于三个项的计算，即亮度项、对比度项和结构项。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">SSIM</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">[</mo><mi>l</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">]</mo><mi>α</mi></msup><mo>⋅</mo><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">]</mo><mi>β</mi></msup><mo>⋅</mo><mo stretchy="false">[</mo><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">]</mo><mi>γ</mi></msup></mrow><annotation encoding="application/x-tex">\operatorname{SSIM}(x, y)=[l(x, y)]^{\alpha} \cdot[c(x, y)]^{\beta} \cdot[s(x, y)]^{\gamma}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">S</span><span class="mord mathrm">S</span><span class="mord mathrm">I</span><span class="mord mathrm">M</span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.0037em;">α</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.149108em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">β</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05556em;">γ</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mn>2</mn><msub><mi>μ</mi><mi>x</mi></msub><msub><mi>μ</mi><mi>y</mi></msub><mo>+</mo><msub><mi>C</mi><mn>1</mn></msub></mrow><mrow><msubsup><mi>μ</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>μ</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>C</mi><mn>1</mn></msub></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>c</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mn>2</mn><msub><mi>σ</mi><mi>x</mi></msub><msub><mi>σ</mi><mi>y</mi></msub><mo>+</mo><msub><mi>C</mi><mn>2</mn></msub></mrow><mrow><msubsup><mi>σ</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>C</mi><mn>2</mn></msub></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msub><mi>σ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>+</mo><msub><mi>C</mi><mn>3</mn></msub></mrow><mrow><msub><mi>σ</mi><mi>x</mi></msub><msub><mi>σ</mi><mi>y</mi></msub><mo>+</mo><msub><mi>C</mi><mn>3</mn></msub></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
l(x, y) &amp;=\frac{2 \mu_{x} \mu_{y}+C_{1}}{\mu_{x}^{2}+\mu_{y}^{2}+C_{1}} \\
c(x, y) &amp;=\frac{2 \sigma_{x}{\sigma_{y}}+C_{2}}{\sigma_{x}^{2}+\sigma_{y}^{2}+C_{2}} \\
s(x, y) &amp;=\frac{\sigma_{x y}+C_{3}}{\sigma_{x} \sigma_{y}+C_{3}}
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:8.091314em;vertical-align:-3.7956570000000003em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.295657em;"><span style="top:-6.295657em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-3.5662190000000002em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-0.836781em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7956570000000003em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.295657em;"><span style="top:-6.295657em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.069108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.5662190000000002em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.069108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.836781em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7956570000000003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span></span></span></span>表示均值和方差。</p>
<p>如果 α = β = γ = 1（Exponents 的默认值），且 C3 = C2/2（C 3 的默认选择），则索引简化为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">SSIM</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>μ</mi><mi>x</mi></msub><msub><mi>μ</mi><mi>y</mi></msub><mo>+</mo><msub><mi>C</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>+</mo><msub><mi>C</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow></mrow><mrow><mrow><mo fence="true">(</mo><msubsup><mi>μ</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>μ</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>C</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><msubsup><mi>σ</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>C</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\operatorname{SSIM}(x, y)=\frac{\left(2 \mu_{x} \mu_{y}+C_{1}\right)\left(2 \sigma_{x y}+C_{2}\right)}{\left(\mu_{x}^{2}+\mu_{y}^{2}+C_{1}\right)\left(\sigma_{x}^{2}+\sigma_{y}^{2}+C_{2}\right)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">S</span><span class="mord mathrm">S</span><span class="mord mathrm">I</span><span class="mord mathrm">M</span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.550108em;vertical-align:-1.123108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.26em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.123108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h3 id="性质"><a class="markdownIt-Anchor" href="#性质"></a> 性质：</h3>
<ol>
<li>Symmetry: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo separator="true">,</mo><mi mathvariant="bold">y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><mi mathvariant="bold">y</mi><mo separator="true">,</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(\mathbf{x}, \mathbf{y})=S(\mathbf{y}, \mathbf{x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mclose">)</span></span></span></span>;</li>
<li>Boundedness: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo separator="true">,</mo><mi mathvariant="bold">y</mi><mo stretchy="false">)</mo><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S(\mathbf{x}, \mathbf{y}) \leq 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>;</li>
<li>Unique maximum: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo separator="true">,</mo><mi mathvariant="bold">y</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S(\mathbf{x}, \mathbf{y})=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> if and only if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold">x</mi><mo>=</mo><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}=\mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span> (in discrete representations, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_{i}=y_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> for all <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">i=1,2, \cdots, N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> );</li>
</ol>
<h3 id="使用方式"><a class="markdownIt-Anchor" href="#使用方式"></a> 使用方式</h3>
<pre class="line-numbers language-Matlab" data-language="Matlab"><code class="language-Matlab">ssimval &#x3D; ssim(A,ref)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="python版实现"><a class="markdownIt-Anchor" href="#python版实现"></a> Python版实现</h2>
<p><a href="https://scikit-image.org/docs/dev/auto_examples/transform/plot_ssim.html">官方解释</a> ：MSE不能很好的考虑到纹理，因此引入SSIM。</p>
<h3 id="使用方式-2"><a class="markdownIt-Anchor" href="#使用方式-2"></a> 使用方式</h3>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from skimage.metrics import structural_similarity as ssim
import matplotlib.pyplot as plt
# 针对多通道图像，默认最后一维度为通道，每个通道进行单独计算，然后平均
a &#x3D; plt.imread(&#39;a.jpg&#39;)
b &#x3D; plt.imread(&#39;b.jpg&#39;)
result &#x3D; ssim(a,b,multichannel&#x3D;True) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>采用公式为</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">SSIM</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>μ</mi><mi>x</mi></msub><msub><mi>μ</mi><mi>y</mi></msub><mo>+</mo><msub><mi>C</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>+</mo><msub><mi>C</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow></mrow><mrow><mrow><mo fence="true">(</mo><msubsup><mi>μ</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>μ</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>C</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><msubsup><mi>σ</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>C</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\operatorname{SSIM}(x, y)=\frac{\left(2 \mu_{x} \mu_{y}+C_{1}\right)\left(2 \sigma_{x y}+C_{2}\right)}{\left(\mu_{x}^{2}+\mu_{y}^{2}+C_{1}\right)\left(\sigma_{x}^{2}+\sigma_{y}^{2}+C_{2}\right)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">S</span><span class="mord mathrm">S</span><span class="mord mathrm">I</span><span class="mord mathrm">M</span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.550108em;vertical-align:-1.123108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.26em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.123108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub><mo>=</mo><msup><mrow><mo fence="true">(</mo><msub><mi>K</mi><mn>1</mn></msub><mi>L</mi><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">C_{1}=\left(K_{1} L\right)^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.204008em;vertical-align:-0.25em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>2</mn></msub><mo>=</mo><msup><mrow><mo fence="true">(</mo><msub><mi>K</mi><mn>2</mn></msub><mi>L</mi><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">C_{2}=\left(K_{2} L\right)^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.204008em;vertical-align:-0.25em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>K</mi><mn>1</mn></msub><mo>=</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">K_{1}=0.01</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">1</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>K</mi><mn>1</mn></msub><mo>=</mo><mn>0.03</mn></mrow><annotation encoding="application/x-tex">K_{1}=0.03</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">3</span></span></span></span>。 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span>是动态范围：若像素值为[0,255]，则<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>=</mo><mn>255</mn></mrow><annotation encoding="application/x-tex">L=255</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">5</span></span></span></span>。</p>
<h1 id="psnr"><a class="markdownIt-Anchor" href="#psnr"></a> PSNR</h1>
<p>峰值信噪比Peak signal-to-noise ratio，单位是dB</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>S</mi><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi>m</mi><mi>n</mi></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><mo stretchy="false">[</mo><mi>I</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>−</mo><mi>K</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">]</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">M S E=\frac{1}{m n} \sum_{i=0}^{m-1} \sum_{j=0}^{n-1}[I(i, j)-K(i, j)]^{2} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2148900000000005em;vertical-align:-1.4137769999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mi>S</mi><mi>N</mi><mi>R</mi><mo>=</mo><mn>10</mn><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>10</mn></msub><mrow><mo fence="true">(</mo><mfrac><msup><mrow><mo fence="true">(</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn><mo fence="true">)</mo></mrow><mn>2</mn></msup><mrow><mi>M</mi><mi>S</mi><mi>E</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P S N R=10 \log _{10}\left(\frac{\left(2^{n}-1\right)^{2}}{M S E}\right) 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.631008em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span></span></span></p>
<p>其中，n表示图像位数，比如n=8。</p>
<p>多通道图像如RGB图像，在计算MSE时就进行了进行了平均，最终MSE是标量。</p>
<h2 id="python的使用方式"><a class="markdownIt-Anchor" href="#python的使用方式"></a> Python的使用方式</h2>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from skimage.metrics import peak_signal_noise_ratio as psnr
a &#x3D; plt.imread(&#39;a.jpg&#39;)
b &#x3D; plt.imread(&#39;b.jpg&#39;)
psnr_ &#x3D; psnr(a,b)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：数据类型不同会导致psnr值不同。</p>
<h1 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h1>
<ol>
<li>Image quality assessment: From error visibility to structural similarity. IEEE Transactions on Image Processing, <a href="https://ece.uwaterloo.ca/~z70wang/publications/ssim.pdf">https://ece.uwaterloo.ca/~z70wang/publications/ssim.pdf</a></li>
<li><a href="https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio">https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio</a></li>
</ol>
<h1 id="遗留问题"><a class="markdownIt-Anchor" href="#遗留问题"></a> 遗留问题</h1>
<p>SSIM是怎么考虑纹理等信息的</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>图像补全</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu18.04和win10使用ZerotierOne进行mstsc远程连接</title>
    <url>/2020/08/29/Ubuntu18-04%E5%92%8Cwin10%E4%BD%BF%E7%94%A8ZerotierOne%E8%BF%9B%E8%A1%8Cmstsc%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>先来解释一下这个标题</p>
<ul>
<li>为什么要远程连接</li>
</ul>
<p>这里主要是针对实验室的情况。比如实验室有一台服务器，上面有多个账户，每个用户每次使用都要跑到服务器面前，这是很不合适的，也很不方便。更重要的是，即便用户不嫌麻烦每次都跑过去，但是这种使用服务器的方式，每次仅限一人使用，不能多人同时使用。</p>
<p>远程连接，可以解决这个问题。<strong>它不仅可以让你在你自己的座位上使用服务器，更是支持多人同时使用一台服务器。</strong> 目前远程连接的代表性软件，就是Teamviewer。</p>
<span id="more"></span>
<ul>
<li>
<p>为什么使用mstsc</p>
<p>用Teamviewer连远程连接不好吗？Teamviewer确实好用，但是它现在收费了。<strong>而微软自带的mstsc（远程桌面连接）就是Teamviewer优秀的替代品之一。</strong> mstsc不仅在win10上有，在win7上也有，它的使用很简单：给出目标的IP地址，输入自己设置的登录名和密码，即可使用。</p>
</li>
<li>
<p>为什么使用Zerotier One</p>
<p>如果说这个实验室的所有用户（包括服务器），都连接在同一个路由器上，那么所有用户将会组成一个局域网（内网）。这种情况下，用户使用路由器分配给服务器的内网的IP，就可以使用mstsc。此时不仅不用网费，速度既快还稳定。</p>
<p>但是，用户要是不在实验室呢，比方说在宿舍，他就连不了实验室的路由器，进不了实验室内网。这种情况下，就需要组建一个虚拟专用网络（VPN），<strong>而zerotier one就是组建这个“虚拟内网”的</strong>。我相信说到这，大学上过计算机网络的同学，应该能理解了。不妨说得再细一点，Zerotier one可将一些在不同地方的零散的用户节点，通过一些技术，组建成一个“虚拟内网”，达到“这些用户都连在同一个路由器”的效果。</p>
<p>不过值得一提的是，这种“虚拟内网”的连接速度不如真正内网，还会产生网络通信费用。</p>
<p>回到问题，为什么使用Zerotier One。<strong>因为Zerotier One现在还是免费的。</strong> 你可以在上面自己创建一个账户，然后自己创建一个Network。只要其他用户进了这个Network，就相当于进了“虚拟内网”。一个Network，最多可免费支持100个设备连入。</p>
</li>
<li>
<p>最后一个问题，为什么是Ubuntu和win10</p>
<p>win10操作系统用着多熟练？服务器上为什么不装win10？我也想啊，但是事实不允许。</p>
<p>我们忽略底层自由度的问题，说点更实际的。实验室的服务器是用于跑代码的，Github上开源的论文代码基本上都是针对Ubuntu系统下的。即使你都用Pycharm和Anaconda，代码在Ubuntu和win10下的环境配置还是略有不同的。如果服务器只是运行现成封装好的程序，兴许可以装win10。</p>
<p>更为重要的是，<strong>Ubuntu系统支持多用户同时访问，win10似乎不能支持。</strong> 至少我目前尝试的是这样。</p>
</li>
</ul>
<p>下文，我就是小王同学，描述一下如何从装Ubuntu系统到使用mstsc。</p>
<h1 id="ubuntu-1804-的安装"><a class="markdownIt-Anchor" href="#ubuntu-1804-的安装"></a> Ubuntu 18.04 的安装</h1>
<p>链接1：<a href="https://ubuntu.com/tutorials/install-ubuntu-desktop#1-overview">官方教程</a><br />
链接2：<a href="https://www.cnblogs.com/masbay/p/11627727.html">参考过的教程</a></p>
<p>Ubuntu最新版安装文件<a href="https://ubuntu.com/download/desktop">官方下载地址</a>（写这篇文章时最新的是20.04.1）。按照我以往的习惯，不会安装最新版本的，理由是在使用最新版本时遇到问题，网上可能还没有经验分享。Ubuntu 18.04.4安装文件<a href="https://ubuntu.com/download/alternative-downloads">官方下载地址</a>，注意网页要下拉才能看见</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200829204917113.JPG?x-oss-process=image#pic_center=80%x80%" width="80%"> 
</div> 
<p>使用U盘安装Ubuntu的大致的步骤是</p>
<ol>
<li>下载Ubuntu安装iso文件</li>
<li>制作U盘启动器:</li>
</ol>
<ul>
<li>（1）<a href="https://ubuntu.com/tutorials/create-a-usb-stick-on-windows#1-overview">官方教程</a></li>
<li>（2）需要下载一个<a href="https://rufus.ie/">Rufus</a>作为在WIndows系统下的U盘启动器制作软件，使用方式根据教程即可</li>
</ul>
<ol start="3">
<li>（若是想装双系统的话）将目标电脑的磁盘，空出一部分空间（比如70G）。这一步可以先新建出一块70G的分区，然后删除分区。这部分空间将用于安装Ubuntu系统</li>
<li>设置BIOS启动项优先级</li>
<li>安装Ubuntu</li>
</ol>
<p>如果连win10都没有，可以先装个win10，<a href="https://mp.weixin.qq.com/s/jzM3s_TGpOUjcolSmUPgWA">教程</a></p>
<h1 id="ubuntu上mstsc安装相关"><a class="markdownIt-Anchor" href="#ubuntu上mstsc安装相关"></a> Ubuntu上mstsc安装相关</h1>
<p>这部分主要参考（搬运）SauryGo的<a href="https://blog.csdn.net/sean2100/article/details/80998437">教程</a>，感谢大佬！另外小王同学也融合了一点自己的经验。打开终端：</p>
<ol>
<li>安装xfce4（或xubuntu）</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> xfce4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或者</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> xubuntu-desktop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>安装xrdp和协议，依次执行</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> xrdp 
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> vnc4server tightvncserver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="3">
<li>启动xrdp</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /etc/init.d/xrdp restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="4">
<li>配置文件</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> xfce4-session <span class="token operator">></span>~/.xsession<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>小王同学<strong>并没有执行下面这句</strong>，发现也可以。反倒是执行之后就蓝屏了，需要重启。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> xrdp restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>有时候重启也不行，这里放一个使用xrdp连接ubuntu然后蓝屏或者闪退的<a href="https://blog.csdn.net/cxn304/article/details/99733711">解决方案</a>，同时也感谢cxn304大佬！这里我直接搬运过来，依次执行这几条命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://www.c-nergy.be/downloads/install-xrdp-3.0.zip
<span class="token function">unzip</span> install-xrdp-3.0.zip
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> Install-xrdp-3.0.sh
./Install-xrdp-3.0.sh
<span class="token function">sudo</span> <span class="token function">shutdown</span> <span class="token parameter variable">-r</span> now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果第四条命令Install执行失败或者报错，很有可能是因为你系统默认的是中文。假设你的用户名是ubuntu，Install安装路径是/home/ubuntu/Downloads，而你的ubuntu下面有文件夹“下载”，却没有“Downloads”。此时只需在/home/ubuntu/下面，创建一个文件夹“Downloads”，再执行第四条命令。</p>
<h1 id="ubuntu添加用户"><a class="markdownIt-Anchor" href="#ubuntu添加用户"></a> Ubuntu添加用户</h1>
<p>对于服务器而言，需要分配多账户，同时供多人使用。打开终端：</p>
<ol>
<li>添加用户的登录名（如：dogdog）</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> adduser dogdog<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>然后终端输出：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">输入新的 UNIX 口令：  <span class="token comment">#设置dogdog的登录密码</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">重新输入新的 UNIX 口令：  <span class="token comment">#再次输入确认密码</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>接着输入一些无关紧要的信息，如无误，输入Y并回车：</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/2020082922143253.jfif?x-oss-process=image" width="80%"> 
</div> 
<ol start="2">
<li>设置新用户的sudo权限。打开终端：</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gedit /etc/sudoers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>添加‘’dogdog ALL=(ALL:ALL) ALL‘’，保存退出</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200829213958632.jpg?x-oss-process=image#pic_center=80%x80%" width="80%"> 
</div> 
<ol start="3">
<li>配置文件</li>
</ol>
<ul>
<li>切换用户</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">su</span> dogdog<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>输入密码后，然后执行</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> xfce4-session <span class="token operator">></span>~/.xsession<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="zerotier-one的注册与使用"><a class="markdownIt-Anchor" href="#zerotier-one的注册与使用"></a> Zerotier One的注册与使用</h1>
<p>实际上对于办公室内的局域网而言，上述步骤已经足够了。但对于想远程办公的人来说，需要使用Zerotier One。这是一个内网穿透平台，可以这样理解：只要加入一个Network，就相当于进入了这个Network内部的局域网。</p>
<p><strong>重要的是，Zerotier One目前还是免费的！</strong><a href="https://www.zerotier.com/">Zerotier One官网链接</a></p>
<p>可以参考这个<a href="https://www.jianshu.com/p/9f7691cb32d3">教程</a></p>
<h2 id="1-注册zerotier-one账户并创建网络"><a class="markdownIt-Anchor" href="#1-注册zerotier-one账户并创建网络"></a> 1. 注册Zerotier One账户，并创建网络</h2>
<ul>
<li>按照提示即可</li>
<li>这里要提醒一下，你登录进去后，Networks才是你创建的“局域网”。（第一次给妹子表演如何用Zerotier One时，小王同学表演崩了就是因为没找到这个“局域网”）</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200829221238247.JPG?x-oss-process=image" width="80%"> 
</div> 
<h2 id="2-安装在ubuntu上"><a class="markdownIt-Anchor" href="#2-安装在ubuntu上"></a> 2. 安装在Ubuntu上</h2>
<ul>
<li><a href="https://www.zerotier.com/download/">官方教程</a>，其实就一条命令：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-s</span> https://install.zerotier.com <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>如果Ubuntu告诉你没有curl，先安装：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>让Ubuntu加入你的Network</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> zerotier-cli <span class="token function">join</span> 你的network ID<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>Ubuntu即使有多个用户，加入一次Network即可对所有用户生效</li>
<li>Ubuntu加入后，登录Zerotier One中进入到你的Network</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200907121449616.png?x-oss-process=image" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200907121449573.png?x-oss-process=image" width="80%"> 
</div> 
<ul>
<li>找到新加入的设备，在前面打钩（表示授权），并可以修改备注。	小王同学建议先改备注，后打√。Managed IPs一栏就是该设备在这个“局域网”的IP地址。“局域网”内部的设备可通过这个IP相互访问。</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200829222638767.JPG?x-oss-process=image#pic_center=80%x80%" width="80%"> 
</div> 
<h2 id="3-安装在win10上"><a class="markdownIt-Anchor" href="#3-安装在win10上"></a> 3. 安装在Win10上</h2>
<ul>
<li>安装文件下载：<a href="https://zerotier.com/download/">官网连接</a></li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200829222134934.JPG?x-oss-process=image#pic_center=80%x80%" width="80%"> 
</div> 
<ul>
<li>安装好之后运行，在任务栏图标右键，选 join networks</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20200829223325452.JPG?x-oss-process=image#pic_center=80%x80%" width="80%"> 
</div> 
- 输入你的network ID，然后join。你的win10申请加入后，在Zerotier One中进入到你的Network，找到新加入的设备，在前面打钩（表示授权）同意申请。（同上述Ubuntu对应步骤）
- 之后win10应该会弹出下图“网络”，点是。然后在你在网络名称之前出现对勾，就是上图蓝色马赛克之前的那个√。
<div align="center">
<img src="https://img-blog.csdnimg.cn/20200829224451280.JPG?x-oss-process=image" width="50%" height="80%">
</div>
<h1 id="mstsc的使用"><a class="markdownIt-Anchor" href="#mstsc的使用"></a> mstsc的使用</h1>
<ol>
<li>打开“运行”，输入“mstsc”，回车。</li>
</ol>
<div align="center">
<img src="https://img-blog.csdnimg.cn/20200829224901833.JPG?x-oss-process=imag" width="50%" height="50%">
</div>
<div align="center">
<img src="https://img-blog.csdnimg.cn/20200829224924671.JPG?x-oss-process=image" width="80%" height="80%">
</div>
<ol start="2">
<li>出现对话框，输入“局域网”内的IP地址，回车</li>
</ol>
<div align="center">
<img src="https://img-blog.csdnimg.cn/20200829225119315.JPG?x-oss-process=image" width="50%" >
</div>
<ul>
<li>这里的IP地址可以是办公室局域网内部的ip，也可以是通过Zerotier One搭建的虚拟局域网IP，查询虚拟局域网IP详见上文“Zerotier One的注册与使用 / Ubuntu的安装”最后一步</li>
</ul>
<ol start="3">
<li>输入登录名和密码</li>
</ol>
<div align="center">
<img src="https://img-blog.csdnimg.cn/2020090712222122.png?x-oss-process=image" width="80%" height="80%">
</div>
<ol start="4">
<li>点OK，连接上，开始办公!</li>
</ol>
<h1 id="总结与致谢"><a class="markdownIt-Anchor" href="#总结与致谢"></a> 总结与致谢</h1>
<ul>
<li>与其说这是个教程，不如说这是给自己写的总结笔记。</li>
<li>感谢李师兄前期艰苦探索，前人栽树，后人乘凉。</li>
<li>感谢实验室同学对小王同学的忍耐。毕竟在初期尝试阶段，服务器被我反复蹂躏，光系统就重装了两次。</li>
<li>这是小王第一次写CSDN，对上述流程也是囫囵吞枣。说起来，在探索的时候也闹了不少笑话，甚至经常丢人。但是如有错误，小王同学恳请大家指正！</li>
</ul>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu18.04+Caffe(GPU)+MATLAB接口</title>
    <url>/2021/01/02/Ubuntu18_04-CaffeGPU-MATLAB%E6%8E%A5%E5%8F%A3/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>之前为了重装系统，不得不先保证自己可以会配Caffe的GPU版本的MATLAB接口，才敢大胆地删掉师姐辛辛苦苦配成的代码环境。毕竟一重装系统，那些代码环境都烟消云散了。我是在Ubuntu18.04上完成的这件事：Caffe的GPU版本（安装了CUDA但没有安装CUDNN，结果上并不影响代码使用显卡资源）配置MatlabR2017a的接口。</p>
<span id="more"></span>
<p>在网上找啊找，有很多讲如何配置Caffe的Python接口的，就是没有一篇详细地从头到尾讲如何配置Caffe的Matlab接口的。以摸索整整四天时间的代价，换来现在这一个经验教程。<strong>为了让看到这篇文章的人省事，我把Caffe配置文件中该填的坑都填了，只需要把几行命令复制粘贴执行即可。如果顺利的话，十分钟就能装完。</strong></p>
<p>我从给机器安装Ubuntu开始写，为了阅读体验，分成了几个博客。这是最后一个，也是最关键的一个。因为这个接口非常容易出错，之前尝试了很多次，查了很多经验贴，这里直接上最终版方案。</p>
<p><strong>在看这篇博客之前，你需要已经装好了Ubuntu18.04，CUDA，MatlabR2017a，OpenCV3.4.2，版本不一定严格对应。</strong> 没有的可以看看这两篇<br />
<a href="https://blog.csdn.net/a171232886/article/details/112069313">Ubuntu18.04安装和CUDA安装</a><br />
<a href="https://blog.csdn.net/a171232886/article/details/112075763">Ubuntu18.04安装MatlabR2017a和OpenCV3.4.2</a></p>
<p>没错，这两篇都是为了现在这篇的准备工作。“Ubuntu18.04安装MatlabR2017a和OpenCV3.4.2”，看看这前言不搭后语的题目，其实可以一共写5篇的，但为了简洁，就这样吧。</p>
<h1 id="安装caffe"><a class="markdownIt-Anchor" href="#安装caffe"></a> 安装Caffe</h1>
<h2 id="安装caffe相关文件"><a class="markdownIt-Anchor" href="#安装caffe相关文件"></a> 安装Caffe相关文件</h2>
<p><a href="http://caffe.berkeleyvision.org/install_apt.html">官方教程地址</a>，写的太简略，难以看懂</p>
<p>1.安装相关的软件和依赖</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> caffe-cuda
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libhdf5-serial-dev protobuf-compiler libopenblas-dev liblapack-dev libatlas-base-dev libgflags-dev libgoogle-glog-dev liblmdb-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> --no-install-recommends libboost-all-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> cmake-qt-gui<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.下载Caffe源代码</p>
<p><a href="https://github.com/BVLC/caffe/">官方Github地址</a>，亲测可完成sudo make runtest，但无法完成sudo make mattest，会出错误，如<a href="https://blog.csdn.net/sethinking/article/details/90441407">ubuntu16.04 matlab2017b 编译caffe的matlab接口 吐血经历</a>。同时感谢这位大佬提供的解决方案，本文正是按照此种方案完成的。</p>
<p><a href="https://github.com/gy1874/caffe-rpnbf-cudnn5"><strong>正确Caffe代码地址</strong></a>，如果下的慢可以使用<a href="https://pan.baidu.com/s/1Uhf1pUBnAsyDsGWwW3GM4Q">百度网盘链接</a>提取码：bmq9</p>
<p>我的百度网盘分享中包含三个文件，压缩包是那个正确Caffe代码（Github下载），剩下的两个是我配置好的文件，可以直接用的那种。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101181157988.PNG#pic_center" width="80%"> 
</div> 
<ul>
<li>把压缩包解压，对应的文件夹名caffe-rpnbf-cudnn5-master改为caffe（不改也行，只是为了方便）</li>
<li>把Makefile和Makefile.config替换掉caffe文件夹下的同名文件</li>
</ul>
<p>3.网盘中Makefile.config文件相对于Makefile.config.example的修改</p>
<ul>
<li>Cuda路径<br />
Makefile.config第30行</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CUDA_DIR :<span class="token operator">=</span> /usr/local/cuda-10.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>Matlab路径<br />
Makefile.config第68行</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">MATLAB_DIR :<span class="token operator">=</span> /usr/local/MATLAB/R2017a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果是CUDA和MATLAB安装时选择默认路径的话，以上两项不必再改。对于不求甚解的同学，只关注上两个地方即可，<mark><strong>下面可跳过</strong></mark>。以下为网盘中Makefile.config文件相对于Makefile.config.example的其他修改处。</p>
<ul>
<li>CUDA_ARCH<br />
Makefile.config第39行开始，相较于原来,将前两项注释掉，修改为:</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CUDA_ARCH :<span class="token operator">=</span> <span class="token comment">#-gencode arch=compute_20,code=sm_20 \</span>
<span class="token comment">#-gencode arch=compute_20,code=sm_21 \</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_30,code<span class="token operator">=</span>sm_30 <span class="token punctuation">\</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_35,code<span class="token operator">=</span>sm_35 <span class="token punctuation">\</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_50,code<span class="token operator">=</span>sm_50 <span class="token punctuation">\</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_52,code<span class="token operator">=</span>sm_52 <span class="token punctuation">\</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_60,code<span class="token operator">=</span>sm_60 <span class="token punctuation">\</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_61,code<span class="token operator">=</span>sm_61 <span class="token punctuation">\</span>
<span class="token parameter variable">-gencode</span> <span class="token assign-left variable">arch</span><span class="token operator">=</span>compute_61,code<span class="token operator">=</span>compute_61<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>依赖项<br />
Makefile.config第98行，修改如下</li>
</ul>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">INCLUDE_DIRS :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>PYTHON_INCLUDE<span class="token variable">)</span></span> /usr/local/include /usr/include/hdf5/serial/
LIBRARY_DIRS :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>PYTHON_LIB<span class="token variable">)</span></span> /usr/lib/x86_64-linux-gnu/hdf5/serial <span class="token punctuation">\</span>
            /usr/local/lib /usr/lib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>OpenCV<br />
Makefile.config第23行，去掉注释，修改如下</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">OPENCV_VERSION :<span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4.网盘中Makefile文件相对于Makefile原文件的修改 <mark><strong>（可跳过）</strong></mark><br />
参考<a href="https://blog.csdn.net/qq_33144323/article/details/81741671">recipe for target ‘.build_release/lib/libcaffe.so.1.0.0’ failed</a><br />
Makefile第181行，修改为</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">LIBRARIES <span class="token operator">+=</span> glog gflags protobuf boost_system boost_filesystem m hdf5_serial_hl hdf5_serial<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="修改环境变量和相关依赖项"><a class="markdownIt-Anchor" href="#修改环境变量和相关依赖项"></a> 修改环境变量和相关依赖项</h2>
<ol>
<li>修改环境变量</li>
</ol>
<ul>
<li>打开环境变量</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gedit ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>在.bashrc最后添加</li>
</ul>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_PRELOAD</span><span class="token operator">=</span>/usr/lib/x86_64-linux-gnu/libtiff.so.5:/usr/lib/x86_64-linux-gnu/libstdc++.so.6:/usr/lib/x86_64-linux-gnu/libprotobuf.so.9
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/lib/x86_64-linux-gnu/:/usr/local/cuda-10.2/lib64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101202559213.PNG#pic_center" width="80%"> 
</div> 
<ul>
<li>使修改的环境变量生效</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>修改Matlab中的文件<br />
参考<a href="https://askubuntu.com/questions/758892/doesnt-matlab-work-on-ubuntu-16-04">Doesn’t Matlab work on ubuntu 16.04?<br />
</a><br />
将/usr/local/MATLAB/R2017a/sys/os/glnxa64/中的libstdc++.so.6重命名为libstdc++.so.6.old，使其失效。</li>
</ol>
<h2 id="配置caffe的matlab接口"><a class="markdownIt-Anchor" href="#配置caffe的matlab接口"></a> 配置Caffe的MATLAB接口</h2>
<p>依次运行以下命令。-j32是指32核cpu同时运行，这样会快很多。（建议先查一下机器是多少核cpu，我这里是32核。）</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">make</span> all matcaffe <span class="token parameter variable">-j32</span>
<span class="token function">sudo</span> <span class="token function">make</span> mattest  <span class="token parameter variable">-j32</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也可直接运行以下命令，会自动执行第一个命令</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">make</span> mattest  <span class="token parameter variable">-j32</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><mark><strong>若看见下图，恭喜！编译成功！</strong></mark></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101204415951.PNG?x-oss-process=image" width="80%"> 
</div> 
<h1 id="在matlabr2017a中使用caffe"><a class="markdownIt-Anchor" href="#在matlabr2017a中使用caffe"></a> 在MatlabR2017a中使用Caffe</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CAFFEPATH <span class="token operator">=</span> <span class="token string">'/media/HardDisk_C/caffe/'</span><span class="token punctuation">;</span>   % Caffe文件夹所在路径
                        
USE_GPU <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         % <span class="token builtin class-name">set</span> to false, <span class="token keyword">if</span> no GPU available -<span class="token operator">></span> slowest
GPU_ID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>             % 使用第0块显卡
addpath<span class="token punctuation">(</span><span class="token punctuation">[</span>CAFFEPATH <span class="token string">'/matlab'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> USE_GPU
  caffe.set_mode_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  caffe.set_device<span class="token punctuation">(</span>GPU_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
  caffe.set_mode_cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>此时，需保证第0块显卡有足够的显存空间，否则Matlab会闪退！</strong></p>
<p>下图是我从代码运行结果中挑出的一张比较喜欢的图片</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101205328519.PNG?x-oss-process=image" width="80%"> 
</div> 
大功告成！
<h1 id="值得参考的经验资料"><a class="markdownIt-Anchor" href="#值得参考的经验资料"></a> 值得参考的经验资料</h1>
<p>1.<a href="https://blog.csdn.net/sethinking/article/details/90441407">ubuntu16.04 matlab2017b 编译caffe的matlab接口 吐血经历 解决几乎所有make mattest问题</a></p>
<p>2.<a href="https://www.cnblogs.com/yangyuqing/p/12932434.html">ubuntu18.04系统安装caffe过程</a></p>
<p>3.<a href="https://blog.csdn.net/qq_36429298/article/details/68314590">caffe常错问题及解决方案</a></p>
<p>4.<a href="https://blog.csdn.net/CAU_Ayao/article/details/83536320#1__18">Ubuntu18.04LTS下基于 Anaconda3 安装和编译 Caffe-GPU</a></p>
<p>5.<a href="https://www.cnblogs.com/captain-dl/p/11012710.html">糟心的caffe+ matlab编译路程</a></p>
<h1 id="附caffe的python接口"><a class="markdownIt-Anchor" href="#附caffe的python接口"></a> 附：Caffe的Python接口</h1>
<p>1.用conda安装不香吗？</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> caffe-gpu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>只要有Anaconda，运行这条命令即可，不必在装cuda，下caffe，改环境变量，conda包办一切。</p>
<p>2.使用import caffe</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101210321228.PNG#pic_center" width="80%"> 
</div> 
<h1 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h1>
<p>鉴于小王同学在研究Caffe的MATLAB接口时，没有一篇博客的方法从头到尾对他所在的情况都是正确的。小王在一些问题的解决方案上，甚至搞出了排列组合，所以他纯粹是试出来的。鉴于这种情况，小王想起了一句话：万物皆虚,万事皆允。</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu18.04安装MatlabR2017a和OpenCV3.4.2</title>
    <url>/2021/01/02/Ubuntu18_04%E5%AE%89%E8%A3%85MatlabR2017a%E5%92%8COpenCV3_4_2/</url>
    <content><![CDATA[<h1 id="安装matlabr2017a"><a class="markdownIt-Anchor" href="#安装matlabr2017a"></a> 安装MatlabR2017a</h1>
<h2 id="文件下载"><a class="markdownIt-Anchor" href="#文件下载"></a> 文件下载</h2>
<p>明显只能<a href="https://pan.baidu.com/s/1KKcxNSArKZXYtA50kI6cIg">百度网盘</a>，提取码：hj0x<br />
我把文件保存到了/media/HardDisk/公共安装包/MATLAB_R2017a_install/文件夹下</p>
<span id="more"></span>
<h2 id="挂载镜像"><a class="markdownIt-Anchor" href="#挂载镜像"></a> 挂载镜像</h2>
<ul>
<li>为了避免麻烦，先修改一下读写权限</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> /media/HardDisk/公共安装包/MATLAB_R2017a_install/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>创建一个文件夹，用于挂载镜像</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/ <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>挂载镜像，格式为  sudo mount -o loop iso文件 用于挂载的文件夹</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-o</span> loop <span class="token string">'/media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/R2017a_glnxa64_dvd1.iso'</span> <span class="token string">'/media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/matlab'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="开始安装"><a class="markdownIt-Anchor" href="#开始安装"></a> 开始安装</h2>
<p>启动安装</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> 
<span class="token function">sudo</span> /media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol>
<li>使用文件安装密钥，下一步</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101224829968.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
2. 是，下一步
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101224907580.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
3. 输入密钥09806-07443-53955-64350-21751-41297，下一步
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101224934771.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
4. 默认路径即可，下一步
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101225212142.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
5. 默认全选，下一步
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101225246848.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
6. 重点来了，需要弹出DVD1 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101225323763.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
<ul>
<li>
<p>方法1：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">umount</span> <span class="token string">'/media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/R2017a_glnxa64_dvd1.iso'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>方法2：在文件管理器中找到MATHWORKS_R2017A，右键卸载。（这张图是我在Ubuntu20.04上安装Matlab照的，Ubuntu18.04一样）</p>
</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101232732281.jpg?x-oss-process=image" width="80%"> 
</div> 
然后挂载DVD2，再点确定
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-o</span> loop <span class="token string">'/media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/R2017a_glnxa64_dvd2.iso'</span> <span class="token string">'/media/HardDisk/公共安装包/MATLAB_R2017a_install/matlab/matlab'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="7">
<li>安装结束</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101233103363.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
<h2 id="破解"><a class="markdownIt-Anchor" href="#破解"></a> 破解</h2>
<p>1.把Matlab+2017a+Linux64+Crack.zip中的两个文件复制到对应位置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> license_standalone.lic /usr/local/MATLAB/R2017a/licenses/ 
<span class="token function">sudo</span> <span class="token function">cp</span> libmwservices.so /usr/local/MATLAB/R2017a/bin/glnxa64/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2.运行Matlab，Ubuntu20.04直接出现以下窗口</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/MATLAB/R2017a/bin/matlab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102105048248.PNG?x-oss-process=image" width="80%"> 
</div> 
Ubuntu18.04可能会出现以下窗口，按步骤来即可
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102105426855.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
许可证就是Matlab+2017a+Linux64+Crack.zip中的license_standalone.lic
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/2021010210543938.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102105500218.PNG?x-oss-process=image#pic_center" width="80%"> 
</div> 
如果遇到权限不够情况，就加上sudo
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /usr/local/MATLAB/R2017a/bin/matlab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="xfce4下的快捷方式设置"><a class="markdownIt-Anchor" href="#xfce4下的快捷方式设置"></a> Xfce4下的快捷方式设置</h2>
<p>1.桌面右键，创建启动器</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102110519391.PNG" width="30%"> 
</div> 
<p>2.名称随便写一个，比如Matlab。</p>
<ul>
<li>命令<code>/usr/local/MATLAB/R2017a/bin/matlab</code>，<br />
或者<code>sudo /usr/local/MATLAB/R2017a/bin/matlab</code>。</li>
<li>选上在终端运行。</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102110531387.PNG?x-oss-process=image" width="30%"> 
</div> 
<p>3.下次直接点创建的启动器就可以了</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/2021010211081367.PNG?x-oss-process=image" width="80%"> 
</div> 
<h1 id="安装opencv345使用cmake-gui"><a class="markdownIt-Anchor" href="#安装opencv345使用cmake-gui"></a> 安装OpenCV3.4.5（使用cmake-gui）</h1>
<h2 id="文件下载和其他准备"><a class="markdownIt-Anchor" href="#文件下载和其他准备"></a> 文件下载和其他准备</h2>
<p>1.安装cmake-gui和其他相关文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> cmake <span class="token function">git</span> libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> cmake-qt-gui<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.OpenCV3.4.5文件下载<br />
<a href="https://opencv.org/releases/">官网链接</a>，可以选合适的版本<br />
<a href="https://pan.baidu.com/s/1fEsxmnSEb3RLjSL2cqKmcA">百度网盘</a>，提取码：chtk</p>
<h2 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2>
<ol>
<li>将OpenCV3.4.5压缩包解压以后，在OpenCV3.4.5文件夹路径下运行终端</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build 
cmake-gui <span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>弹出如下界面。</li>
</ol>
<ul>
<li>选择source code，就是OpenCV3.4.5文件夹</li>
<li>build路径，就是刚才建立的build文件夹</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102111930391.PNG?x-oss-process=image" width="50%"> 
</div> 
<ol start="3">
<li>弹出以下对话框，不用管，默认即可，点Finish</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102112208107.PNG?x-oss-process=image" width="50%"> 
</div> 
<ol start="4">
<li>可以见到如下界面。<br />
见到Configuring Done即可</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102114737376.PNG?x-oss-process=image" width="50%"> 
</div> 
<p>去掉三个地方的√，ENABLE_PRECOMPILED_HEADERS，WITH_CUDA，WITH_CUFFT<br />
（此处参考<a href="https://www.cnblogs.com/yangyuqing/p/12932434.html">ubuntu18.04系统安装caffe过程</a>，这里装OpenCV是为了安装Caffe）</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102113143481.PNG" width="30%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102113143487.PNG" width="30%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102113338280.PNG" width="20%"> 
</div> 
<p>点击Generate生成配置文件</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102114927375.PNG?x-oss-process=image" width="50%"> 
</div> 
<ol start="5">
<li>在build目录下，运行以下代码，开始安装</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>最终可以看到</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102113938491.PNG?x-oss-process=image" width="80%"> 
</div> 
6. 运行代码查看OpenCV版本
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pkg-config <span class="token parameter variable">--modversion</span> opencv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210102114047971.PNG" width="80%"> 
</div> 
安装完成！
<h1 id="值得参考的经验资料"><a class="markdownIt-Anchor" href="#值得参考的经验资料"></a> 值得参考的经验资料</h1>
<ol>
<li><a href="https://blog.csdn.net/new_delete_/article/details/84797041?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control">Ubuntu 18.04安装OpenCV4.0和环境配置</a></li>
<li><a href="https://blog.csdn.net/jindunwan7388/article/details/80397700?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-3&amp;spm=1001.2101.3001.4242">Ubuntu16.04中用CMake-gui安装OpenCV3.2.0和OpenCV_contrib-3.2.0</a></li>
<li><a href="https://blog.csdn.net/beizhengren/article/details/100514590">Ubuntu18.04安装MatlabR2017b</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu18_04安装和CUDA安装</title>
    <url>/2021/01/01/Ubuntu18_04%E5%AE%89%E8%A3%85%E5%92%8CCUDA%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="ubuntu1804安装"><a class="markdownIt-Anchor" href="#ubuntu1804安装"></a> Ubuntu18.04安装</h1>
<h2 id="安装文件下载"><a class="markdownIt-Anchor" href="#安装文件下载"></a> 安装文件下载</h2>
<p><a href="https://releases.ubuntu.com/18.04/ubuntu-18.04.5-desktop-amd64.iso.torrent?_ga=2.100472542.1350456251.1609506650-303532577.1607936879">Ubuntu18.04官方链接64位</a><br />
<a href="https://github.com/pbatard/rufus/releases/download/v3.13/rufus-3.13.exe">Rufus官方下载</a><br />
<a href="https://pan.baidu.com/s/1fiQVe_QjokMF4sN7kWe2LQ">以上两者的百度网盘</a>，提取码：ico2</p>
<span id="more"></span>
<h2 id="制作u盘启动器"><a class="markdownIt-Anchor" href="#制作u盘启动器"></a> 制作U盘启动器</h2>
<p>1.运行Rufus</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/2021010121152169.PNG?x-oss-process=image" width="50%"> 
</div> 
<p>2.选择U盘（设备），选择镜像文件（引导类型选择），其余默认。然后点击开始，制作完成。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101211708623.PNG?x-oss-process=image" width="50%"> 
</div> 
<h2 id="更改bios启动顺序"><a class="markdownIt-Anchor" href="#更改bios启动顺序"></a> 更改BIOS启动顺序</h2>
<ul>
<li>进入BIOS的快捷键因机器而异，仔细观察机器的启动界面总会有所发现。</li>
<li>将启动顺序优先级最高调整为USB，若有好几个带USB的选项，就都试一下，只要进入以下界面就可以。</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101212253319.jpg?x-oss-process=image" width="80%"> 
</div> 
<h2 id="按提示安装ubuntu"><a class="markdownIt-Anchor" href="#按提示安装ubuntu"></a> 按提示安装Ubuntu</h2>
<ol>
<li>
<p>上图选择中文（简体），然后点安装Ubuntu</p>
</li>
<li>
<p>键盘布局，不用管，点继续</p>
</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101212439507.jpg?x-oss-process=image" width="80%"> 
</div> 
3. 继续
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101212504898.jpg?x-oss-process=image" width="80%"> 
</div> 
4. 创建第一个账号，可以随便写。它要是说此名称已经被使用，那就把网线拔了，再写，点继续以后再把网线插上就行。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101212525634.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="5">
<li><mark><strong>关键一步</strong></mark></li>
</ol>
<ul>
<li>第一个选项是相当于清楚现存的操作系统（可以是win10，也可以是Ubuntu16.04），然后装Ubuntu18.04</li>
<li>第二个选项是相当于装双系统</li>
<li>第三个选项没点过，应该是清除机器上的全部数据，再装Ubuntu</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101212525555.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="6">
<li>继续</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101212525140.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="7">
<li>等待安装完成，并按提示拔出U盘启动器</li>
</ol>
<h2 id="装完系统之后的几件事"><a class="markdownIt-Anchor" href="#装完系统之后的几件事"></a> 装完系统之后的几件事</h2>
<ul>
<li>更新系统</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>设置root密码，关键时刻有用</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">passwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>安装vim文本编辑器，关键时刻有用</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>安装驱动，特别是显卡驱动。就这一条命令就行了。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ubuntu-drivers autoinstall<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这时候运行下面这条命令，应该会看见</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvidia-smi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>应该会看见，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Fri Jan  <span class="token number">1</span> <span class="token number">22</span>:04:39 <span class="token number">2021</span>       
+-----------------------------------------------------------------------------+
<span class="token operator">|</span> NVIDIA-SMI <span class="token number">455.38</span>       Driver Version: <span class="token number">455.38</span>       CUDA Version: <span class="token number">11.1</span>     <span class="token operator">|</span>
<span class="token operator">|</span>-------------------------------+----------------------+----------------------+
<span class="token operator">|</span> GPU  Name        Persistence-M<span class="token operator">|</span> Bus-Id        Disp.A <span class="token operator">|</span> Volatile Uncorr. ECC <span class="token operator">|</span>
<span class="token operator">|</span> Fan  Temp  Perf  Pwr:Usage/Cap<span class="token operator">|</span>         Memory-Usage <span class="token operator">|</span> GPU-Util  Compute M. <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>               MIG M. <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">0</span>  GeForce GTX <span class="token number">108</span><span class="token punctuation">..</span>.  Off  <span class="token operator">|</span> 00000000:01:00.0 Off <span class="token operator">|</span>                  N/A <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">22</span>%   38C    P8    10W / 250W <span class="token operator">|</span>    121MiB / 11177MiB <span class="token operator">|</span>      <span class="token number">0</span>%      Default <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>                  N/A <span class="token operator">|</span>
+-------------------------------+----------------------+----------------------+
<span class="token operator">|</span>   <span class="token number">1</span>  GeForce GTX <span class="token number">108</span><span class="token punctuation">..</span>.  Off  <span class="token operator">|</span> 00000000:02:00.0 Off <span class="token operator">|</span>                  N/A <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">21</span>%   30C    P8     9W / 250W <span class="token operator">|</span>     11MiB / 11178MiB <span class="token operator">|</span>      <span class="token number">0</span>%      Default <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>                  N/A <span class="token operator">|</span>
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
<span class="token operator">|</span> Processes:                                                                  <span class="token operator">|</span>
<span class="token operator">|</span>  GPU   GI   CI        PID   Type   Process name                  GPU Memory <span class="token operator">|</span>
<span class="token operator">|</span>        ID   ID                                                   Usage      <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">0</span>   N/A  N/A      <span class="token number">1286</span>      G   /usr/lib/xorg/Xorg                 14MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">0</span>   N/A  N/A      <span class="token number">1562</span>      G   /usr/bin/gnome-shell               14MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">0</span>   N/A  N/A     <span class="token number">20063</span>      G   /usr/lib/xorg/Xorg                 65MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">0</span>   N/A  N/A     <span class="token number">20185</span>      G   /usr/bin/gnome-shell               21MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span>   N/A  N/A      <span class="token number">1286</span>      G   /usr/lib/xorg/Xorg                  4MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span>   N/A  N/A      <span class="token number">1562</span>      G   /usr/bin/gnome-shell                0MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span>   N/A  N/A     <span class="token number">20063</span>      G   /usr/lib/xorg/Xorg                  4MiB <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span>   N/A  N/A     <span class="token number">20185</span>      G   /usr/bin/gnome-shell                0MiB <span class="token operator">|</span>
+-----------------------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以再尝试一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> nvidia-smi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="安装cuda"><a class="markdownIt-Anchor" href="#安装cuda"></a> 安装CUDA</h1>
<h2 id="下载cuda版本"><a class="markdownIt-Anchor" href="#下载cuda版本"></a> 下载CUDA版本</h2>
<ul>
<li>根据<a href="https://developer.nvidia.com/zh-cn/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1804&amp;target_type=runfilelocal">NVIDIA官方</a>，选择合适的CUDA（会自动帮你选）</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101214748461.PNG?x-oss-process=image" width="80%"> 
</div> 
比如，他就推荐我安装CUDA11.1。这里不必过于纠结装哪个版本的CUDA，特别是对于使用Anaconda管理Python环境的同学。若是用Anaconda管理Python环境，不装CUDA都行，因为它会在你所安装的库（比如tensorflow-gpu）需要的时候，自动给你装对应版本的cudatoolkit。
<p>运行他给出的命令。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://developer.download.nvidia.com/compute/cuda/11.1.0/local_installers/cuda_11.1.0_455.23.05_linux.run
<span class="token function">sudo</span> <span class="token function">sh</span> cuda_11.1.0_455.23.05_linux.run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>也可以根据<a href="https://developer.nvidia.com/cuda-toolkit-archive">CUDA Toolkit Archive</a>，自己挑选适合自己的CUDA版本</li>
</ul>
<h2 id="按提示安装"><a class="markdownIt-Anchor" href="#按提示安装"></a> 按提示安装</h2>
<p>1.选Continue</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101215752721.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="2">
<li>输入accept</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101215841449.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="3">
<li>选要安装的文件，因为刚才已经安装过驱动了，所以把Driver前的×去掉，不装。也由此可见，Anaconda安装的cudatoolkit是cuda的一部分。然后Install</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101215912139.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="4">
<li>看到这个界面就是装完了</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210101220119617.jpg?x-oss-process=image" width="80%"> 
</div> 
<ol start="5">
<li>设置环境变量</li>
</ol>
<ul>
<li>打开环境变量</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gedit ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>在.bashrc最后添加</li>
</ul>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/cuda-10.2/bin<span class="token variable">$&#123;<span class="token environment constant">PATH</span><span class="token operator">:+</span><span class="token operator">:</span>$PATH&#125;</span><span class="token punctuation">&#125;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_HOME</span><span class="token operator">=</span>/usr/local/cuda-10.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>使修改的环境变量生效</li>
</ul>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>运行nvcc -V，查看CUDA版本</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvcc <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvcc: NVIDIA <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Cuda compiler driver
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2005</span>-2019 NVIDIA Corporation
Built on Wed_Oct_23_19:24:38_PDT_2019
Cuda compilation tools, release <span class="token number">10.2</span>, V10.2.89<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>安装成功！</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu20.04更换镜像源解决下载失败</title>
    <url>/2022/02/12/Ubuntu20.04%E6%9B%B4%E6%8D%A2%E9%95%9C%E5%83%8F%E6%BA%90%E8%A7%A3%E5%86%B3%E4%B8%8B%E8%BD%BD%E5%A4%B1%E8%B4%A5/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>因为默认下载源在国外，有时候会出现下载失败的问题。可更换国内源。</p>
<p>其实就是几条命令</p>
<span id="more"></span>
<h1 id="更换源"><a class="markdownIt-Anchor" href="#更换源"></a> 更换源</h1>
<ol>
<li>
<p>备份</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-v</span> /etc/apt/sources.list /etc/apt/sources.list.backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>修改权限并编辑</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /etc/apt/sources.list
<span class="token function">sudo</span> gedit /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>
<p>原有配置替换为阿里源</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>或者阿里源</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse

deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>更新</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ol>
<h1 id="原始配置"><a class="markdownIt-Anchor" href="#原始配置"></a> 原始配置</h1>
<p>附：source.list的原始文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#deb cdrom:[Ubuntu 20.04.3 LTS _Focal Fossa_ - Release amd64 (20210819)]/ focal main restricted</span>

<span class="token comment"># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</span>
<span class="token comment"># newer versions of the distribution.</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal main restricted
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal main restricted</span>

<span class="token comment">## Major bug fix updates produced after the final release of the</span>
<span class="token comment">## distribution.</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal-updates main restricted
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal-updates main restricted</span>

<span class="token comment">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span>
<span class="token comment">## team. Also, please note that software in universe WILL NOT receive any</span>
<span class="token comment">## review or updates from the Ubuntu security team.</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal universe
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal universe</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal-updates universe
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal-updates universe</span>

<span class="token comment">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu </span>
<span class="token comment">## team, and may not be under a free licence. Please satisfy yourself as to </span>
<span class="token comment">## your rights to use the software. Also, please note that software in </span>
<span class="token comment">## multiverse WILL NOT receive any review or updates from the Ubuntu</span>
<span class="token comment">## security team.</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal multiverse
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal multiverse</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal-updates multiverse
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal-updates multiverse</span>

<span class="token comment">## N.B. software from this repository may not have been tested as</span>
<span class="token comment">## extensively as that contained in the main release, although it includes</span>
<span class="token comment">## newer versions of some applications which may provide useful features.</span>
<span class="token comment">## Also, please note that software in backports WILL NOT receive any review</span>
<span class="token comment">## or updates from the Ubuntu security team.</span>
deb http://us.archive.ubuntu.com/ubuntu/ focal-backports main restricted universe multiverse
<span class="token comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ focal-backports main restricted universe multiverse</span>

<span class="token comment">## Uncomment the following two lines to add software from Canonical's</span>
<span class="token comment">## 'partner' repository.</span>
<span class="token comment">## This software is not part of Ubuntu, but is offered by Canonical and the</span>
<span class="token comment">## respective vendors as a service to Ubuntu users.</span>
<span class="token comment"># deb http://archive.canonical.com/ubuntu focal partner</span>
<span class="token comment"># deb-src http://archive.canonical.com/ubuntu focal partner</span>

deb http://security.ubuntu.com/ubuntu focal-security main restricted
<span class="token comment"># deb-src http://security.ubuntu.com/ubuntu focal-security main restricted</span>
deb http://security.ubuntu.com/ubuntu focal-security universe
<span class="token comment"># deb-src http://security.ubuntu.com/ubuntu focal-security universe</span>
deb http://security.ubuntu.com/ubuntu focal-security multiverse
<span class="token comment"># deb-src http://security.ubuntu.com/ubuntu focal-security multiverse</span>

<span class="token comment"># This system was installed using small removable media</span>
<span class="token comment"># (e.g. netinst, live or single CD). The matching "deb cdrom"</span>
<span class="token comment"># entries were disabled at the end of the installation process.</span>
<span class="token comment"># For information about how to configure apt package sources,</span>
<span class="token comment"># see the sources.list(5) manual.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu20.04搭建Hexo环境</title>
    <url>/2022/11/27/Ubuntu20.04%E6%90%AD%E5%BB%BAHexo%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<h1 id="0-前言"><a class="markdownIt-Anchor" href="#0-前言"></a> 0. 前言</h1>
<p>这几天，特别是双11，小王实在忍受不了CSDN的广告。于是准备重操旧业，使用git+hexo记笔记，做博客。而之前在win10上的环境都没了，现在打算在Ubuntu中创建环境，因为在VMware+Ubuntu的环境管理和迁移很方便。</p>
<span id="more"></span>
<h1 id="1-预备"><a class="markdownIt-Anchor" href="#1-预备"></a> 1. 预备</h1>
<ol>
<li>
<p>安装VMware，并创建Ubuntu环境，可以参照我之前的<a href="https://a171232886.github.io/2022/11/27/VMWare%E5%AE%89%E8%A3%85Ubuntu20.04%E8%99%9A%E6%8B%9F%E6%9C%BA/">VMWare安装Ubuntu20.04虚拟机</a></p>
</li>
<li>
<p>（可选）Win10安装vscode</p>
</li>
<li>
<p>在Ubuntu中安装以下工具</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">git</span> gcc g++ <span class="token function">ssh</span> <span class="token function">vim</span> tree
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nodejs <span class="token function">npm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h1 id="2-安装hexo"><a class="markdownIt-Anchor" href="#2-安装hexo"></a> 2. 安装hexo</h1>
<h2 id="21-安装和构建"><a class="markdownIt-Anchor" href="#21-安装和构建"></a> 2.1 安装和构建</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> blog
<span class="token builtin class-name">cd</span> blog

<span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> hexo-cli <span class="token parameter variable">-g</span>
hexo init
hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>浏览器打开http://localhost:4000/</p>
<img src="/images/Ubutnu20.04搭建Hexo环境/image-20221127141624143.png" alt="image-20221127141624143" style="zoom:50%;" />
<h2 id="22-问题解决"><a class="markdownIt-Anchor" href="#22-问题解决"></a> 2.2 问题解决</h2>
<p>执行<code>hexo s</code>出现</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FATAL 
TypeError: Object.fromEntries is not a <span class="token keyword">function</span>
    at exists.then.filter.then.modules <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/hexo/lib/hexo/load_plugins.js:43:19<span class="token punctuation">)</span>
    at tryCatcher <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/util.js:16:23<span class="token punctuation">)</span>
    at Promise._settlePromiseFromHandler <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:547:31<span class="token punctuation">)</span>
    at Promise._settlePromise <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:604:18<span class="token punctuation">)</span>
    at Promise._settlePromise0 <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:649:10<span class="token punctuation">)</span>
    at Promise._settlePromises <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:729:18<span class="token punctuation">)</span>
    at Promise._fulfill <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:673:18<span class="token punctuation">)</span>
    at MappingPromiseArray.PromiseArray._resolve <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise_array.js:127:19<span class="token punctuation">)</span>
    at MappingPromiseArray.init <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise_array.js:75:18<span class="token punctuation">)</span>
    at Promise._settlePromise <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:601:21<span class="token punctuation">)</span>
    at Promise._settlePromise0 <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:649:10<span class="token punctuation">)</span>
    at Promise._settlePromises <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/promise.js:729:18<span class="token punctuation">)</span>
    at _drainQueueStep <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/async.js:93:12<span class="token punctuation">)</span>
    at _drainQueue <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/async.js:86:9<span class="token punctuation">)</span>
    at Async._drainQueues <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/async.js:102:5<span class="token punctuation">)</span>
    at Immediate.Async.drainQueues <span class="token punctuation">[</span>as _onImmediate<span class="token punctuation">]</span> <span class="token punctuation">(</span>/home/test/Desktop/blog/node_modules/bluebird/js/release/async.js:15:14<span class="token punctuation">)</span>
    at runCallback <span class="token punctuation">(</span>timers.js:705:18<span class="token punctuation">)</span>
    at tryOnImmediate <span class="token punctuation">(</span>timers.js:676:5<span class="token punctuation">)</span>
    at processImmediate <span class="token punctuation">(</span>timers.js:658:5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要更新nodejs版本</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> n
<span class="token function">sudo</span> n stable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>网络原因，可能需要尝试几次。然后重新执行2.1的命令</p>
<h1 id="3-更换markdown-render"><a class="markdownIt-Anchor" href="#3-更换markdown-render"></a> 3. 更换markdown-render</h1>
<p>为了使用<code>==高亮==</code><mark>高亮</mark>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Katex</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span></span></span></span>公式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">npm</span> uninstall hexo-renderer-marked <span class="token parameter variable">--save</span>
<span class="token function">sudo</span> <span class="token function">npm</span> i @upupming/hexo-renderer-markdown-it-plus <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="4-vscode中的使用效果"><a class="markdownIt-Anchor" href="#4-vscode中的使用效果"></a> 4. vscode中的使用效果</h1>
<p>（这里使用了ssh连接到了ubutnu虚拟机）<br />
左侧编辑，右侧预览，也能在win10中的浏览器打开预览版的网页，只是地址变成了<code>http://localhost:4001/</code>。</p>
<img src="/images/Ubutnu20.04搭建Hexo环境/image-20221127143421614.png" alt="image-20221127143421614" style="zoom:80%;" />
<h1 id="5-参考"><a class="markdownIt-Anchor" href="#5-参考"></a> 5. 参考</h1>
<ol>
<li><a href="https://jiangyao-zh.github.io/posts/hexo-new-page-fatal-typeerror-object-fromentries-is-not-a-function/">https://jiangyao-zh.github.io/posts/hexo-new-page-fatal-typeerror-object-fromentries-is-not-a-function/</a></li>
<li><a href="https://blog.csdn.net/qq_36667170/article/details/105846999">https://blog.csdn.net/qq_36667170/article/details/105846999</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu下查看CPU、内存和硬盘详细信息的几个命令</title>
    <url>/2021/11/19/Ubuntu%E4%B8%8B%E6%9F%A5%E7%9C%8BCPU_%E5%86%85%E5%AD%98%E5%92%8C%E7%A1%AC%E7%9B%98%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E7%9A%84%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>转载自https://www.cnblogs.com/shixiangwan/p/7066085.html</p>
<p>CPU：<br />
型号：<code>grep &quot;model name&quot; /proc/cpuinfo |awk -F ':' '&#123;print $NF&#125;'</code></p>
<p>内存数量：<code>sudo dmidecode -t memory |grep -A16 &quot;Memory Device$&quot; |grep 'Size:.*MB' |wc -l</code></p>
<p>内存支持类型：<code>sudo dmidecode -t memory |grep -A16 &quot;Memory Device$&quot; |grep &quot;Type:&quot;</code></p>
<p>每个内存频率：<code>sudo dmidecode -t memory |grep -A16 &quot;Memory Device$&quot; |grep &quot;Speed:&quot;</code></p>
<p>每个内存大小：<code>sudo dmidecode -t memory |grep -A16 &quot;Memory Device$&quot; |grep &quot;Size:&quot;</code></p>
<p>硬盘：<br />
硬盘数量、大小：<code>sudo fdisk -l |grep &quot;Disk /dev/sd&quot;</code></p>
<p>硬盘型号：<code>sudo hdparm -i /dev/sda |grep &quot;Model&quot;</code></p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>Ubuntu多机之间，与Win10之间，使用samba进行图形化界面文件共享</title>
    <url>/2022/02/10/Ubuntu%E5%A4%9A%E6%9C%BA%E4%B9%8B%E9%97%B4%EF%BC%8C%E4%B8%8EWin10%E4%B9%8B%E9%97%B4%EF%BC%8C%E4%BD%BF%E7%94%A8samba%E8%BF%9B%E8%A1%8C%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>预想达到的效果：多台Ubuntu之间，Ubuntu和win10之间，只用ip地址就可可以进行<mark>图形化界面文件共享</mark>。比如以下效果，看上去就是一个特殊的文件夹。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/641fb644abc7430d98e6dc36c1c188af.png" width="80%"> 
</div> 
<p>这样的效果对于含多台ubuntu服务器的实验室来说是很有帮助的，<strong>既可以免去用硬盘在多服务器上拷贝数据的痛苦，又可以用自己的win10电脑轻易查看服务器文件</strong>。</p>
<p>我们使用的插件是samba，<strong>只需在ubuntu上进行安装</strong>，即可实现上述效果。<br />
官方要求Ubuntu16.04，<strong>实测Ubuntu18.04,Ubuntu20.04也可以</strong>。</p>
<span id="more"></span>
<p>其实你完全可以按照<a href="https://ubuntu.com/tutorials/install-and-configure-samba#4-setting-up-user-accounts-and-connecting-to-share">官方教程</a>来操作，官方写的挺好的没有坑。这本是去年这个时候在实验室里倒腾明白的东西，现在毕业了才突然想起来写篇博客。</p>
<h1 id="安装samba"><a class="markdownIt-Anchor" href="#安装samba"></a> 安装samba</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> samba<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>检测一下是否安装正确，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">whereis</span> samba<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>应该返回</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">samba: /usr/sbin/samba /usr/lib/samba /etc/samba /usr/share/samba /usr/share/man/man7/samba.7.gz /usr/share/man/man8/samba.8.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="设置共享文件夹"><a class="markdownIt-Anchor" href="#设置共享文件夹"></a> 设置共享文件夹</h1>
<p>可新建一个用于共享的文件夹，这个文件夹下面的文件，都可以远程读写。也可以直接用已有的文件夹。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /home/ubuntu/sambashare/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>编辑samba文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在最后添加以下代码，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>share<span class="token punctuation">]</span>
    comment <span class="token operator">=</span> Samba on Ubuntu
    path <span class="token operator">=</span> /media/
    <span class="token builtin class-name">read</span> only <span class="token operator">=</span> no
    browsable <span class="token operator">=</span> <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-Ctrl-O```保存修改，```Ctrl-X```退出。" data-language="Ctrl-O```保存修改，```Ctrl-X```退出。"><code class="language-Ctrl-O```保存修改，```Ctrl-X```退出。">
重启samba服务

&#96;&#96;&#96;bash
sudo service smbd restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>防火墙相关设置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow samba<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>附：（1）上述代码说明</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>share<span class="token punctuation">]</span> <span class="token comment"># 远程访问时共享文件夹的名字，官方是sambashare</span>
    comment <span class="token operator">=</span> Samba on Ubuntu
    path <span class="token operator">=</span> /media/  <span class="token comment"># 共享文件夹路径，比如将整个media文件夹共享</span>
    <span class="token builtin class-name">read</span> only <span class="token operator">=</span> no  <span class="token comment"># 此时允许远程修改文件</span>
    browsable <span class="token operator">=</span> <span class="token function">yes</span> <span class="token comment"># Ubuntu中共享文件夹可在文件管理器中出现在左侧栏</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>（2）如果你用的是<code>vim</code>文本编辑器(<code>sudo nano /etc/samba/smb.conf</code>)：</p>
<ul>
<li>先输入<code>i</code>然后回车,在最后添加代码，</li>
<li>按esc退出输入模式</li>
<li>输入<code>:wq</code>保存推迟</li>
</ul>
<p>还是建议使用<code>nano</code>，一是有操作提示，二是提示还是中文的。如果你用的<code>gedit</code>那就更方便了。</p>
<h1 id="设置访问账号"><a class="markdownIt-Anchor" href="#设置访问账号"></a> 设置访问账号</h1>
<p>samba使用<mark>ubuntu中已有的登录账号</mark>，比如设置用户名为ubuntu的账号</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> smbpasswd <span class="token parameter variable">-a</span> ubuntu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果一个服务器多账户，建议每个账户都设置一遍。</p>
<h1 id="win10访问"><a class="markdownIt-Anchor" href="#win10访问"></a> Win10访问</h1>
<p>在文件管理器地址栏，输入<code>\\ip地址\\共享文件夹显示名</code>，比如<code>\\192.168.193.121\share</code>。（<mark>注意斜线方向</mark>）弹出对话框，输入账户密码，确定。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/ba467fada8554ffa96152e05c4ce2f7c.png#pic_center =50%x50%" width="40%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/ecc3c93021b9457e81e4c84bced5c1e5.png#pic_center =80%x80%" width="80%"> 
</div> 
<h1 id="ubuntu访问"><a class="markdownIt-Anchor" href="#ubuntu访问"></a> Ubuntu访问</h1>
<p>在文件管理器地址栏，输入<code>smb://ip地址/共享文件夹显示名</code>，比如<code>smb://192.168.193.200/share</code>。输入账户密码，确定。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/7a5c8d02a5d245608e2986d5f1b52fd2.png#pic_center =50%x50%" width="30%"> 
</div> 
<p>注意左下角，如果上面选择“记到注销之前”或者“永远记住”，是会保留的。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/d39ea531a1a2420db4fe4b7cbb8301d5.png#pic_center =80%x80%" width="80%"> 
</div> 
<h1 id="多说一点"><a class="markdownIt-Anchor" href="#多说一点"></a> 多说一点</h1>
<p>如果在远程文件夹中打开终端，会发现有一串地址，比如</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/9abb8e561aa64e11ac0f45c17a0c2e33.png" width="80%"> 
</div> 
这个地址（蓝色部分）甚至可以在Python程序中使用，完成对文件的远程读写。读写速度主要取决于网速。
<h1 id="最后"><a class="markdownIt-Anchor" href="#最后"></a> 最后</h1>
<p>写了这么多，真正要执行的只有六条核心命令，其余都是验证性或辅助性的。</p>
<p>既然已经毕业了，这应该是小王关于实验室服务器管理写的最后一篇博客吧。回过头来看，管理实验室服务器固然事情繁杂琐碎，但是也得到了很多东西，有技术上的，更有技术之外的感动和收获。总结起来，实验室服务器管理更像是非代码技术，因为管理的核心是管理使用服务器的人。</p>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://ubuntu.com/tutorials/install-and-configure-samba#1-overview">install-and-configure-samba</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>VMWare安装Ubuntu20.04虚拟机</title>
    <url>/2022/11/27/VMWare%E5%AE%89%E8%A3%85Ubuntu20.04%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
    <content><![CDATA[<h1 id="0-前言"><a class="markdownIt-Anchor" href="#0-前言"></a> 0. 前言</h1>
<p>对于研究生或者科研人员来讲，通常需要同时用到Win10和Ubutnu。如果手底下只有一个机器，最好最安全也是最便捷的方法是创建Ubuntu虚拟机。</p>
<span id="more"></span>
<h1 id="1-下载ubuntu镜像文件"><a class="markdownIt-Anchor" href="#1-下载ubuntu镜像文件"></a> 1. 下载Ubuntu镜像文件</h1>
<p>Ubuntu官网：<a href="https://cn.ubuntu.com/download/desktop">https://cn.ubuntu.com/download/desktop</a></p>
<p>Ubutnu官方镜像站：<a href="https://launchpad.net/ubuntu/+cdmirrors">https://launchpad.net/ubuntu/+cdmirrors</a></p>
<p>北交镜像：<a href="https://mirror.bjtu.edu.cn/ubuntu-releases/">https://mirror.bjtu.edu.cn/ubuntu-releases/</a></p>
<p>这里我用的是北交镜像的Ubuntu20.04.5：<a href="https://mirror.bjtu.edu.cn/ubuntu-releases/20.04.5/%EF%BC%8C">https://mirror.bjtu.edu.cn/ubuntu-releases/20.04.5/，</a><br />
iso下载地址：<a href="https://mirror.bjtu.edu.cn/ubuntu-releases/20.04.5/ubuntu-20.04.5-desktop-amd64.iso">https://mirror.bjtu.edu.cn/ubuntu-releases/20.04.5/ubuntu-20.04.5-desktop-amd64.iso</a></p>
<h1 id="2-安装-vmware"><a class="markdownIt-Anchor" href="#2-安装-vmware"></a> 2. 安装 VMware</h1>
<p>VMware 17 官网：<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/584758211">知乎网友</a>提供的密钥：MC60H-DWHD5-H80U9-6V85M-8280D</p>
<h1 id="3-创建虚拟机"><a class="markdownIt-Anchor" href="#3-创建虚拟机"></a> 3. 创建虚拟机</h1>
<ol>
<li>
<p>打开VMware，菜单栏点击“文件”-&gt;“新建虚拟机”</p>
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127112910570.png" alt="image-20221127112910570" style="zoom: 67%;" />
</li>
<li>
<p>选择镜像并输入相关信息，并开始安装</p>
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127113020828.png" alt="image-20221127113020828" style="zoom:67%;" />
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127113334682.png" alt="image-20221127113334682" style="zoom:67%;" />
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127113446264.png" alt="image-20221127113446264" style="zoom:67%;" />
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127113510013.png" alt="image-20221127113510013" style="zoom:67%;" />
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127113535281.png" alt="image-20221127113535281" style="zoom:67%;" />
</li>
<li>
<p>等待安装完毕，显示</p>
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127121407304.png" alt="image-20221127121407304" style="zoom:80%;" />
</li>
</ol>
<h1 id="4-设置虚拟机代理"><a class="markdownIt-Anchor" href="#4-设置虚拟机代理"></a> 4. 设置虚拟机代理</h1>
<p>为了git等命令的方便</p>
<ol>
<li>
<p>在Win10上cmd中输入<code>ipconfig</code>查看<code>以太网适配器 VMware Network Adapter VMnet1</code>的IPv4</p>
<pre class="line-numbers language-none"><code class="language-none">以太网适配器 VMware Network Adapter VMnet1:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : ***********************
   IPv4 地址 . . . . . . . . . . . . : 192.168.135.1
   子网掩码  . . . . . . . . . . . . : 255.255.255.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>VMware设置。在左侧栏中选择虚拟机（这里是Ubuntu_t），右键“设置”。弹出对话框，“网络适配器”-&gt;“网络连接”-&gt;“NAT模式”-&gt;“确定”。</p>
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127122004459.png" alt="image-20221127122004459" style="zoom: 67%;" />
</li>
<li>
<p>Ubutnu的设置</p>
<img src="/images/VMWare安装Ubuntu20.04虚拟机/image-20221127123217512.png" alt="image-20221127123217512" style="zoom: 67%;" />
</li>
<li>
<p>在Ubuntu中打开浏览器看看某些国外网站（如Github）访问是否流畅。</p>
</li>
</ol>
<h1 id="5-参考"><a class="markdownIt-Anchor" href="#5-参考"></a> 5. 参考</h1>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/584758211">https://zhuanlan.zhihu.com/p/584758211</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>VOC2012数据集和labelImg标注工具</title>
    <url>/2021/12/07/VOC2012%E6%95%B0%E6%8D%AE%E9%9B%86%E5%92%8ClabelImg%E6%A0%87%E6%B3%A8%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>实际上就是看<a href="https://www.bilibili.com/video/BV1kV411k7D8?spm_id_from=333.999.0.0">PASCAL VOC2012数据集讲解与制作自己的数据集</a>的一点笔记，把重点的记下来了。</p>
<h1 id="voc2012"><a class="markdownIt-Anchor" href="#voc2012"></a> VOC2012</h1>
<p>数据集官方地址：<a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/index.html">http://host.robots.ox.ac.uk/pascal/VOC/voc2012/index.html</a></p>
<span id="more"></span>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/0393b4c5ce554b2c92a1680db9459465.png" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/c2caf9839ede4e4592b7ca90909ee40c.png" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/61d8959b32a74aa396465daf50b8c03d.png" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e02632c88b494c52a2cd68638ddbfa12.png" width="80%"> 
</div> 
<h1 id="labelimg标注工具"><a class="markdownIt-Anchor" href="#labelimg标注工具"></a> labelImg标注工具</h1>
<p>官方地址：<a href="https://github.com/tzutalin/labelImg">https://github.com/tzutalin/labelImg</a></p>
<h2 id="安装ubuntu"><a class="markdownIt-Anchor" href="#安装ubuntu"></a> 安装(Ubuntu)</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> labelImg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">labelImg <span class="token punctuation">[</span>IMAGE_PATH<span class="token punctuation">]</span> <span class="token punctuation">[</span>PRE-DEFINED CLASS FILE<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/055b4cf8f27a4bf7b42e43d673413ac1.png" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/8984d0c280954a4c9067842cb8bf8ada.png" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/79105b681b26440ca6234034422ed69d.png" width="80%"> 
</div> 
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<p>[1] <a href="https://www.bilibili.com/video/BV1kV411k7D8?spm_id_from=333.999.0.0">PASCAL VOC2012数据集讲解与制作自己的数据集</a></p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>目标检测</category>
      </categories>
  </entry>
  <entry>
    <title>VSCode使用SSH免密登录远程主机</title>
    <url>/2022/11/27/VSCode%E4%BD%BF%E7%94%A8SSH%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA/</url>
    <content><![CDATA[<h1 id="0-前言"><a class="markdownIt-Anchor" href="#0-前言"></a> 0. 前言</h1>
<p>对于远程开发而言，目前最好的IDE是VSCode。可使用SSH时，不仅每次连接远程服务器都要属于一次密码，关键是每次打开一个新目录都要输入密码。过于繁琐的操作，直接影响心情。</p>
<p>这里记录一下如何设置，达到VSCode免密登录远程主机的效果.</p>
<span id="more"></span>
<h1 id="1-预备"><a class="markdownIt-Anchor" href="#1-预备"></a> 1. 预备</h1>
<ol>
<li>
<p>远程主机（Ubuntu）已安装ssh，未安装可用以下命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>本地机（Win10）一般都有ssh</p>
</li>
<li>
<p>本地机安装VSCode，<strong>并且在VSCode中安装插件：Remote-SSH 和Remote Development</strong></p>
 <img src="https://img-blog.csdnimg.cn/aa3d03d185624db1be05d2ee095e9834.png" style="zoom:50%;" />
 <img src="https://img-blog.csdnimg.cn/5b84b447364e44ef8c076fb6046644c5.png" style="zoom:50%;" />
</li>
</ol>
<h1 id="2-将本地公钥传到远端"><a class="markdownIt-Anchor" href="#2-将本地公钥传到远端"></a> 2. 将本地公钥传到远端</h1>
<ol>
<li>
<p>生成ssh的公钥私钥。（若之前已经生成过则跳过）打开cmd输入，</p>
<pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">ssh-keygen<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>文件一般保存在目录<code>C:\Users\Administrator\.ssh</code>下面，包含两个文件<code>id_rsa</code>和<code>id_rsa.pub</code>，其中<code>id_rsa.pub</code>就是公钥。</p>
</li>
<li>
<p>传输到远程主机对应的ssh目录下。这里为了便于后续管理，我将<code>id_rsa.pub</code>重命名为<code>WORK_id_rsa.pub</code></p>
<pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">scp WORK_id_rsa.pub wh@192.168.131.131:&#x2F;home&#x2F;wh&#x2F;.ssh&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>远程主机中，生成<code>authorized_keys</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /home/wh/.ssh/
<span class="token function">cat</span> WORK_id_rsa.pub  <span class="token operator">>></span> authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>注：linux的cat命令，<code>&gt;</code>是覆盖，<code>&gt;&gt;</code>是添加。</p>
</li>
</ol>
<h1 id="3-设置vscode的ssh"><a class="markdownIt-Anchor" href="#3-设置vscode的ssh"></a> 3. 设置VSCode的SSH</h1>
<p>(有些地方不需要这步)</p>
<p>文件一般是<code>C:\Users\Administrator\.ssh\config</code></p>
<p>添加私钥：在原来的后面添加一行<code>IdentityFile &quot;C:\Users\Administrator\.ssh\id_rsa&quot;</code>即可</p>
<pre class="line-numbers language-none"><code class="language-none">Host 192.168.131.131
  HostName 192.168.131.131
  User wh
  IdentityFile &quot;C:\Users\Administrator\.ssh\id_rsa&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>（如有必要，重启VSCode）即可享受免密登录</p>
<h1 id="4-参考"><a class="markdownIt-Anchor" href="#4-参考"></a> 4. 参考</h1>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/222452460">https://zhuanlan.zhihu.com/p/222452460</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Ubuntu与服务器</category>
      </categories>
  </entry>
  <entry>
    <title>在Numpy和Pytorch中的random</title>
    <url>/2021/11/21/numpy%E9%9A%8F%E6%9C%BA%E5%92%8CPytorch%E9%9A%8F%E6%9C%BA/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>作为测试用例，生成随机矩阵或者tensor很重要。可这个操作在numpy和Pytorch中略有区别。故在此处整理出。</p>
<span id="more"></span>
<h1 id="numpy"><a class="markdownIt-Anchor" href="#numpy"></a> Numpy</h1>
<h2 id="numpyrandom-生成随机数"><a class="markdownIt-Anchor" href="#numpyrandom-生成随机数"></a> numpy.random 生成随机数</h2>
<p>如<code>numpy.random.rand(2,3)</code></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/725d0aa8a8064b4fa9e279f9f90e7c55.png" width="80%"> 
</div> 
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/23cf39f844f943feb5761203faa86335.png" width="80%"> 
</div> 
<h3 id="推荐使用方式"><a class="markdownIt-Anchor" href="#推荐使用方式"></a> 推荐使用方式</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 带键值对的方式，好记</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>high<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>scale<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 若需要改变类型</span>
a<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="numpyrandomchoice-随机挑选"><a class="markdownIt-Anchor" href="#numpyrandomchoice-随机挑选"></a> numpy.random.choice 随机挑选</h2>
<p>注意，这是对一维数据<br />
<code>random.choice(a, size=None, replace=True, p=None)</code></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/326a0779f6e84523808e3397c3a016c5.JPG" width="80%"> 
</div> 
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 

<span class="token operator">>></span><span class="token operator">></span>aa_milne_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pooh'</span><span class="token punctuation">,</span> <span class="token string">'rabbit'</span><span class="token punctuation">,</span> <span class="token string">'piglet'</span><span class="token punctuation">,</span> <span class="token string">'Christopher'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>aa_milne_arr<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'pooh'</span><span class="token punctuation">,</span> <span class="token string">'pooh'</span><span class="token punctuation">,</span> <span class="token string">'pooh'</span><span class="token punctuation">,</span> <span class="token string">'Christopher'</span><span class="token punctuation">,</span> <span class="token string">'piglet'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
      dtype<span class="token operator">=</span><span class="token string">'&lt;U11'</span><span class="token punctuation">)</span>

np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="numpyrandomshuffle-打乱顺序"><a class="markdownIt-Anchor" href="#numpyrandomshuffle-打乱顺序"></a> numpy.random.shuffle 打乱顺序</h2>
<ol>
<li>只对最外侧维度进行，内层不变</li>
<li><strong>没有返回值</strong></li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span>a1 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>a1
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>a1<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>a1
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="pytorch"><a class="markdownIt-Anchor" href="#pytorch"></a> Pytorch</h1>
<h2 id="生成随机tensor"><a class="markdownIt-Anchor" href="#生成随机tensor"></a> 生成随机tensor</h2>
<ol>
<li>
<p>torch.rand</p>
<p>在[0,1)上均匀分布，一般这个就够用了。</p>
<p><code>torch.rand(*size, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False) → Tensor</code></p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>torch.rand_like<br />
返回和某个tensor一样size的tensor，在[0,1)上均匀分布，并且dtype、device、layout相同。</p>
<p><code>torch.rand_like(input, dtype=None, layout=None, device=None, requires_grad=False) → Tensor</code></p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand_like<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>
<p>torch.randn<br />
标准正态分布，~N(0,1)</p>
<p><code>torch.randn(*size, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False) → Tensor</code></p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">c <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>torch.randint<br />
指定范围的均匀分布，并且是返回整数类型</p>
<p><code>torch.randint(low=0, high, size, *, generator=None, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False) → Tensor</code></p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">c <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>high<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>类似的<br />
类似于torch.rand_like，还有torch.randn_like和torch.randint_like</p>
</li>
</ol>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li>Python数据分析与展示 - 北京理工大学</li>
<li><a href="https://numpy.org/doc/stable/reference/index.html">https://numpy.org/doc/stable/reference/index.html</a></li>
<li><a href="https://pytorch.org/docs/1.4.0/">https://pytorch.org/docs/1.4.0/</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>md文件图片引用格式转换及下载</title>
    <url>/2022/01/11/md%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87%E5%BC%95%E7%94%A8%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E5%8F%8A%E4%B8%8B%E8%BD%BD/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>CSDN上的图片引用格式为<code>![]()</code>，对图片调整为居中显示并按比例缩放，可以很简单:在图片链接尾添加<code>#pic_center =80%x80%</code></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">![在这里插入图片描述](https://img-blog.csdnimg.cn/e0a68bdbd10f41f081bb1c60d659bda4.png#pic_center =80%x80%)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>但问题在于这种方式不能使用于其他博客比如Hexo，所以需要转化成更通用的方式，即html的方式</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://img-blog.csdnimg.cn/e0a68bdbd10f41f081bb1c60d659bda4.png<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>80%<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<span id="more"></span>
<p>图片过多，考虑使用代码转化。</p>
<p>另外，博客上的图片应该自己保留一份，考虑使用代码自动完成。</p>
<h1 id="代码"><a class="markdownIt-Anchor" href="#代码"></a> 代码</h1>
<p>于是，就有了负责转化功能的<code>convert</code>和负责下载图片的<code>download_img</code>。将以下程序置放于存储md文件的文件夹下即可。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>md_path<span class="token punctuation">,</span> origin_save_path<span class="token operator">=</span><span class="token string">'./origin'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    将markdown文件中的！![]()图片格式变为div格式
    :param md_path: 源文件路径
    :return:
    '''</span>

    <span class="token keyword">if</span> md_path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        save_name <span class="token operator">=</span> md_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> md_path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        save_name <span class="token operator">=</span> md_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        save_name <span class="token operator">=</span> md_path


    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>md_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>origin_save_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>origin_save_path<span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>origin_save_path<span class="token punctuation">,</span> save_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>

    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'!['</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>

            start <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span>
            end <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span>
            img_url <span class="token operator">=</span> line<span class="token punctuation">[</span>start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span>end<span class="token punctuation">]</span>

            lines<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token string">'&lt;div align="center"> \n'</span><span class="token punctuation">)</span>
            lines<span class="token punctuation">[</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;img src="&#123;img_url&#125;" width="80%"> \n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>img_url<span class="token operator">=</span>img_url<span class="token punctuation">)</span>
            lines<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>idx<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'&lt;/div> \n'</span><span class="token punctuation">)</span>


    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_name<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>

    <span class="token keyword">return</span>

<span class="token keyword">def</span> <span class="token function">download_img</span><span class="token punctuation">(</span>md_path<span class="token punctuation">,</span> img_save_path<span class="token operator">=</span><span class="token string">'./img'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    将markdown文件中的！![]()图片格式变为div格式
    :param md_path: 源文件路径
    :return:
    '''</span>

    <span class="token keyword">if</span> md_path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        save_name <span class="token operator">=</span> md_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> md_path<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        save_name <span class="token operator">=</span> md_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        save_name <span class="token operator">=</span> md_path

    <span class="token comment"># 读取md文件</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>md_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>

    img <span class="token operator">=</span> <span class="token boolean">None</span>
    img_idx <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 用于图片计数</span>
    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">if</span> <span class="token string">'!['</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
            start <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span>
            end <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span>
            img_url <span class="token operator">=</span> line<span class="token punctuation">[</span>start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span>end<span class="token punctuation">]</span>

            <span class="token comment"># 下载</span>
            img <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>img_url<span class="token punctuation">)</span>

        <span class="token keyword">elif</span> <span class="token string">'&lt;img src='</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
            img_url <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># 下载</span>
            img <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>img_url<span class="token punctuation">)</span>

        <span class="token comment"># 保存</span>
        <span class="token keyword">if</span> img <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            img_save_path_ <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_save_path<span class="token punctuation">,</span> save_name<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>img_save_path_<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>img_save_path_<span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token string">'.gif'</span> <span class="token keyword">in</span> img_url<span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_save_path_<span class="token punctuation">,</span> <span class="token string">'&#123;&#125;.gif'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>img_idx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

                    img_idx <span class="token operator">+=</span> <span class="token number">1</span>
                    img <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_save_path_<span class="token punctuation">,</span> <span class="token string">'&#123;&#125;.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>img_idx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

                    img_idx <span class="token operator">+=</span> <span class="token number">1</span>
                    img <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">return</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># md_path = 'Pytorch中的Conv1d和Conv3d.md'</span>

    <span class="token comment"># 指定文件路径</span>
    <span class="token comment"># os.chdir('./new')</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
    md_paths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 得到Markdown文件列表</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'.md'</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>
            md_paths<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> md_path <span class="token keyword">in</span> md_paths<span class="token punctuation">:</span>
        <span class="token comment"># convert(md_path)</span>
        download_img<span class="token punctuation">(</span>md_path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>笔记</category>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>pysot和vot-toolkit的结合</title>
    <url>/2022/01/19/pysot%E5%92%8Cvot-toolkit%E7%9A%84%E7%BB%93%E5%90%88/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>能点进来看这个文章的，想必都是行内人士，那就直接讲重点。</p>
<p>其实人家pysot已经内置了vot数据集的测试和分析，其结果已经广泛用于各种paper上。比如SiamRPN++在VOT2016上的EAO是0.464。</p>
<p>但pysot只能运行VOT2016,2018,2019的数据集。因为pysot只提供了关于这几个的配置信息。于是我想把pysot和vot-toolkit结合起来。</p>
<p>关于vot-toolkit-python的使用，可以看我的上一篇博客<a href="https://blog.csdn.net/a171232886/article/details/122575852">vot-toolkit-python的使用</a>。</p>
<span id="more"></span>
<h1 id="代码"><a class="markdownIt-Anchor" href="#代码"></a> 代码</h1>
<p>这是pysot和vot-toolkit结合的python脚本，我将其命名为<code>test_vot.py</code>。<br />
<font face="黑体"  color=#FF0000 size=4> 注意，这个文件放在<code>pysot-master</code>下面，而不是<code>pysot-master/tools</code>下面。</font>这样可回避pysot复杂的环境变量设置。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Copyright (c) SenseTime. All Rights Reserved.</span>

<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> absolute_import
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> division
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> print_function
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals

<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

pysotpath <span class="token operator">=</span> <span class="token string">'/media/HardDisk_new/wh/others/pysot-master/'</span>

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">from</span> pysot<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config <span class="token keyword">import</span> cfg
<span class="token keyword">from</span> pysot<span class="token punctuation">.</span>models<span class="token punctuation">.</span>model_builder <span class="token keyword">import</span> ModelBuilder
<span class="token keyword">from</span> pysot<span class="token punctuation">.</span>tracker<span class="token punctuation">.</span>tracker_builder <span class="token keyword">import</span> build_tracker
<span class="token keyword">from</span> pysot<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>model_load <span class="token keyword">import</span> load_pretrain
<span class="token keyword">from</span> pysot<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>bbox <span class="token keyword">import</span> get_axis_aligned_bbox
<span class="token keyword">from</span> vot_iter <span class="token keyword">import</span> vot

parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'siammask tracking'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--config'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'&#123;&#125;/experiments/siamrpn_r50_l234_dwxcorr/config.yaml'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pysotpath<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'config file'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--snapshot'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'&#123;&#125;/experiments/siamrpn_r50_l234_dwxcorr/model.pth'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pysotpath<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'snapshot of models to eval'</span><span class="token punctuation">)</span>
args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>set_num_threads<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"CUDA_VISIBLE_DEVICES"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0"</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># load config</span>
    cfg<span class="token punctuation">.</span>merge_from_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>config<span class="token punctuation">)</span>

    <span class="token comment"># create model</span>
    model <span class="token operator">=</span> ModelBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># load model</span>
    model <span class="token operator">=</span> load_pretrain<span class="token punctuation">(</span>model<span class="token punctuation">,</span> args<span class="token punctuation">.</span>snapshot<span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># build tracker</span>
    tracker <span class="token operator">=</span> build_tracker<span class="token punctuation">(</span>model<span class="token punctuation">)</span>


    <span class="token comment"># vot-tool</span>
    handle <span class="token operator">=</span> vot<span class="token punctuation">.</span>VOT<span class="token punctuation">(</span><span class="token string">"polygon"</span><span class="token punctuation">)</span>
    selection <span class="token operator">=</span> handle<span class="token punctuation">.</span>region<span class="token punctuation">(</span><span class="token punctuation">)</span>

    imagefile <span class="token operator">=</span> handle<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> imagefile<span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment"># BBox格式转化</span>
    gt_bbox <span class="token operator">=</span> <span class="token punctuation">[</span>selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
               selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
               selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
               selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> selection<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">]</span>
    cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> get_axis_aligned_bbox<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>gt_bbox<span class="token punctuation">)</span><span class="token punctuation">)</span>
    gt_bbox_ <span class="token operator">=</span> <span class="token punctuation">[</span>cx <span class="token operator">-</span> <span class="token punctuation">(</span>w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> cy <span class="token operator">-</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">]</span>


    image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>imagefile<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span>
    tracker<span class="token punctuation">.</span>init<span class="token punctuation">(</span>image<span class="token punctuation">,</span> gt_bbox_<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        imagefile <span class="token operator">=</span> handle<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> imagefile<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>imagefile<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span>
        output <span class="token operator">=</span> tracker<span class="token punctuation">.</span>track<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
        region <span class="token operator">=</span> vot<span class="token punctuation">.</span>Rectangle<span class="token punctuation">(</span>output<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                               output<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output<span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        confidence <span class="token operator">=</span> output<span class="token punctuation">[</span><span class="token string">'best_score'</span><span class="token punctuation">]</span>
        handle<span class="token punctuation">.</span>report<span class="token punctuation">(</span>region<span class="token punctuation">,</span> confidence<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="修改trackersini文件"><a class="markdownIt-Anchor" href="#修改trackersini文件"></a> 修改trackers.ini文件</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>SiamRPNpp<span class="token punctuation">]</span>
label <span class="token operator">=</span> SiamRPNpp
protocol <span class="token operator">=</span> traxpython  
<span class="token builtin class-name">command</span> <span class="token operator">=</span> test_vot 
paths <span class="token operator">=</span> /media/HardDisk_new/wh/others/pysot-master/
env_PATH <span class="token operator">=</span> /home/wh/anaconda3/envs/others/bin/python<span class="token punctuation">;</span><span class="token variable">$&#123;<span class="token environment constant">PATH</span>&#125;</span>   
restart <span class="token operator">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="实验"><a class="markdownIt-Anchor" href="#实验"></a> 实验</h1>
<h2 id="结果"><a class="markdownIt-Anchor" href="#结果"></a> 结果</h2>
<ol>
<li>pysot运行的SiamRPN++在VOT2016上的EAO=0.464；vot-toolkit的结果为0.430</li>
<li>将vot-toolkit的运行结果用pysot的<code>eval.py</code>分析EAO=0.439；vot-toolkit分析pysot的运行结果为EAO=0.454。</li>
</ol>
<h2 id="分析"><a class="markdownIt-Anchor" href="#分析"></a> 分析</h2>
<p>pysot和vot-toolkit的差距很有可能是，pysot在计算EAO时直接自定义了帧数考虑范围，代码如下（<code>./tookilt/evaluation/eao_benchmark.py</code>）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># NOTE we not use gmm to generate low, high, peak value</span>
<span class="token keyword">if</span> dataset<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'VOT2019'</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>low <span class="token operator">=</span> <span class="token number">46</span>
    self<span class="token punctuation">.</span>high <span class="token operator">=</span> <span class="token number">291</span>
    self<span class="token punctuation">.</span>peak <span class="token operator">=</span> <span class="token number">128</span>
<span class="token keyword">elif</span> dataset<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'VOT2018'</span> <span class="token keyword">or</span> dataset<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'VOT2017'</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>low <span class="token operator">=</span> <span class="token number">100</span>
    self<span class="token punctuation">.</span>high <span class="token operator">=</span> <span class="token number">356</span>
    self<span class="token punctuation">.</span>peak <span class="token operator">=</span> <span class="token number">160</span>
<span class="token keyword">elif</span> dataset<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'VOT2016'</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>low <span class="token operator">=</span> <span class="token number">108</span>
    self<span class="token punctuation">.</span>high <span class="token operator">=</span> <span class="token number">371</span>
    self<span class="token punctuation">.</span>peak <span class="token operator">=</span> <span class="token number">168</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>vot-toolkit-python的高级python语法的大量使用，阻止了我继续分析。只要肯花时间，这是肯定能研究清楚的。但我见过的论文，都是以pysot的0.464为准。什么时候真正要用vot-toolkit-python什么时候再继续分析吧。</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>目标跟踪</category>
      </categories>
  </entry>
  <entry>
    <title>Python、Numpy、Pytorch中的索引方式</title>
    <url>/2021/11/21/python-numpy-Pytorch%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p>能用索引方式过多，不止下标索引。自己写程序还好，关键是看人家写的程序，有时候会晕掉，不知所云。故在此总结。</p>
<p>首先对Numpy的下标索引、切片索引、布尔索引和花式索引进行介绍和分析，然后研究Python和Pytorch中的索引方式是否包括以上四种。</p>
<span id="more"></span>
<h1 id="numpy"><a class="markdownIt-Anchor" href="#numpy"></a> Numpy</h1>
<h2 id="下标索引"><a class="markdownIt-Anchor" href="#下标索引"></a> 下标索引</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token comment"># 正向从0开始</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

<span class="token comment"># 反向从-1开始</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token number">4</span>

<span class="token comment"># 多维数组</span>
<span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
<span class="token comment"># a[0][-2][1]和a[0,-2,1]输出相同。只是a[0][-2][1]先取a[0]，再取[-2],最后[-1]，会慢一些</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">1</span>

<span class="token comment"># 输入第一个维度值</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="切片索引"><a class="markdownIt-Anchor" href="#切片索引"></a> 切片索引</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># start:end, end可以省略，也可以写一个大于实际长度的值</span>
<span class="token comment"># 注意切片中不包括end</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># start:end:step</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 不写start和end就是分别默认首和尾</span>
<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 反向排列::-1，</span>
<span class="token comment"># 并不能指定部分序列反向如a[1:5:-1]，此时返回空</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int64<span class="token punctuation">)</span>


<span class="token comment"># 多维数组, </span>
<span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 返回部分值，</span>
<span class="token comment">#（1）end仍然可以大于实际值，</span>
<span class="token comment">#（2）：表示返回该维度全部，</span>
<span class="token comment">#（3）以start:end切片返回的维度和原数组相同</span>
<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 针对某一维度切片</span>
<span class="token comment"># 若直接指定某一维度的值，返回数组的维度-1</span>
<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>至此，相信大多数人都能看懂，因为在每个维度上明确指出了取多少。但有一些操作，会让你眼花缭乱。 比如省略号和冒号</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 省略号表示，其余所有维度的所有值都要。还算有用。</span>
 <span class="token comment"># a[1,...]等同于a[1,:,:]，好处是无需把每个维度都写一遍</span>
 <span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 <span class="token comment"># a[...,1]等同于a[:,:,1]</span>
 <span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 对于三维数组，一个冒号也可以和省略号相同，</span>
 <span class="token comment"># 表示其余所有维度的所有值都要。</span>
 <span class="token comment"># （1）但这是一个相当不好的设计，至少我这么认为。</span>
 <span class="token comment"># 因为读者可能不清楚这个数组到底几维，</span>
 <span class="token comment"># 你这么写极有可能会让读者误以为是二维数组。</span>
 <span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="布尔索引"><a class="markdownIt-Anchor" href="#布尔索引"></a> 布尔索引</h2>
<p>这是个很实用的技巧</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
 <span class="token comment"># 在Numpy中，对array做逻辑运算，返回的是同siaze的Bool型array</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">></span><span class="token number">6</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       
 <span class="token comment"># 可根据这个结果进行索引</span>
 <span class="token comment"># （1）返回的总是一维数组</span>
 <span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span>a<span class="token operator">></span><span class="token number">6</span><span class="token punctuation">]</span> 
 array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="花式索引fancy-indexing"><a class="markdownIt-Anchor" href="#花式索引fancy-indexing"></a> 花式索引(Fancy indexing)</h2>
<p>通过数组作为坐标去索引。这个方式看了一会才明白。花式索引主要是针对不连续的索引下标，是有实际用处的。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> numpy<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="先从简单的情况看起"><a class="markdownIt-Anchor" href="#先从简单的情况看起"></a> 先从简单的情况看起</h3>
<p>此时，a为三维数组，你想找某个位置的值，得需要三个值作为坐标吧。即a[x,y,z]，比如说a[1][2][0]。<strong>而花式索引就是把每个坐标以数组的方式传入。</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token number">10</span>

<span class="token comment"># 花式索引, 此时变成x=[1], y=[2], z=[0]</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 此时变成x=[1,0], y=[2,1], z=[0,1]</span>
<span class="token comment"># 即a[1,2,0]和a[0,1,1]</span>
<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="稍微复杂点的切片"><a class="markdownIt-Anchor" href="#稍微复杂点的切片"></a> 稍微复杂点的切片</h3>
<p>刚才是直接指定了三个维度，那么切片怎么做？少指定一个维度就行了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 指定了两个维度，相当于找a[1,2,:](暂时忽略返回维度)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 相当于找a[1,2,:]和a[1,0,:]</span>
<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时另一个问题也可以解决了，为什么<code>a[[1],[2]]</code>会比<code>a[1,2,:]</code>多一个维度。需要首先考虑<code>a[[1,1],[2,0]]</code>：</p>
<ul>
<li>如果使用<code>a[1,2,:]</code>和<code>a[1,0,:]</code>，需要分别查找，得到两个结果。</li>
<li>而使用a[[1],[2]]，只需一次即可得到结果，结果就是将<code>a[1,2,:]</code>和<code>a[1,0,:]</code>整合起来。</li>
<li>为了可能存在的“整合操作”，花式索引就要多出一个维度，即便结果不需要“整合”。</li>
</ul>
<h3 id="考虑广播机制"><a class="markdownIt-Anchor" href="#考虑广播机制"></a> 考虑广播机制</h3>
<p>比如y维度只给了一个2，Python中的广播之后，变成了寻找<code>a[0,2,:]</code>和<code>a[1,2,:]</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="python"><a class="markdownIt-Anchor" href="#python"></a> Python</h1>
<p>让我们看看List有什么方式</p>
<h2 id="下标索引和切片索引"><a class="markdownIt-Anchor" href="#下标索引和切片索引"></a> 下标索引和切片索引</h2>
<p>只能通过<code>a[1][0]</code>的方式。使用的时候将其考虑为一层一层的list即可。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">8</span>

<span class="token comment"># 不可以a[1,0]</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;input>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
TypeError<span class="token punctuation">:</span> <span class="token builtin">list</span> indices must be integers <span class="token keyword">or</span> slices<span class="token punctuation">,</span> <span class="token keyword">not</span> <span class="token builtin">tuple</span>

<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token comment"># 但倒序的操作还在,只针对最外层</span>
<span class="token operator">>></span><span class="token operator">></span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="布尔索引-2"><a class="markdownIt-Anchor" href="#布尔索引-2"></a> 布尔索引</h2>
<p>Numpy中的方式失败</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">></span><span class="token number">0</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;input>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
TypeError<span class="token punctuation">:</span> <span class="token string">'>'</span> <span class="token keyword">not</span> supported between instances of <span class="token string">'list'</span> <span class="token keyword">and</span> <span class="token string">'int'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但也不是没有，尽管没什么用。True是1，False是0</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="花式索引"><a class="markdownIt-Anchor" href="#花式索引"></a> 花式索引</h2>
<p>没有</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;input>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
TypeError<span class="token punctuation">:</span> <span class="token builtin">list</span> indices must be integers <span class="token keyword">or</span> slices<span class="token punctuation">,</span> <span class="token keyword">not</span> <span class="token builtin">tuple</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="pytorch"><a class="markdownIt-Anchor" href="#pytorch"></a> Pytorch</h1>
<p>终于到了令人期待的Pytorch</p>
<h2 id="下标索引和切片索引-2"><a class="markdownIt-Anchor" href="#下标索引和切片索引-2"></a> 下标索引和切片索引</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>high<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 省略号省略号表示其余所有维度的所有值都要(此功能的冒号也支持)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># ::-1倒序不支持</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;input>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
ValueError<span class="token punctuation">:</span> step must be greater than zero<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="布尔索引-3"><a class="markdownIt-Anchor" href="#布尔索引-3"></a> 布尔索引</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 支持</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">></span><span class="token number">5</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span>a<span class="token operator">></span><span class="token number">5</span><span class="token punctuation">]</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="花式索引-2"><a class="markdownIt-Anchor" href="#花式索引-2"></a> 花式索引</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 支持</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://blog.csdn.net/weixin_43569478/article/details/108079868">https://blog.csdn.net/weixin_43569478/article/details/108079868</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/123858781">https://zhuanlan.zhihu.com/p/123858781</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>Pytorch中的Relu对梯度的影响</title>
    <url>/2021/12/29/pytorch%E4%B8%AD%E7%9A%84Relu%E5%AF%B9%E6%A2%AF%E5%BA%A6%E7%9A%84%E5%BD%B1%E5%93%8D/</url>
    <content><![CDATA[<h1 id="relu层"><a class="markdownIt-Anchor" href="#relu层"></a> Relu层</h1>
<p>卷积层和全连接层这种有可训练参数的，可以求梯度。Relu层怎么办？</p>
<p><strong>先说结论：Relu(x)，若x&lt;=0，x的梯度为0，若x&gt;0，梯度为x。</strong></p>
<span id="more"></span>
<h2 id="代码测试验证"><a class="markdownIt-Anchor" href="#代码测试验证"></a> 代码测试验证</h2>
<p>测试一个简单的网络，pred=relu(WX)，loss = mean(pred - y)。不考虑Relu时，W的梯度应是X。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn


<span class="token keyword">def</span> <span class="token function">seed_torch</span><span class="token punctuation">(</span>seed<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># random.seed(seed)</span>
    <span class="token comment"># os.environ['PYTHONHASHSEED'] = str(seed)</span>
    <span class="token comment"># np.random.seed(seed)</span>
    torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
    torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
    torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>benchmark <span class="token operator">=</span> <span class="token boolean">False</span>
    torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>deterministic <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Model<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>relu <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>para <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pred <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>para<span class="token punctuation">)</span><span class="token punctuation">)</span>
        loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>pred <span class="token operator">-</span> y<span class="token punctuation">)</span>
        <span class="token keyword">return</span> pred<span class="token punctuation">,</span> loss

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    seed_torch<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># x[:, 1] = torch.zeros([4])</span>
    <span class="token comment"># x[:, 2] = -torch.ones([4])</span>
    y <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token punctuation">,</span> l <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

    l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token comment"># print(y)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>para<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>
<p>第一种情况，WX&gt;0<br />
当<code>x = torch.ones([4, 3])</code>，输出</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span>., <span class="token number">1</span>., <span class="token number">1</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">1</span>., <span class="token number">1</span>., <span class="token number">1</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">1</span>., <span class="token number">1</span>., <span class="token number">1</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">1</span>., <span class="token number">1</span>., <span class="token number">1</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
None
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">1</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">1</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>第二种情况，WX=0<br />
当</p>
  <pre class="line-numbers language-none"><code class="language-none">x &#x3D; torch.ones([4, 3])
x[:, 1] &#x3D; torch.zeros([4])
x[:, 2] &#x3D; -torch.ones([4])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输出</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span>.,  <span class="token number">0</span>., -1.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span> <span class="token number">1</span>.,  <span class="token number">0</span>., -1.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span> <span class="token number">1</span>.,  <span class="token number">0</span>., -1.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span> <span class="token number">1</span>.,  <span class="token number">0</span>., -1.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
None
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">0</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">0</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>第二种情况，WX&lt;0<br />
当</p>
  <pre class="line-numbers language-none"><code class="language-none">x &#x3D; torch.ones([4, 3]) *(-1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>输出</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>-1., -1., -1.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span>-1., -1., -1.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span>-1., -1., -1.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span>-1., -1., -1.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
None
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">0</span>.<span class="token punctuation">]</span>,
        <span class="token punctuation">[</span><span class="token number">0</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>torch.tensor的创建与属性</title>
    <url>/2021/03/04/torch-tensor%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%B1%9E%E6%80%A7/</url>
    <content><![CDATA[<p>代码写着写着，发现要学习一下基础的知识。这里只举最简单的例子，以便说明各属性的功能。</p>
<span id="more"></span>
<h1 id="一-tensor的创建"><a class="markdownIt-Anchor" href="#一-tensor的创建"></a> 一、tensor的创建</h1>
<p>按<a href="https://pytorch.org/docs/1.4.0/torch.html?highlight=tensor#torch.tensor">官方的教程</a></p>
<p><code>torch.tensor(data, dtype=None, device=None, requires_grad=False, pin_memory=False) → Tensor</code></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210304170258162.PNG?x-oss-process=image" width="80%"> 
</div> 
注：
<ol>
<li>
<p>data就是数据，若输入1，创建标量，若输入[1], 创建向量</p>
</li>
<li>
<p>dtype：输入数据若是整数，dtype默认为torch.int64;输入小数，dtype默认torch.float（torch.float32和torch.float相同）。可以指定数据类型，按照<a href="https://pytorch.org/docs/1.4.0/tensor_attributes.html#tensor-attributes-doc">torch.dtype</a></p>
</li>
<li>
<p>device，默认cpu，可以写‘cpu’，‘cuda’(默认0卡)，‘cuda:0’。按照<a href="https://pytorch.org/docs/1.4.0/tensor_attributes.html#tensor-attributes-doc">torch.device</a></p>
</li>
<li>
<p>requires_grad, 这个tensor是否要求梯度，默认False</p>
</li>
</ol>
<h1 id="二-tensor的属性"><a class="markdownIt-Anchor" href="#二-tensor的属性"></a> 二、tensor的属性</h1>
<p>创建完之后，结果调试一看：“嚯，这都什么玩意！”。</p>
<p>其实这里面好多都是 <a href="https://pytorch.org/docs/1.4.0/autograd.html#tensor-autograd-functions">autograd</a>重的东西，挑几个重要的（用过的）研究了一下。因为涉及一些其他重要概念，所以这一部分会多一些。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210304171356356.PNG?x-oss-process=image" width="50%"> 
</div> 
<h2 id="一is_leafgradgrad_fn"><a class="markdownIt-Anchor" href="#一is_leafgradgrad_fn"></a> （一）is_leaf，grad，grad_fn</h2>
<p>假设最简单的情况，</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>w</mi><mi>x</mi><mspace linebreak="newline"></mspace><mi>z</mi><mo>=</mo><mi>y</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y=wx \\
z=y+b
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">x</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span></span></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
w <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> w<span class="token operator">*</span>x
z <span class="token operator">=</span> y <span class="token operator">+</span> b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>构成一张前项计算图。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/20210306195340703.PNG?x-oss-process=image#pic_center" width="30%"> 
</div> 
<center>
<p><a href="https://github.com/chenyuntc/pytorch-book/blob/master/chapter03-tensor_and_autograd/imgs/com_graph.svg">图片引用来源</a></p>
</center>
<ol>
<li>
<p>其中w，x，b称为leaf node，所以这几个tensor的<strong>is_leaf=True</strong>,而z称为根节点。</p>
</li>
<li>
<p>z和y因为是在w,b的基础上进行计算，他们的requires_grad自动为True</p>
</li>
</ol>
<h3 id="进行反向传播"><a class="markdownIt-Anchor" href="#进行反向传播"></a> 进行反向传播</h3>
<p><strong>backward()只能对标量进行</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">z<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li>
<p>我们可以输出那些<strong>is_leaf=True</strong>，<strong>requires_grad=True</strong>的梯度信息,比如w的梯度。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>grad<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>输出：tensor(2.) ，注意，这是z对x的梯度。</p>
</li>
<li>
<p>非leaf node的z和y，<strong>grad_fn</strong>不为None，grad_fn表示求导函数，比如z.grad_fn为&lt;AddBackward0 object at 0x7fb6b8991290&gt;</p>
</li>
<li>
<p><strong>如果只运行z.backward()，只能看为leaf node的grad，而不能看非leaf node的grad。grad_fn只有非leaf node的节点才不为None。</strong></p>
</li>
</ol>
<p><strong>那如果要是想看z对y求的梯度呢? 可以如下操作</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>autograd<span class="token punctuation">.</span>grad<span class="token punctuation">(</span>z<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="二shape和ndim"><a class="markdownIt-Anchor" href="#二shape和ndim"></a> （二）shape和ndim</h2>
<p>只有一点需要注意：<br />
若是标量，<br />
shape为torch.Size([])，ndim为0</p>
<p>若是向量（矩阵），shape就是维度比如torch.Size([1, 3, 127, 127])，ndim是维度数，比如4</p>
<h2 id="三tensordata-tensordetach和tensordetach_"><a class="markdownIt-Anchor" href="#三tensordata-tensordetach和tensordetach_"></a> （三）Tensor.data, Tensor.detach()和Tensor.detach_()</h2>
<h3 id="结论"><a class="markdownIt-Anchor" href="#结论"></a> 结论</h3>
<ol>
<li>
<p>三者的作用类似，都常用于梯度截断。</p>
</li>
<li>
<p>只要不需要对tensor原内容更改，三个都可以。但推荐detach()</p>
</li>
</ol>
<ul>
<li>下面这种，就不是对原内容更改 <pre class="line-numbers language-python" data-language="python"><code class="language-python">y1<span class="token operator">=</span>y<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span>
y1<span class="token operator">=</span>y1<span class="token operator">+</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>下面这种写法，才会对原内容产生影响 <pre class="line-numbers language-python" data-language="python"><code class="language-python">y1<span class="token operator">=</span>y<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span>
y1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>y1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ul>
<h3 id="具体来说三者的区别是"><a class="markdownIt-Anchor" href="#具体来说三者的区别是"></a> 具体来说，三者的区别是</h3>
<p>参考于<a href="https://www.cnblogs.com/wanghui-garcia/p/10677071.html">pytorch .detach() .detach_() 和 .data用于切断反向传播</a></p>
<ol>
<li>detach()</li>
</ol>
<ul>
<li>返回一个新的Variable，从当前计算图中分离下来的，但是仍指向原变量的存放位置,不同之处只是requires_grad为false，得到的这个Variable永远不需要计算其梯度，不具有grad。</li>
<li>当使用detach()，但是没有对原内容进行更改时，并不会影响backward()</li>
<li>当使用detach()，对原内容进行更改时，backward()则会报错</li>
</ul>
<ol start="2">
<li>detach_()</li>
</ol>
<ul>
<li>相当于变量之间的关系本来是x -&gt; m -&gt; y,这里的叶子variable是x，但是这个时候对m进行了.detach_()操作,其实就是进行了两个操作：</li>
<li>将m的grad_fn的值设置为None,这样m就不会再与前一个节点x关联，这里的关系就会变成x, m -&gt; y,此时的m就变成了叶子结点</li>
<li>然后会将m的requires_grad设置为False，这样对y进行backward()时就不会求m的梯度</li>
</ul>
<ol start="3">
<li>data<br />
与detach的不同之处：当使用.data ，对原内容进行更改时，backward()尽管不会报错但输出的数据却是错误的。</li>
</ol>
<h3 id="如何梯度截断"><a class="markdownIt-Anchor" href="#如何梯度截断"></a> 如何梯度截断</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#前期处理过程</span>
x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
w <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> w<span class="token operator">*</span>x
z <span class="token operator">=</span> y <span class="token operator">+</span> b

<span class="token comment">#后期使用过程，只使用到y作为输入，而不再需要对前期处理的梯度</span>
c <span class="token operator">=</span> y<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span><span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
c2 <span class="token operator">=</span> c<span class="token operator">*</span>d
c2<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>grad<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出：<br />
None<br />
tensor([2., 1.])</p>
<h2 id="四layout"><a class="markdownIt-Anchor" href="#四layout"></a> （四）layout</h2>
<p>Memory layout：中文叫做内存布局，是告诉你这个tensor是怎么在内存中排列的</p>
<p>参考<a href="https://blog.csdn.net/Li7819559/article/details/104295023">Pytorch中torch.layout到底是个什么东西</a></p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>vot-toolkit-python的使用</title>
    <url>/2022/01/19/vot-toolkit-python%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>可能<a href="https://www.votchallenge.net/">VOT官方</a>心里是这么想的：你们这群连工具都配不好的菜鸡，不配使用我们的数据集。就你们这个技术，更不必参与比赛。</p>
<p>这个数据集的<a href="https://www.votchallenge.net/howto/tutorial_python.html">Python版教程</a>，一个是写的过于简略，一个没有及时更新，一些东西已经不对应了。不过人家最开始的Matlab教程写的还挺好，但现在Python兴起，用Matlab研究跟踪的人越来越少了。</p>
<p>下面内容，没必要指出和官方的区别在哪。我直接写一份正确的教程。标红的地方，都是我踩过的坑。</p>
<span id="more"></span>
<h1 id="下载和安装"><a class="markdownIt-Anchor" href="#下载和安装"></a> 下载和安装</h1>
<p>假设你的电脑可以翻墙或者现在恰好可以畅通无阻的访问Github，那我推荐你直接执行以下命令，确实是下载安装一条龙服务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> git+https://github.com/votchallenge/vot-toolkit-python<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="备用方案"><a class="markdownIt-Anchor" href="#备用方案"></a> 备用方案</h2>
<p><font face="黑体"  color=#FF0000 size=4> 那要这台电脑连不到Github呢？</font><br />
也就是如何离线安装。达到和<code>pip install git+url</code>同样的效果，需要分三步：</p>
<ol>
<li>想办法下载<a href="https://github.com/votchallenge/toolkit">官方工具包</a>，拷贝到当前电脑（服务器）上 <pre class="line-numbers language-Download" data-language="Download"><div class="caption"><span>Zip```或者</span></div><code class="language-Download">&#96;&#96;&#96;bash
git clone https:&#x2F;&#x2F;github.com&#x2F;votchallenge&#x2F;toolkit.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>安装所需环境<br />
进入文件夹目录下（文件夹我重命名为“vot_toolkit”） <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> vot_toolkit
pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>安装这个库 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ol>
<p>附：如果你以这种方式，可以查看<code>./build/lib/vot/utilities/cli.py</code>下面的输入参数的含义。<font face="黑体"  color=#FF0000 size=4> 这是vot-toolkit定义输入参数的地方。</font></p>
<p>为了方便，我粘贴出来放在这</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'VOT Toolkit Command Line Utility'</span><span class="token punctuation">,</span> prog<span class="token operator">=</span><span class="token string">"vot"</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--debug"</span><span class="token punctuation">,</span> <span class="token string">"-d"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Backup backend"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--registry"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Tracker registry paths'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span>EnvDefault<span class="token punctuation">,</span> \
    separator<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>pathsep<span class="token punctuation">,</span> envvar<span class="token operator">=</span><span class="token string">'VOT_REGISTRY'</span><span class="token punctuation">)</span>

subparsers <span class="token operator">=</span> parser<span class="token punctuation">.</span>add_subparsers<span class="token punctuation">(</span><span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'commands'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'action'</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">"Commands"</span><span class="token punctuation">)</span>

test_parser <span class="token operator">=</span> subparsers<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Test a tracker integration on a synthetic sequence'</span><span class="token punctuation">)</span>
test_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"tracker"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Tracker identifier'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">"?"</span><span class="token punctuation">)</span>
test_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--visualize"</span><span class="token punctuation">,</span> <span class="token string">"-g"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Visualize results of the test session'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
test_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--sequence"</span><span class="token punctuation">,</span> <span class="token string">"-s"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Path to sequence to use instead of dummy'</span><span class="token punctuation">)</span>

workspace_parser <span class="token operator">=</span> subparsers<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'initialize'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Setup a new workspace and download data'</span><span class="token punctuation">)</span>
workspace_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--workspace"</span><span class="token punctuation">,</span> default<span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Workspace path'</span><span class="token punctuation">)</span>
workspace_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--nodownload"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Do not download dataset if specified in stack"</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
workspace_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"stack"</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Experiment stack'</span><span class="token punctuation">)</span>

evaluate_parser <span class="token operator">=</span> subparsers<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'evaluate'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Evaluate one or more trackers in a given workspace'</span><span class="token punctuation">)</span>
evaluate_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"trackers"</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Tracker identifiers'</span><span class="token punctuation">)</span>
evaluate_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--force"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Force rerun of the entire evaluation"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
evaluate_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--persist"</span><span class="token punctuation">,</span> <span class="token string">"-p"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Persist execution even in case of an error"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
evaluate_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--workspace"</span><span class="token punctuation">,</span> default<span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Workspace path'</span><span class="token punctuation">)</span>

analysis_parser <span class="token operator">=</span> subparsers<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'analysis'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Run analysis of results'</span><span class="token punctuation">)</span>
analysis_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"trackers"</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Tracker identifiers'</span><span class="token punctuation">)</span>
analysis_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--workspace"</span><span class="token punctuation">,</span> default<span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Workspace path'</span><span class="token punctuation">)</span>
analysis_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--format"</span><span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"html"</span><span class="token punctuation">,</span> <span class="token string">"latex"</span><span class="token punctuation">,</span> <span class="token string">"pdf"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">,</span> <span class="token string">"yaml"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"html"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Analysis output format'</span><span class="token punctuation">)</span>
analysis_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--name"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Analysis output name'</span><span class="token punctuation">)</span>
analysis_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--workers"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Number of parallel workers'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
analysis_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--nocache"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Do not cache data to disk"</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>

pack_parser <span class="token operator">=</span> subparsers<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'pack'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Package results for submission'</span><span class="token punctuation">)</span>
pack_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--workspace"</span><span class="token punctuation">,</span> default<span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Workspace path'</span><span class="token punctuation">)</span>
pack_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"tracker"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Tracker identifier'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="测试官方的样例tracker"><a class="markdownIt-Anchor" href="#测试官方的样例tracker"></a> 测试官方的样例tracker</h1>
<p>分为四步，主要难在initialize：</p>
<h2 id="initialize"><a class="markdownIt-Anchor" href="#initialize"></a> initialize</h2>
<p>初始化环境，并进行配置，以vot2016为例</p>
<h3 id="初始化文件夹和下载数据集"><a class="markdownIt-Anchor" href="#初始化文件夹和下载数据集"></a> 初始化文件夹和下载数据集</h3>
<ol>
<li>任意地方新建一个空文件夹，比如名为<code>vot-test</code>，进入 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> vot-test
vot initialize vot2016<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
此时或自动初始化该文件夹并下载数据集。文件结构为</li>
</ol>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/d2dc168a03564806aa31cf44005d4b27.png#pic_center =50%x50%" width="40%"> 
</div> 
sequences```文件夹下就是对应的vot2016视频序列，每个视频对应一个文件夹
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/563397b907b04f49affc45f295b15560.png#pic_center =80%x80%" width="80%"> 
</div> 
	<font  face="黑体"  color=#FF0000 size=4> 因此每个initialize只能对应一个数据集。</font> 
<ol start="2">
<li>
<p>如果之前已经下载好了数据集，在初始化文件夹时执行以下命令，不再重复下载数据集。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> vot-test
vot initialize vot2016 <span class="token parameter variable">--nodownload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>按照上文<code>sequences</code>的文件夹格式重命名数据集。<br />
<font  face="黑体"  color=#FF0000 size=4> 注意大小写，VOT2016和vot2016不同</font></p>
</li>
</ol>
<h3 id="修改trackersini文件"><a class="markdownIt-Anchor" href="#修改trackersini文件"></a> 修改trackers.ini文件</h3>
<p>相当于告诉vot关于tracker的信息</p>
<ol>
<li>
<p>下载<a href="https://github.com/votchallenge/integration">官方样例</a>，我们只用python文件夹下面的<code>python_ncc.py</code>和<code>vot.py</code></p>
<p><font  face="黑体"  color=#FF0000 size=4> 需要把<code>vot.py</code>重命名，否则和已安装的vot工具包冲突</font></p>
<p>比如重命名为<code>vot_py.py</code><br />
同时把python_ncc.py中的<code>import vot</code>改为<code>import vot_py as vot</code></p>
</li>
<li>
<p>配置trackers.init<br />
严格按照以下格式写</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>pytest<span class="token punctuation">]</span>
label <span class="token operator">=</span> pytest
protocol <span class="token operator">=</span> traxpython  
<span class="token builtin class-name">command</span> <span class="token operator">=</span> python_ncc.py     
paths <span class="token operator">=</span> /media/HardDisk_new/wh/others/pysot-master/vot-test/   
env_PATH <span class="token operator">=</span> /home/wh/anaconda3/envs/others/bin/python<span class="token punctuation">;</span><span class="token variable">$&#123;<span class="token environment constant">PATH</span>&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><font  face="黑体"  color=#FF0000 size=4> 千万不要在每行后加注释，会报错。<code>command</code>后面不要加‘.py’，在文件结构复杂情况下会报错。</font></p>
</li>
</ol>
<h2 id="test"><a class="markdownIt-Anchor" href="#test"></a> test</h2>
<p>执行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vot <span class="token builtin class-name">test</span> pytest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>会看到以下信息（结尾部分），恭喜你测试成功！</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Updating on frame <span class="token number">49</span>/49
@@TRAX:frame <span class="token string">"file:///tmp/vot_dummy_50_640_480/color/00000050.jpg"</span> 
@@TRAX:state <span class="token string">"395.0000,167.0000,100.0000,113.0000"</span> <span class="token string">"confidence=0.9970868825912476"</span> 
Stopping tracker
@@TRAX:quit 
Test concluded successfuly<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果只能测一轮，并看到</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Error during tracker execution: Server terminated the session<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在trackers.ini中添加下面一行，即可解决<br />
<code>restart = true</code></p>
<h2 id="evaluate"><a class="markdownIt-Anchor" href="#evaluate"></a> evaluate</h2>
<p>一般来说测试成功后，vot-toolkit和代码的配置就没问题了。执行，在vot2016上进行评估</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vot evaluate pytest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>运行结束后会得到一个<code>results</code>的文件夹</p>
<h2 id="analysis"><a class="markdownIt-Anchor" href="#analysis"></a> analysis</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vot analysis pytest <span class="token parameter variable">--nocache</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>运行结束后会得到一个<code>analysis</code>的文件夹，包含刚运行的分析结果文件夹，找到<code>report.html</code>，即为结果。</p>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://blog.csdn.net/qq_33890822/article/details/112379934">vot-toolkit-python运行</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>目标跟踪</category>
      </categories>
  </entry>
  <entry>
    <title>《断墨寻径》的笔记</title>
    <url>/2022/01/01/%E3%80%8A%E6%96%AD%E5%A2%A8%E5%AF%BB%E5%BE%84%E3%80%8B%E7%9A%84%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>《断墨寻径》是一个B站Up做的关于学习方法的探讨和分析，其分析的完整性和深度都是少见的。Up主本身也是西安电子的老师，所以整体的内容可信度较高。</p>
<p>这是他的视频连接：<a href="https://www.bilibili.com/video/BV1aS4y1X7eY">【教育部产学】不良学习误区自我排查：掌握科学学习，考入理想学校</a></p>
<p>如他所讲&quot;该课程其实适合所有应试生，但课程是主要针对高中生的&quot;。我在研究生即将毕业的时候看到这个视频，对其中的很多内容或深有同感或大受启发。因此做笔记来记录其重要内容。这篇博客，与其说是给别人看的，不如说是给自己看的；与其说是给自己以后看的，不如说是给现在加强记忆的。</p>
<span id="more"></span>
<p>对他整体内容的评价：</p>
<ul>
<li>整体概念与机器学习中的十分类似，恰巧我是研究深度学习的，因此有所了解。</li>
<li>他作为一个完整的学习过程分析，必然借用很多已有的成果。不必追根溯源，看初始提出原文怎么讲的。因此，我的笔记就以Up主所讲观念为主。</li>
<li>Up主一人之力，难以完善，所以人家题目叫&quot;不良学习误区自我排查&quot;。我们也应这么用，有则改之无则加勉。</li>
</ul>
<h1 id="重现目标与泛化目标"><a class="markdownIt-Anchor" href="#重现目标与泛化目标"></a> 重现目标与泛化目标</h1>
<p>学习任务分为两类：</p>
<ul>
<li>记忆：重现信息。信息就是对某事物的具体描述。</li>
<li>学习：泛化知识。知识是指对某类事物的抽象描述。学习比记忆，多在可泛化上，也就是可以应对从未出现的新情况。</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e0a68bdbd10f41f081bb1c60d659bda4.png" width="80%"> 
</div> 
<h1 id="指令学习和归纳学习"><a class="markdownIt-Anchor" href="#指令学习和归纳学习"></a> 指令学习和归纳学习</h1>
<p>对于泛化学习目标，有两个学习方式。<br />
指令学习，给你个概念，给你个说明书。学校常用，但大脑不擅长这种方式。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/07bd03c9b1fc45709ec0377eeed6f81e.png" width="80%"> 
</div> 
归纳学习，直接研究案例，总结共性。在无意识的情况下，大脑自动总结归纳。大脑擅长。但容易受到案例的影响，比如案例偏激，总结出的规律就不具备普适性。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/a7ba700b440b499984dd59aeaecbf88e.png" width="80%"> 
</div> 
<p>最佳的学习模式应该是结合两者的模式。为什么？</p>
<ul>
<li>那些概念和定义，以指令学习的方式，构建一个框架，可以确定大方向不至于跑偏。这相当于绘画的底稿。</li>
<li>多个实际的案例，以归纳学习的方式，填充内容，相当于上色。</li>
</ul>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/d35f464076dc4f64b8f38a40be77484f.png" width="80%"> 
</div> 
<h1 id="归纳不足和以偏概全"><a class="markdownIt-Anchor" href="#归纳不足和以偏概全"></a> 归纳不足和以偏概全</h1>
<p>这其实就是机器学习中的欠拟合和过拟合的概念。对于高中生而言，欠拟合就是做题少。过拟合就是做了一堆偏难怪，导致总结的规律没有通用性。</p>
<p>Up主建议双例学习法</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/55ca5c0702254dc0b7e3404f0f5bf11f.png" width="80%"> 
</div> 
<h1 id="可泛化性和有效范围"><a class="markdownIt-Anchor" href="#可泛化性和有效范围"></a> 可泛化性和有效范围</h1>
<p>这主要是针对，网络学习的知识付费课程</p>
<ol>
<li>所讲知识本身，是否具有泛化能力？</li>
<li>什么条件下，使用这个知识？限定条件也很重要！</li>
</ol>
<h1 id="有效指令与有效实例"><a class="markdownIt-Anchor" href="#有效指令与有效实例"></a> 有效指令与有效实例</h1>
<p>有效实例是指带结果的实例，这相当于机器学习中有标签的监督学习。</p>
<p>有效描述（指令）是指，这个概念中设计的所有子概念，都已经清楚。</p>
<h1 id="材料瓶颈和模型瓶颈"><a class="markdownIt-Anchor" href="#材料瓶颈和模型瓶颈"></a> 材料瓶颈和模型瓶颈</h1>
<p>由材料瓶颈引起的泛化能力不能继续提升。从未见过的新情况越来越少，而可以得到的材料绝大部分都是已学习过的规律和模型。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/07b890fc4813497b9f30c7461967a3ca.png" width="80%"> 
</div> 
另一种则是模型瓶颈，习惯某种已有的思路，但这种思路或者方案并不完善。而大脑会本能的拒绝新规律的进入。此时可用一个满足新规律但不满足旧规律的实例，来打破这种瓶颈，让大脑意识已有规律到还不完善。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/d3af8cc426ce497f814b66751b501296.png" width="80%"> 
</div> 
<h1 id="知识的存储位置和存储过程"><a class="markdownIt-Anchor" href="#知识的存储位置和存储过程"></a> 知识的存储位置和存储过程</h1>
<p>首先是两个误区，这恰恰是违反了知识的存储过程</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/8a221a506f6948dbbedccdc8e00d365d.png" width="80%"> 
</div> 
<h2 id="存储位置"><a class="markdownIt-Anchor" href="#存储位置"></a> 存储位置</h2>
<p>我理解一下Up的观念：<br />
知识存储于神经细胞之间的连接，但这个连接并不是越多越好（婴儿的最多）。<br />
学习实际上就是改变神经之间连接的过程。<br />
（这真的和深度学习中的神经网络很相似）</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/9ca80d4a5cbd45deae06efd708929cec.png" width="80%"> 
</div> 
<h2 id="存储过程"><a class="markdownIt-Anchor" href="#存储过程"></a> 存储过程</h2>
<p>大脑根据完整的事例，可改变神经细胞之间的连接。<br />
<strong>而改变的时间，就在睡眠期间。</strong></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/c37dd2dab277458c8cce0f50e6ee0b0a.png" width="80%"> 
</div> 
大脑无法一次性就得到正确的连接，需要多次调整才可以。
（如果你观察过深度学习中的Loss曲线，深以为然。）
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/5394d95992da4959843b8c50a14acd16.png" width="80%"> 
</div> 
<h1 id="有效训练与精细加工"><a class="markdownIt-Anchor" href="#有效训练与精细加工"></a> 有效训练与精细加工</h1>
<p>想象和观察也能刺激大脑，但远不如自己实际执行一遍的的刺激程度。<br />
有效训练是指自己实际执行并且有得到反馈答案的整体过程。相当于做完题看答案。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/5bfdb39c603a4bfd8f0fe582dff3c9ce.png" width="80%"> 
</div> 
指令性学习，比如只给一条概念怎么办？
你得自行根据定义扩充材料，进行思考。相当于把书读厚。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/2e7cf3d4821d48868036c31ddc3f8eb7.png" width="80%"> 
</div> 
同时针对指令性学习，和旧知识建立对比联系也很有帮助。
而把书读薄，是指大脑根据材料自动归纳出一般规律，并不是人为的对书本内容进行删减。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/9c76d3e6ad1141a1a3968baf91c552c9.png" width="80%"> 
</div> 
<h1 id="新例预测和表述转换"><a class="markdownIt-Anchor" href="#新例预测和表述转换"></a> 新例预测和表述转换</h1>
<p>大脑需要一个信号，停止调整，也需要一个动作来保持记忆，这个动作就是验证。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/34f77e952e374a65a1689510ae95e77d.png" width="80%"> 
</div> 
这个验证，对于泛化学习目标来说，可以再做一些题。对于重现学习目标，可以用自己的话重新表述。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e595744523664be5a43103de64e4ed5e.png" width="80%"> 
</div> 
而给别人讲题，则成功兼具了这两点。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/de83d0766fca4587a49059b90a3d4943.png" width="80%"> 
</div> 
<h1 id="整体框架"><a class="markdownIt-Anchor" href="#整体框架"></a> 整体框架</h1>
<p>对于一个学习任务，需要明确的是这是需要理解的泛化任务，还是需要背诵的复现任务。<br />
而对于泛化学习任务，Up主的整个系列的内容，可概括为这个框架。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/bbbc85894ee147a6a4b3096e125000bb.png" width="80%"> 
</div> 
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1>
<p>就我个人而言，这个视频中对于指令性学习和归纳性学习的分析和论断，让我眼前一亮。之前学习深度学习的相关知识，总会有些定义概念要看，但实际上也没什么用。有位老师针对这种情况说：“那些书本上的东西，看了没什么用，不看感觉有少点什么。”  我同意这个评论，而上面Up主的分析，让我搞懂了“少的”是什么。</p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>其他</category>
      </categories>
  </entry>
  <entry>
    <title>从矩阵角度分析转置卷积</title>
    <url>/2021/12/28/%E4%BB%8E%E7%9F%A9%E9%98%B5%E8%A7%92%E5%BA%A6%E5%88%86%E6%9E%90%E8%BD%AC%E7%BD%AE%E5%8D%B7%E7%A7%AF/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>上次从公式角度研究了转置卷积。这次想进一步从矩阵计算角度研究。内容基本上参考这位大神在B站讲解的<a href="https://www.bilibili.com/video/BV1mh411J7U4?spm_id_from=333.999.0.0">转置卷积（transposed convolution）</a>，他在CSDN也有对应的博文<a href="https://blog.csdn.net/qq_37541097/article/details/120709865">转置卷积（Transposed Convolution）</a>。强烈建议大家去看看B站的视频。我这里的图片都来源于这位大神。</p>
<span id="more"></span>
<p>这里只是把我感兴趣的地方做个记录，以便后来查找。我感兴趣的是，<strong>从矩阵运算的角度讲，转置卷积为什么能放大图片</strong></p>
<p>转置卷积原文：<a href="https://arxiv.org/abs/1603.07285">A guide to convolution arithmetic for deep learning</a></p>
<h1 id="转置卷积的计算流程"><a class="markdownIt-Anchor" href="#转置卷积的计算流程"></a> 转置卷积的计算流程</h1>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/ccd5b6c03aa0468193f0863c7caa878b.png" width="80%"> 
</div> 
在填充之后的卷积运算，等效为
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/177626a3d62a4d2fa52c104b0ffbe7a6.png" width="80%"> 
</div> 
<h1 id="转置卷积和普通卷积的关系"><a class="markdownIt-Anchor" href="#转置卷积和普通卷积的关系"></a> 转置卷积和普通卷积的关系</h1>
<p>首先明确，<strong>转置卷积不是标准卷积的逆运算</strong></p>
<h2 id="普通卷积"><a class="markdownIt-Anchor" href="#普通卷积"></a> 普通卷积</h2>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/cf465b60f53f434aac2e61ff4867f415.png" width="80%"> 
</div> 
这步都能看得懂，下面开始施展魔法
<h3 id="填充卷积核以代替平移"><a class="markdownIt-Anchor" href="#填充卷积核以代替平移"></a> 填充卷积核以代替平移</h3>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/c7e0503a64d74852857cfcf86eab6f14.png" width="80%"> 
</div> 
<h3 id="将卷积核和输入展平"><a class="markdownIt-Anchor" href="#将卷积核和输入展平"></a> 将卷积核和输入展平</h3>
<p>展平顺序是先行后列</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/5de4e7a7fc464064b06cbf59d48e545f.png" width="80%"> 
</div> 
这样一来，一个复杂的卷积过程，就化简为一个矩阵乘法。将输出reshape，即可得到我们最开始学习卷积的结果。
<h2 id="转置卷积"><a class="markdownIt-Anchor" href="#转置卷积"></a> 转置卷积</h2>
<p>上面那个式子， <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mo separator="true">⋅</mo><mi>C</mi><mo>=</mo><mi>O</mi></mrow><annotation encoding="application/x-tex">I·C=O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span></span></span></span>。如果已知长度较小的O，想把它变长，怎么办？ 等式两边乘上<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>C</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">C^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>，于是</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mo separator="true">⋅</mo><mi>C</mi><mo separator="true">⋅</mo><msup><mi>C</mi><mi>T</mi></msup><mo>=</mo><mi>O</mi><mo separator="true">⋅</mo><msup><mi>C</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">I·C·C^T = O·C^T 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>从维度上看<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo separator="true">⋅</mo><msup><mi>C</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">O·C^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 为1 *16，但因为$C·C^T $不是单位阵，</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mi mathvariant="normal">≠</mi><mi>O</mi><mo separator="true">⋅</mo><msup><mi>C</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">I \neq O·C^T 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><strong>因此，转置卷积只起到了放大的作用，并不是卷积的逆过程。</strong></p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/f859498ad9ee4ca5854232cbe6bad17a.png" width="80%"> 
</div> 
<h1 id="转置卷积核和普通卷积核的关系"><a class="markdownIt-Anchor" href="#转置卷积核和普通卷积核的关系"></a> 转置卷积核和普通卷积核的关系</h1>
<p>我得先说，这里可以不用去看。<strong>因为在实际使用的时候，转置卷积核是经过训练得到的，并不会通过上下左右翻转得到</strong>与其了解两者的关系，不如直接把转置卷积直接当做一种特殊的卷积。</p>
<p>但是我还是记录一下大佬的讲解。</p>
<p>首先将经过转置的卷积核还原成单个卷积核</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/444514ceafa14e10b6b2b42419736849.png" width="80%"> 
</div> 
根据运算关系，可以得到转置卷积核
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/513de0ba9be2476f8e9df0b9b995e25b.png" width="80%"> 
</div> 
结果发现，转置卷积核就是普通卷积核的上下翻转后左右翻转。
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/33bdd9a590ac470bac0d17afcd8c851a.png" width="80%"> 
</div> 
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1>
<p>用我研究语义分割同学的话说：转置卷积就是一个会更精细一点的上采样，因为它可训练。</p>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<p>[1] <a href="https://www.bilibili.com/video/BV1mh411J7U4?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1mh411J7U4?spm_id_from=333.999.0.0</a></p>
<p>[2] <a href="https://blog.csdn.net/tsyccnh/article/details/87357447">https://blog.csdn.net/tsyccnh/article/details/87357447</a></p>
]]></content>
      <categories>
        <category>笔记</category>
        <category>Python，Numpy和Pytorch</category>
      </categories>
  </entry>
  <entry>
    <title>语义分割标注方式和指标</title>
    <url>/2021/12/30/%E8%AF%AD%E4%B9%89%E5%88%86%E5%89%B2%E6%A0%87%E6%B3%A8%E6%96%B9%E5%BC%8F%E5%92%8C%E6%8C%87%E6%A0%87/</url>
    <content><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>这是我看大佬讲<a href="https://www.bilibili.com/video/BV1ev411P7dR?spm_id_from=333.999.0.0">语义分割前言</a>记的笔记。如果对这块内容有需要，建议直接看他视频。</p>
<p>这是他B站主页，<a href="https://space.bilibili.com/18161609">https://space.bilibili.com/18161609</a></p>
<span id="more"></span>
<h1 id="分割任务"><a class="markdownIt-Anchor" href="#分割任务"></a> 分割任务</h1>
<p>语义分割：区分类别<br />
实例分割：区分同一类别的不同个体<br />
全景分割：在实例分割的基础上，区分背景（如天空，草地）</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/59ea9173187e4e73b9f13876c3b39928.png#pic_center=80%x80%" width="80%"> 
</div> 
<h1 id="数据集标注方式"><a class="markdownIt-Anchor" href="#数据集标注方式"></a> 数据集标注方式</h1>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/81870c6733164629bf87a2dea942aaa2.png#pic_center=80%x80%" width="80%"> 
</div> 
COCO针对目标标注若干个点，用点之间的连线把目标圈出来
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/224a27e90c7642bca350a9c226d6307a.png#pic_center=80%x80%" width="80%"> 
</div> 
<h1 id="标注工具"><a class="markdownIt-Anchor" href="#标注工具"></a> 标注工具</h1>
<p>只记了一个半自动的工具</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/3cfc81411eaa4cb7a858c826e6442437.png#pic_center=80%x80%" width="80%"> 
</div> 
<h1 id="评价指标"><a class="markdownIt-Anchor" href="#评价指标"></a> 评价指标</h1>
<h2 id="定义"><a class="markdownIt-Anchor" href="#定义"></a> 定义</h2>
<p>和下边的计算方式结合看，效果更好。</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/7cec7d802a9c40a4a2e9c556a7172da3.png#pic_center=80%x80%" width="80%"> 
</div> 
<h2 id="计算方式"><a class="markdownIt-Anchor" href="#计算方式"></a> 计算方式</h2>
<h3 id="混淆矩阵"><a class="markdownIt-Anchor" href="#混淆矩阵"></a> 混淆矩阵</h3>
<p>语义分割本质上是对每个像素点的分类。因此，可以构建一个矩阵，矩阵的值为该像素点对应的类别。可得到真是标签的矩阵和预测标签的矩阵。</p>
<p>然后，构建一个矩阵，横坐标是真实标签，纵坐标是预测标签。矩阵第(i,j)个值代表，真实标签为j的被预测为i的个数。此时，这个矩阵叫混淆矩阵，对角线是正确分类的个数。</p>
<p>插句题外话：对角线元素相当于TP，所在行之和减去对角线元素相当于FP，所在列之和减去对角线元素相当于FN，矩阵的其他行列元素之和对该类别而言为TN</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/e9ddefb6916144aa94f30e6f01fcd66c.png#pic_center=80%x80%" width="80%"> 
</div> 
<h3 id="global-acc"><a class="markdownIt-Anchor" href="#global-acc"></a> Global Acc</h3>
<p>对角线上所有元素之和=所有类别正确分类的元素数<br />
n个类别所属像素的总数=全图像素数=混淆矩阵所有元素之和</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/6d9bc20c6a3640519900d1577340cb8c.png#pic_center=80%x80%" width="80%"> 
</div> 
<h3 id="mean-acc"><a class="markdownIt-Anchor" href="#mean-acc"></a> Mean Acc</h3>
<p>每个类别的所属像素总数=每列元素总数<br />
由此可得每个类别的分类精确度，然后再求平均</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/f68ba2380c8840dfbcac8d3bb2873373.png#pic_center=80%x80%" width="80%"> 
</div> 
<h3 id="mean-iou"><a class="markdownIt-Anchor" href="#mean-iou"></a> Mean IoU</h3>
<p>以第零个类别为例，<br />
正确分类像素数=16<br />
真实所属第零类像素数=第一列元素和=20<br />
预测所属第零类像素数=第一行元素和=18</p>
<p>于是第零个类别的iou=16/(20+18)</p>
<p>然后多个类别再平均</p>
<div align="center"> 
<img src="https://img-blog.csdnimg.cn/ad0b949c93b844ff91881cd2c1abcb24.png#pic_center=80%x80%" width="80%"> 
</div> 
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1>
<p>混淆矩阵真是个好东西</p>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ol>
<li><a href="https://www.bilibili.com/video/BV1ev411P7dR?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1ev411P7dR?spm_id_from=333.999.0.0</a></li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
        <category>语义分割</category>
      </categories>
  </entry>
</search>
